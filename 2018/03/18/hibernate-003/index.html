<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="本章主要介绍如何在Hibernate中为实体定义主键，以及JPA中主键的常用生成策略。此外对这些主键生成策略进行了一些分析，以方便在现实实现中选择一种合适的策略。">
<meta name="keywords" content="Hibernate,Java,JPA,Primary Key,GeneratedValue,Id">
<meta property="og:type" content="article">
<meta property="og:title" content="Hibernate学习笔记（三）Hibernate中的主键 之 Sequence">
<meta property="og:url" content="http://rainsia.gitee.io/2018/03/18/hibernate-003/index.html">
<meta property="og:site_name" content="Rain&#39;s Blog">
<meta property="og:description" content="本章主要介绍如何在Hibernate中为实体定义主键，以及JPA中主键的常用生成策略。此外对这些主键生成策略进行了一些分析，以方便在现实实现中选择一种合适的策略。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://rainsia.gitee.io/2018/03/18/hibernate-003/Snipaste_2018-03-16_09-50-39.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/03/18/hibernate-003/Snipaste_2018-03-16_10-38-48.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/03/18/hibernate-003/Snipaste_2018-03-16_10-57-22.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/03/18/hibernate-003/Snipaste_2018-03-19_18-23-26.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/03/18/hibernate-003/Snipaste_2018-03-19_17-05-31.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/03/18/hibernate-003/Snipaste_2018-03-19_18-25-11.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/03/18/hibernate-003/Snipaste_2018-03-19_21-31-49.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/03/18/hibernate-003/Snipaste_2018-03-19_21-32-56.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/03/18/hibernate-003/Snipaste_2018-03-19_21-35-34.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/03/18/hibernate-003/Snipaste_2018-03-20_22-34-50.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/03/18/hibernate-003/Snipaste_2018-03-20_22-58-34.png">
<meta property="og:updated_time" content="2018-10-20T11:43:26.851Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hibernate学习笔记（三）Hibernate中的主键 之 Sequence">
<meta name="twitter:description" content="本章主要介绍如何在Hibernate中为实体定义主键，以及JPA中主键的常用生成策略。此外对这些主键生成策略进行了一些分析，以方便在现实实现中选择一种合适的策略。">
<meta name="twitter:image" content="http://rainsia.gitee.io/2018/03/18/hibernate-003/Snipaste_2018-03-16_09-50-39.png">






  <link rel="canonical" href="http://rainsia.gitee.io/2018/03/18/hibernate-003/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Hibernate学习笔记（三）Hibernate中的主键 之 Sequence | Rain's Blog</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?9d1df7de5bd3ea1d75446764f5075fe7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Rain's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">记录、分享、技术</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rainsia.gitee.io/2018/03/18/hibernate-003/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rain Sia <rainsia@163.com>">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rain's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Hibernate学习笔记（三）Hibernate中的主键 之 Sequence
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-03-18 22:28:02" itemprop="dateCreated datePublished" datetime="2018-03-18T22:28:02+08:00">2018-03-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-10-20 19:43:26" itemprop="dateModified" datetime="2018-10-20T19:43:26+08:00">2018-10-20</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/Java/Hibernate/" itemprop="url" rel="index"><span itemprop="name">Hibernate</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/18/hibernate-003/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2018/03/18/hibernate-003/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon"
            >
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本章主要介绍如何在Hibernate中为实体定义主键，以及JPA中主键的常用生成策略。此外对这些主键生成策略进行了一些分析，以方便在现实实现中选择一种合适的策略。</p>
<a id="more"></a>
<h1 id="为实体设置主键"><a href="#为实体设置主键" class="headerlink" title="为实体设置主键"></a>为实体设置主键</h1><p>在Hibernate(JPA)中，仅仅使用@Entity注解是无法完整描述一个持久化类的，Hibernate还要求一个持久化类<strong>必须</strong>指定一个主键。Hibernate要求使用@Id注解来表示一个类的某个属性被指定为主键。比如如下代码所示：</p>
<figure class="highlight java"><figcaption><span>Message.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rainsia.hibernate.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一个简单的实体类</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yu Xia &lt;rainsia@163.com&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>	<span class="comment">//实体类必须使用注解@Entity标记，在实体化这个实体的时候，会创建数据库表Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实体的主键，用来标识一个唯一的实体，</span></span><br><span class="line"><span class="comment">     * 推荐使用Long类型，最好不要使用long原始类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Id</span>	<span class="comment">//每一个实体必须具有一个主键，主键使用@Id注解表示</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一个普通的属性，简单属性会在持久化时自动创建数据库列，默认名称和属性名称相同</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------getter和setter----------</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setText</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.text = text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//----------------------------------</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的例子中，将Message类的id属性定义为了主键。Hibernate中使用主键有如下的注意事项：</p>
<ol>
<li>主键值不能为空。</li>
<li>主键值必须是唯一的。</li>
<li>主键值一旦指定，那么不应该修改。因此不要为主键字段设置setter方法。</li>
</ol>
<p>主键在Hibernate中有至关重要的意义。Hibernate不允许在创建了实体之后在次修改主键的值。如果不遵守Hibernate的这一要求，那么Hibernate的脏检查机制和缓存机制都将出现问题。默认情况下，主键必须人为指定，这为系统实现带来了巨大的困难：如何保证全局下键的唯一性？</p>
<p>在实际的实现中，自然主键（即实体本身就具有的属性作为主键）通常会有各种各样的问题，因此推荐使用代理主键。代理键不具有业务含义，仅用于标识一个唯一的实体。在大多数情况下，用户不会直接看到或者涉及到这些键。</p>
<h1 id="键生成器"><a href="#键生成器" class="headerlink" title="键生成器"></a>键生成器</h1><p>使用代理主键的一大好处是可以让系统在创建实体时自动生成键值，从而避免人为指定主键的各种问题。在Hibernate中，要让系统自动生成键值，需要在主键上添加@GeneratedValue注解，并且配置合适的生成策略（算法）。</p>
<h2 id="使用JPA键生成器"><a href="#使用JPA键生成器" class="headerlink" title="使用JPA键生成器"></a>使用JPA键生成器</h2><p>在JPA中，可以通过@GeneratedValue的strategy属性来配置一种主键生成的策略。strategy的类型是JPA的枚举类型GenerationType，其取值如下：</p>
<ol>
<li>GenerationType.AUTO：这是默认值。Hibernate会根据配置文件中hibernate.dialect所配置的方言来选择一种最佳策略。（可移植性差，不推荐使用）</li>
<li>GenerationType.SEQUENCE：以序列（有顺序的数字）的形式生成主键。Hibernate会在底层数据库中生成一个名称为HIBERNATE_SEQUENCE的表来辅助生成序列，该表中有一个列next_val用于记录下一个要生成的主键值。在具体执行insert语句之前，实体的主键就会生成并可以访问。默认情况下，所有实体共享一个序列，因此每个实体的实例的序列号可能不是连续的，但通常这不是问题。</li>
<li>GenerationType.IDENTITY：使用数据库的自增长列作为主键。只有在执行insert的时候才会生成主键的值，并且只有在数据被插入数据库之后才能获取到主键的值。（事务没有提交之前都无法获取主键值，不推荐使用）</li>
<li>GenerationType.TABLE：以序列的形式生成主键，使用一个辅助表HIBERNATE_SEQUENCES来生成序列。默认情况下和SEQUENCE行为类似，HIBERNATE_SEQUENCE表有两个列，sequence_name和next_val，默认情况下sequence_name为default，next_val记录了下一行数据的序列号。和SEQUENCE类似，所有实体共享一个序列，因此每个实体的实例的序列号可能不是连续的。可以使用@TableGenerator注解来改变其行为，例如为每一个实体单独提供一个序列、使用高/低位序列生成算法等。</li>
</ol>
<h3 id="用SEQUENCE生成主键"><a href="#用SEQUENCE生成主键" class="headerlink" title="用SEQUENCE生成主键"></a>用SEQUENCE生成主键</h3><p>首先，在实体类的主键列上，标注生成方法为SEQUENCE。</p>
<figure class="highlight java"><figcaption><span>Message.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rainsia.hibernate.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.SequenceGenerator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一个简单的实体类</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yu Xia &lt;rainsia@163.com&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>	<span class="comment">//实体类必须使用注解@Entity标记，在实体化这个实体的时候，会创建数据库表Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实体的主键，用来标识一个唯一的实体，</span></span><br><span class="line"><span class="comment">     * 推荐使用Long类型，最好不要使用long原始类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Id</span>	<span class="comment">//每一个实体必须具有一个主键，主键使用@Id注解表示</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy=GenerationType.SEQUENCE)   <span class="comment">//使用SEQUENCE作为主键生成方式</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一个普通的属性，简单属性会在持久化时自动创建数据库列，默认名称和属性名称相同</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------getter和setter----------</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;	<span class="comment">//id只应该有getter方法，而没有setter方法</span></span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setText</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.text = text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//----------------------------------</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一旦创建了实体并调用了持久化之后（在实际insert语句执行之前），便可以访问正确访问其主键值。直接看代码演示：</p>
<figure class="highlight java"><figcaption><span>Message.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rainsia.hibernate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManager;</span><br><span class="line"><span class="keyword">import</span> javax.transaction.NotSupportedException;</span><br><span class="line"><span class="keyword">import</span> javax.transaction.UserTransaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.env.JpaSetup;</span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.env.TransactionManagerSetup;</span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.model.Message;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldJpa</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		TransactionManagerSetup tm = <span class="keyword">null</span>;</span><br><span class="line">		EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			tm = <span class="keyword">new</span> TransactionManagerSetup();</span><br><span class="line">			JpaSetup jpa = <span class="keyword">new</span> JpaSetup(<span class="string">"HelloWorldPU"</span>);</span><br><span class="line">			UserTransaction tx = tm.getUserTransaction();</span><br><span class="line"></span><br><span class="line">			tx.begin();							<span class="comment">//开始事务</span></span><br><span class="line">			em = jpa.createEntityManager();		<span class="comment">//创建实体管理器</span></span><br><span class="line">			</span><br><span class="line">			Message message = <span class="keyword">new</span> Message();	<span class="comment">//创建实体</span></span><br><span class="line">			message.setText(<span class="string">"Hello World!"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 保存实体，注意这里仅仅是通知Hibernate需要保存数据，Hibernate此时并不会执行插入数据的SQL</span></span><br><span class="line">			<span class="comment">//	而是等到最后事务提交的时候才执行，然而使用sequence主键的时候，可以在提交之前就获得主键的值</span></span><br><span class="line">			em.persist(message);</span><br><span class="line">			</span><br><span class="line">			System.out.println(message.getId());	<span class="comment">//persist之后可以获取id</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">// 提交事务，此时Hibernate才真正执行insert语句</span></span><br><span class="line">			tx.commit(); <span class="comment">// INSERT into MESSAGE (ID, TEXT) values (1, 'Hello World!')</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (NamingException ex) &#123;</span><br><span class="line">			ex.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (NotSupportedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(em != <span class="keyword">null</span> &amp;&amp; em.isOpen()) &#123;</span><br><span class="line">				em.close();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(tm != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					tm.stop();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行程序之后，会产生一个HIBERNATE_SEQUENCE的表，其数据如下图所示：</p>
<img src="/2018/03/18/hibernate-003/Snipaste_2018-03-16_09-50-39.png" title="运行结果HIBERNATE_SEQUENCE">
<p>其中只有一列next_val，用于记录下一条数据的主键值是多少。在调用em.persist()方法的时候，Hibernate会为正在持久化的实体获取next_val的值，并使得next_val的值自增。同时Hibernate也考虑到并发插入的情况，所以在获取next_val值的时候使用了锁，例如下面代码中的第四行使用了for update锁：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    next_val <span class="keyword">as</span> id_val </span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">    hibernate_sequence <span class="keyword">for</span> <span class="keyword">update</span></span><br></pre></td></tr></table></figure>
<p>因此，可以认为即使是在并发插入的时候，要获取一个键值也只能等上一个键值获取并更新（增加1）完成之后才能够获取，因此可以保证实体实例的主键值不会重复。</p>
<p>值得注意的是，这个序列是所有实体共享的，如果交叉插入不同的实体实例，那么每一个实体的实例所获得的主键值将是不连续的。为了展示这个特性，我们再创建一个Message2实体，其代码和Message一样：</p>
<figure class="highlight java"><figcaption><span>Message.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rainsia.hibernate.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一个简单的实体类</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yu Xia &lt;rainsia@163.com&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>	<span class="comment">//实体类必须使用注解@Entity标记，在实体化这个实体的时候，会创建数据库表Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实体的主键，用来标识一个唯一的实体，</span></span><br><span class="line"><span class="comment">     * 推荐使用Long类型，最好不要使用long原始类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Id</span>	<span class="comment">//每一个实体必须具有一个主键，主键使用@Id注解表示</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy=GenerationType.SEQUENCE)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一个普通的属性，简单属性会在持久化时自动创建数据库列，默认名称和属性名称相同</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------getter和setter----------</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setText</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.text = text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//----------------------------------</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后在persistence.xml文件中添加新的实体：</p>
<figure class="highlight xml"><figcaption><span>persistence.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">……</span><br></pre></td></tr></table></figure>
<p>然后，交叉插入两个实体：</p>
<figure class="highlight java"><figcaption><span>Message.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行该程序，如下图所示，可以看到两个表的序列号，并不连续：</p>
<img src="/2018/03/18/hibernate-003/Snipaste_2018-03-16_10-38-48.png" title="运行结果Message">
<img src="/2018/03/18/hibernate-003/Snipaste_2018-03-16_10-57-22.png" title="运行结果Message2">
<p>每个实例的主键值将是整个数据库唯一的，而不是每个表唯一的。不同的实体之间也不会产生主键冲突。如果你担心为整个数据库创建一个序列可能会造成主键值溢出的问题，那么你可以不用太担心。我们使用Long类型作为主键值，在Java中，这是一个64位带符号的数据类型，其取值范围是$-\frac{1}{2}2^{64}$到$\frac{1}{2}2^{64}-1$之间。按照每毫秒产生一个id值计算，一个Long类型的序列可以持续生成键值大约3亿年。这几乎足以满足大部分的系统需求。</p>
<h3 id="定制SEQUENCE"><a href="#定制SEQUENCE" class="headerlink" title="定制SEQUENCE"></a>定制SEQUENCE</h3><p>如果要改变默认的HIBERNATE_SEQUENCE表的名字，或者对SEQUENCE做其他的定制。可以使用@SequenceGenerator注解来定制SEQUENCE的行为。</p>
<p>@SequenceGenerator有六个属性：name、catalog、schema、sequenceName、initialValue和allocationSize。</p>
<ol>
<li>name是必须的，用于指定一个生成器的名字，例如@SequenceGenerator(name=”id_gen”)。相应的，在主键之上的@GeneratedValue注解的属性也应该变为@GeneratedValue(generator=”id_gen”)。</li>
<li>catalog和schema指定了序列的名称空间以避免重名。</li>
<li>sequenceName指定了sequence的名称，如果底层依赖的数据库不支持序列，那么Hibernate将会使用表的形式记录序列，则sequenceName的值即指定了表名。其默认值为hibernate_sequence。</li>
<li>initialValue指定了序列的初始值。其默认值为1。</li>
<li>allocationSize指定了Hibernate缓存的序列值的数量，每次缓存值用完，才需要再次数据库系统中再次获取新的序列值。其默认值为50。</li>
</ol>
<p>前4个属性都比较好理解，allocationSize参数的意义并不是在分配主键值的时候使用间隔分配的方式，而是指每隔多少个值才访问一次数据库获取新的主键值。例如如下实体定义：</p>
<figure class="highlight java"><figcaption><span>Message.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rainsia.hibernate.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.SequenceGenerator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一个简单的实体类</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yu Xia &lt;rainsia@163.com&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>	<span class="comment">//实体类必须使用注解@Entity标记，在实体化这个实体的时候，会创建数据库表Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实体的主键，用来标识一个唯一的实体，</span></span><br><span class="line"><span class="comment">     * 推荐使用Long类型，最好不要使用long原始类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Id</span>	<span class="comment">//每一个实体必须具有一个主键，主键使用@Id注解表示</span></span><br><span class="line">	<span class="meta">@SequenceGenerator</span>(</span><br><span class="line">    	name=<span class="string">"messageGen"</span>,</span><br><span class="line">    	sequenceName=<span class="string">"id_sequence"</span>,</span><br><span class="line">    	initialValue=<span class="number">5</span>,</span><br><span class="line">    	allocationSize=<span class="number">10</span></span><br><span class="line">    )</span><br><span class="line">    <span class="meta">@GeneratedValue</span>(generator=<span class="string">"messageGen"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一个普通的属性，简单属性会在持久化时自动创建数据库列，默认名称和属性名称相同</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------getter和setter----------</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;	<span class="comment">//id只应该有getter方法，而没有setter方法</span></span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setText</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.text = text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//----------------------------------</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>程序中声明了一个序列，名称为messageGen，该序列名称为id_sequence（注意在MySql和MaridaDB等不支持不支持序列的DBMS中，Hibernate会使用一个表id_sequence来模拟序列的行为）。id_sequence序列初始值为5，缓存10个序列值，即Hibernate分配10个键值之后，才需要向数据库再次请求。</p>
<p>下面的程序将持久化30个Message实体的实例：</p>
<figure class="highlight java"><figcaption><span>HelloWorldApp.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rainsia.hibernate.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManager;</span><br><span class="line"><span class="keyword">import</span> javax.transaction.NotSupportedException;</span><br><span class="line"><span class="keyword">import</span> javax.transaction.UserTransaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.env.JpaSetup;</span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.env.TransactionManagerSetup;</span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.model.Message;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldApp</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日志</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(HelloWorldApp.class);</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		TransactionManagerSetup tm = <span class="keyword">null</span>;</span><br><span class="line">		EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			logger.info(<span class="string">"正在创建事务管理器……"</span>);</span><br><span class="line">			tm = <span class="keyword">new</span> TransactionManagerSetup();</span><br><span class="line">			UserTransaction tx = tm.getUserTransaction();</span><br><span class="line">			logger.info(<span class="string">"事务管理器已创建"</span>);</span><br><span class="line">			</span><br><span class="line">			logger.info(<span class="string">"正在开始事务……"</span>);</span><br><span class="line">			tx.begin();							<span class="comment">//开始事务</span></span><br><span class="line">			logger.info(<span class="string">"事务已开始"</span>);</span><br><span class="line">			</span><br><span class="line">			logger.info(<span class="string">"正在创建实体管理器……"</span>);</span><br><span class="line">			JpaSetup jpa = <span class="keyword">new</span> JpaSetup(<span class="string">"HelloWorldPU"</span>);</span><br><span class="line">			em = jpa.createEntityManager();		<span class="comment">//创建实体管理器</span></span><br><span class="line">			logger.info(<span class="string">"实体管理器已创建"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">25</span>; i++) &#123;</span><br><span class="line">				logger.info(<span class="string">"正在创建实体&#123;&#125;……"</span>, i);</span><br><span class="line">				Message message = <span class="keyword">new</span> Message();	<span class="comment">//创建实体</span></span><br><span class="line">				message.setText(<span class="string">"Hello World "</span> + i);</span><br><span class="line">				logger.info(<span class="string">"实体&#123;&#125;已创建"</span>, i);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 保存实体，注意这里仅仅是通知Hibernate需要保存数据，Hibernate此时并不会执行插入数据的SQL</span></span><br><span class="line">				<span class="comment">//	而是等到最后事务提交的时候才执行</span></span><br><span class="line">				logger.info(<span class="string">"正在持久化实体&#123;&#125;……"</span>, i);</span><br><span class="line">				em.persist(message);</span><br><span class="line">				logger.info(<span class="string">"实体&#123;&#125;已持久化"</span>, i);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 提交事务，此时Hibernate才真正执行insert语句</span></span><br><span class="line">			logger.info(<span class="string">"正在提交事务……"</span>);</span><br><span class="line">			tx.commit(); <span class="comment">// INSERT into MESSAGE (ID, TEXT) values (1, 'Hello World!')</span></span><br><span class="line">			logger.info(<span class="string">"事务已提交"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (NamingException ex) &#123;</span><br><span class="line">			ex.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (NotSupportedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(em != <span class="keyword">null</span> &amp;&amp; em.isOpen()) &#123;</span><br><span class="line">				logger.info(<span class="string">"正在关闭实体管理器……"</span>);</span><br><span class="line">				em.close();</span><br><span class="line">				logger.info(<span class="string">"实体管理器已关闭"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(tm != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					logger.info(<span class="string">"正在停止事务管理器……"</span>);</span><br><span class="line">					tm.stop();</span><br><span class="line">					logger.info(<span class="string">"事务管理器已停止"</span>);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其完整的执行过程如下：</p>
<div class="fold_area">
		<div class="fold_hider">
			<div class="close hider_title">控制台输出</div>
		</div>
		<div class="fold" style="display:none;">
			<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">三月 19, 2018 6:21:07 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建事务管理器……</span><br><span class="line">三月 19, 2018 6:21:07 下午 bitronix.tm.resource.ResourceLoader init</span><br><span class="line">信息: reading resources configuration from /E:/学习/Hibernate/Workspace/Writing003-sequence/bin/main/datasource.properties</span><br><span class="line">三月 19, 2018 6:21:07 下午 bitronix.tm.resource.ResourceLoader init</span><br><span class="line">信息: reading resources configuration from /E:/学习/Hibernate/Workspace/Writing003-sequence/bin/main/spy-datasource.properties</span><br><span class="line">三月 19, 2018 6:21:07 下午 bitronix.tm.BitronixTransactionManager logVersion</span><br><span class="line">信息: Bitronix Transaction Manager version 2.1.4</span><br><span class="line">三月 19, 2018 6:21:07 下午 bitronix.tm.Configuration buildServerIdArray</span><br><span class="line">信息: JVM unique ID: &lt;myServer1234&gt;</span><br><span class="line">三月 19, 2018 6:21:07 下午 bitronix.tm.resource.ResourceLoader init</span><br><span class="line">信息: reading resources configuration from /E:/学习/Hibernate/Workspace/Writing003-sequence/bin/main/spy-datasource.properties</span><br><span class="line">三月 19, 2018 6:21:07 下午 bitronix.tm.recovery.Recoverer run</span><br><span class="line">信息: recovery committed 0 dangling transaction(s) and rolled back 0 aborted transaction(s) on 2 resource(s) [spyDS, realDS] (restricted to serverId &apos;myServer1234&apos;)</span><br><span class="line">三月 19, 2018 6:21:07 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 事务管理器已创建</span><br><span class="line">三月 19, 2018 6:21:07 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在开始事务……</span><br><span class="line">三月 19, 2018 6:21:07 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 事务已开始</span><br><span class="line">三月 19, 2018 6:21:07 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体管理器……</span><br><span class="line">三月 19, 2018 6:21:07 下午 org.hibernate.jpa.internal.util.LogHelper logPersistenceUnitInformation</span><br><span class="line">INFO: HHH000204: Processing PersistenceUnitInfo [</span><br><span class="line">    name: HelloWorldPU</span><br><span class="line">    …]</span><br><span class="line">三月 19, 2018 6:21:07 下午 org.hibernate.Version logVersion</span><br><span class="line">INFO: HHH000412: Hibernate Core &#123;5.2.12.Final&#125;</span><br><span class="line">三月 19, 2018 6:21:07 下午 org.hibernate.cfg.Environment &lt;clinit&gt;</span><br><span class="line">INFO: HHH000206: hibernate.properties not found</span><br><span class="line">三月 19, 2018 6:21:07 下午 org.hibernate.annotations.common.reflection.java.JavaReflectionManager &lt;clinit&gt;</span><br><span class="line">INFO: HCANN000001: Hibernate Commons Annotations &#123;5.0.1.Final&#125;</span><br><span class="line">三月 19, 2018 6:21:08 下午 org.hibernate.dialect.Dialect &lt;init&gt;</span><br><span class="line">INFO: HHH000400: Using dialect: org.hibernate.dialect.MariaDB53Dialect</span><br><span class="line">三月 19, 2018 6:21:08 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体管理器已创建</span><br><span class="line">三月 19, 2018 6:21:08 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体1……</span><br><span class="line">三月 19, 2018 6:21:08 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体1已创建</span><br><span class="line">三月 19, 2018 6:21:08 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体1……</span><br><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        next_val as id_val </span><br><span class="line">    from</span><br><span class="line">        id_sequence for update</span><br><span class="line">            </span><br><span class="line">三月 19, 2018 6:21:08 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454868998|4|statement|connection0|select next_val as id_val from id_sequence for update</span><br><span class="line">Hibernate: </span><br><span class="line">    update</span><br><span class="line">        id_sequence </span><br><span class="line">    set</span><br><span class="line">        next_val= ? </span><br><span class="line">    where</span><br><span class="line">        next_val=?</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869013|15|statement|connection0|update id_sequence set next_val= 15 where next_val=5</span><br><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        next_val as id_val </span><br><span class="line">    from</span><br><span class="line">        id_sequence for update</span><br><span class="line">            </span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869060|0|statement|connection0|select next_val as id_val from id_sequence for update</span><br><span class="line">Hibernate: </span><br><span class="line">    update</span><br><span class="line">        id_sequence </span><br><span class="line">    set</span><br><span class="line">        next_val= ? </span><br><span class="line">    where</span><br><span class="line">        next_val=?</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869060|0|statement|connection0|update id_sequence set next_val= 25 where next_val=15</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体1已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体2……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体2已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体2……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体2已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体3……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体3已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体3……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体3已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体4……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体4已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体4……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体4已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体5……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体5已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体5……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体5已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体6……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体6已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体6……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体6已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体7……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体7已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体7……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体7已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体8……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体8已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体8……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体8已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体9……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体9已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体9……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体9已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体10……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体10已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体10……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体10已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体11……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体11已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体11……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体11已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体12……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体12已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体12……</span><br><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        next_val as id_val </span><br><span class="line">    from</span><br><span class="line">        id_sequence for update</span><br><span class="line">            </span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869107|0|statement|connection0|select next_val as id_val from id_sequence for update</span><br><span class="line">Hibernate: </span><br><span class="line">    update</span><br><span class="line">        id_sequence </span><br><span class="line">    set</span><br><span class="line">        next_val= ? </span><br><span class="line">    where</span><br><span class="line">        next_val=?</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869107|0|statement|connection0|update id_sequence set next_val= 35 where next_val=25</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体12已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体13……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体13已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体13……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体13已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体14……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体14已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体14……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体14已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体15……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体15已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体15……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体15已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体16……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体16已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体16……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体16已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体17……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体17已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体17……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体17已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体18……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体18已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体18……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体18已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体19……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体19已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体19……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体19已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体20……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体20已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体20……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体20已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体21……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体21已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体21……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体21已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体22……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体22已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体22……</span><br><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        next_val as id_val </span><br><span class="line">    from</span><br><span class="line">        id_sequence for update</span><br><span class="line">            </span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869154|0|statement|connection0|select next_val as id_val from id_sequence for update</span><br><span class="line">Hibernate: </span><br><span class="line">    update</span><br><span class="line">        id_sequence </span><br><span class="line">    set</span><br><span class="line">        next_val= ? </span><br><span class="line">    where</span><br><span class="line">        next_val=?</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869169|11|statement|connection0|update id_sequence set next_val= 45 where next_val=35</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体22已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体23……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体23已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体23……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体23已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体24……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体24已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体24……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体24已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体25……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体25已创建</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体25……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体25已持久化</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在提交事务……</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869216|8|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 1&apos;, 5)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869216|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 2&apos;, 6)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869216|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 3&apos;, 7)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869232|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 4&apos;, 8)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869232|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 5&apos;, 9)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869232|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 6&apos;, 10)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869232|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 7&apos;, 11)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869232|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 8&apos;, 12)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869232|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 9&apos;, 13)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869232|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 10&apos;, 14)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869232|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 11&apos;, 15)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869232|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 12&apos;, 16)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869248|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 13&apos;, 17)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869248|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 14&apos;, 18)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869248|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 15&apos;, 19)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869248|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 16&apos;, 20)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869248|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 17&apos;, 21)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869248|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 18&apos;, 22)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869248|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 19&apos;, 23)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869248|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 20&apos;, 24)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869248|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 21&apos;, 25)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869248|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 22&apos;, 26)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869248|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 23&apos;, 27)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869248|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 24&apos;, 28)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521454869248|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 25&apos;, 29)</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 事务已提交</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在关闭实体管理器……</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体管理器已关闭</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在停止事务管理器……</span><br><span class="line">三月 19, 2018 6:21:09 下午 bitronix.tm.BitronixTransactionManager shutdown</span><br><span class="line">信息: shutting down Bitronix Transaction Manager</span><br><span class="line">三月 19, 2018 6:21:09 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 事务管理器已停止</span><br><span class="line"></span><br></pre></td></tr></table></figure>
	</div>
</div>

<p>从中可以看出，在数据库表刚刚建立的时候，序列表被初始化为初始值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">三月 18, 2018 9:14:00 上午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521335640226|17|statement|connection0|     insert into id_sequence values ( 5 )</span><br><span class="line">……</span><br></pre></td></tr></table></figure>
<p>在持久化第一个实体的实例时，Hibernate会调用序列的自增功能两次（原因待考证）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">三月 18, 2018 9:14:00 上午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体1……</span><br><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        next_val as id_val </span><br><span class="line">    from</span><br><span class="line">        id_sequence for update</span><br><span class="line">            </span><br><span class="line">三月 18, 2018 9:14:00 上午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521335640547|5|statement|connection0|select next_val as id_val from id_sequence for update</span><br><span class="line">Hibernate: </span><br><span class="line">    update</span><br><span class="line">        id_sequence </span><br><span class="line">    set</span><br><span class="line">        next_val= ? </span><br><span class="line">    where</span><br><span class="line">        next_val=?</span><br><span class="line">三月 18, 2018 9:14:00 上午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521335640575|17|statement|connection0|update id_sequence set next_val= 15 where next_val=5</span><br><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        next_val as id_val </span><br><span class="line">    from</span><br><span class="line">        id_sequence for update</span><br><span class="line">            </span><br><span class="line">三月 18, 2018 9:14:00 上午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521335640606|0|statement|connection0|select next_val as id_val from id_sequence for update</span><br><span class="line">Hibernate: </span><br><span class="line">    update</span><br><span class="line">        id_sequence </span><br><span class="line">    set</span><br><span class="line">        next_val= ? </span><br><span class="line">    where</span><br><span class="line">        next_val=?</span><br><span class="line">三月 18, 2018 9:14:00 上午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521335640606|0|statement|connection0|update id_sequence set next_val= 25 where next_val=15</span><br><span class="line">三月 18, 2018 9:14:00 上午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体1已持久化</span><br><span class="line">……</span><br></pre></td></tr></table></figure>
<p>由于序列初始值是5，设置的序列递增值是10，因此第一次更新序列值后，序列的下一个值变为15；第二次更新序列值后，序列的下一个值变为25。此后，每持久化10个实例，序列的下一个值自动更新10。 其生成的主键值，从初始值5开始，并且连续：</p>
<img src="/2018/03/18/hibernate-003/Snipaste_2018-03-19_18-23-26.png" title="运行结果：Message表">
<p>此时，数据库中序列表的内容将变为下一个序列组的开始值45：</p>
<img src="/2018/03/18/hibernate-003/Snipaste_2018-03-19_17-05-31.png" title="运行结果：id_sequence表">
<p>从中可以看出，现在程序只要每持久化10个实体之后才需要从数据库重新获取序列值，降低了访问数据库的频率。那么，是不是allocationSize越大越好呢？因为这样就可以以尽量低的频率去访问数据库。例如，如果allocationSize是1000的话，我们是不是持久化1000个对象才需要访问一次数据库来获取下次序列的起点。</p>
<h3 id="重启服务器后序列值的获取"><a href="#重启服务器后序列值的获取" class="headerlink" title="重启服务器后序列值的获取"></a>重启服务器后序列值的获取</h3><p>可以考虑这样一种情况：当Hibernate缓存的序列缓存值还没用完的时候，系统重启了，由于Hibernate无法记忆自己的缓存值，必须从数据库的序列表中获取下一次序列的起始值，那么没用完的序列缓存之就浪费了，这同时造成了主键的不连贯。直接看代码：</p>
<p>首先将persistence中数据库表的生成模式改为update，这样每次重启程序的时候，就不会删除整个数据库表，重新创建：</p>
<figure class="highlight xml"><figcaption><span>persistence.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">……</span><br></pre></td></tr></table></figure>
<p>上次运行程序时，其初始值为5，插入25个实例之后，其最终主键最大值为5+25-1=29。然后我们再次运行程序，可以看到Message表的情况：</p>
<img src="/2018/03/18/hibernate-003/Snipaste_2018-03-19_18-25-11.png" title="运行结果Message表">
<p>可以看出，其主键值跳过了29，而直接从36开始。其原因在于未使用的序列缓存值一直存在于Hibernate系统中，当重启之后，Hibernate也只能从序列表中恢复序列，因此未使用的序列缓存便无法继续使用。由于持久化第一个实体实例时，序列的值被增加了两次（原因不明），因此实际的缓存值应该要减掉一次间隔值：第一次程序运行完成后，序列表的next_val值为45，实际上下次分配的起始值为35。</p>
<p>从这个例子中可以看出，allocationSize并不是越大越好。如果allocationSize值过大并且程序频繁重启，那么在多次重启程序后，很多缓存的序列值并无法使用，最终序列空间将被耗尽。</p>
<h3 id="两个实体配置同一个序列的不同设置"><a href="#两个实体配置同一个序列的不同设置" class="headerlink" title="两个实体配置同一个序列的不同设置"></a>两个实体配置同一个序列的不同设置</h3><p>下面考虑另外一种特殊情况，两个实体都配置了同一个序列，但是两个实体配置的序列生成器的设置不一样，在这种情况下Hibernate将有什么表现。</p>
<p>Message2实体类的键值生成器改为如下设置：</p>
<figure class="highlight java"><figcaption><span>Message2.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rainsia.hibernate.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.SequenceGenerator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一个简单的实体类</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yu Xia &lt;rainsia@163.com&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>	<span class="comment">//实体类必须使用注解@Entity标记，在实体化这个实体的时候，会创建数据库表Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实体的主键，用来标识一个唯一的实体，</span></span><br><span class="line"><span class="comment">     * 推荐使用Long类型，最好不要使用long原始类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Id</span>	<span class="comment">//每一个实体必须具有一个主键，主键使用@Id注解表示</span></span><br><span class="line">	<span class="meta">@SequenceGenerator</span>(</span><br><span class="line">    	name=<span class="string">"messageGen"</span>,</span><br><span class="line">    	sequenceName=<span class="string">"id_sequence"</span>,</span><br><span class="line">    	initialValue=<span class="number">1</span>,</span><br><span class="line">    	allocationSize=<span class="number">5</span></span><br><span class="line">    )</span><br><span class="line">    <span class="meta">@GeneratedValue</span>(generator=<span class="string">"messageGen"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一个普通的属性，简单属性会在持久化时自动创建数据库列，默认名称和属性名称相同</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//----------getter和setter----------</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setText</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.text = text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//----------------------------------</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后交叉插入两种不同的实体实例：</p>
<figure class="highlight java"><figcaption><span>HelloWorldApp.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rainsia.hibernate.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManager;</span><br><span class="line"><span class="keyword">import</span> javax.transaction.NotSupportedException;</span><br><span class="line"><span class="keyword">import</span> javax.transaction.UserTransaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.env.JpaSetup;</span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.env.TransactionManagerSetup;</span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.model.Message;</span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.model.Message2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldApp</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日志</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(HelloWorldApp.class);</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		TransactionManagerSetup tm = <span class="keyword">null</span>;</span><br><span class="line">		EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			logger.info(<span class="string">"正在创建事务管理器……"</span>);</span><br><span class="line">			tm = <span class="keyword">new</span> TransactionManagerSetup();</span><br><span class="line">			UserTransaction tx = tm.getUserTransaction();</span><br><span class="line">			logger.info(<span class="string">"事务管理器已创建"</span>);</span><br><span class="line">			</span><br><span class="line">			logger.info(<span class="string">"正在开始事务……"</span>);</span><br><span class="line">			tx.begin();							<span class="comment">//开始事务</span></span><br><span class="line">			logger.info(<span class="string">"事务已开始"</span>);</span><br><span class="line">			</span><br><span class="line">			logger.info(<span class="string">"正在创建实体管理器……"</span>);</span><br><span class="line">			JpaSetup jpa = <span class="keyword">new</span> JpaSetup(<span class="string">"HelloWorldPU"</span>);</span><br><span class="line">			em = jpa.createEntityManager();		<span class="comment">//创建实体管理器</span></span><br><span class="line">			logger.info(<span class="string">"实体管理器已创建"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">25</span>; i++) &#123;</span><br><span class="line">				logger.info(<span class="string">"正在创建实体&#123;&#125;……"</span>, i);</span><br><span class="line">				Message message = <span class="keyword">new</span> Message();	<span class="comment">//创建实体</span></span><br><span class="line">				message.setText(<span class="string">"Hello World "</span> + i);</span><br><span class="line">				logger.info(<span class="string">"实体&#123;&#125;已创建"</span>, i);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 保存实体，注意这里仅仅是通知Hibernate需要保存数据，Hibernate此时并不会执行插入数据的SQL</span></span><br><span class="line">				<span class="comment">//	而是等到最后事务提交的时候才执行</span></span><br><span class="line">				logger.info(<span class="string">"正在持久化实体&#123;&#125;……"</span>, i);</span><br><span class="line">				em.persist(message);</span><br><span class="line">				logger.info(<span class="string">"实体&#123;&#125;(id:&#123;&#125;)已持久化"</span>, i, message.getId());</span><br><span class="line">				</span><br><span class="line">				<span class="comment">//=====================================</span></span><br><span class="line">				logger.info(<span class="string">"正在创建实体2,&#123;&#125;……"</span>, i);</span><br><span class="line">				Message2 message2 = <span class="keyword">new</span> Message2();	<span class="comment">//创建实体</span></span><br><span class="line">				message2.setText(<span class="string">"Hello World2 "</span> + i);</span><br><span class="line">				logger.info(<span class="string">"实体2,&#123;&#125;已创建"</span>, i);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 保存实体，注意这里仅仅是通知Hibernate需要保存数据，Hibernate此时并不会执行插入数据的SQL</span></span><br><span class="line">				<span class="comment">//	而是等到最后事务提交的时候才执行</span></span><br><span class="line">				logger.info(<span class="string">"正在持久化实体2,&#123;&#125;……"</span>, i);</span><br><span class="line">				em.persist(message2);</span><br><span class="line">				logger.info(<span class="string">"实体2,&#123;&#125;(id:&#123;&#125;)已持久化"</span>, i, message2.getId());</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 提交事务，此时Hibernate才真正执行insert语句</span></span><br><span class="line">			logger.info(<span class="string">"正在提交事务……"</span>);</span><br><span class="line">			tx.commit(); <span class="comment">// INSERT into MESSAGE (ID, TEXT) values (1, 'Hello World!')</span></span><br><span class="line">			logger.info(<span class="string">"事务已提交"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (NamingException ex) &#123;</span><br><span class="line">			ex.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (NotSupportedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(em != <span class="keyword">null</span> &amp;&amp; em.isOpen()) &#123;</span><br><span class="line">				logger.info(<span class="string">"正在关闭实体管理器……"</span>);</span><br><span class="line">				em.close();</span><br><span class="line">				logger.info(<span class="string">"实体管理器已关闭"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(tm != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					logger.info(<span class="string">"正在停止事务管理器……"</span>);</span><br><span class="line">					tm.stop();</span><br><span class="line">					logger.info(<span class="string">"事务管理器已停止"</span>);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行程序后，可以发现，同一个序列表当中出现了两个不同的列：</p>
<img src="/2018/03/18/hibernate-003/Snipaste_2018-03-19_21-31-49.png" title="运行结果：id_sequence表">
<p>数据的插入情况如下：</p>
<div class="column">
			<p><img src="/2018/03/18/hibernate-003/Snipaste_2018-03-19_21-32-56.png" title="运行结果：Message表"></p>

</div>

<div class="column">
			<p><img src="/2018/03/18/hibernate-003/Snipaste_2018-03-19_21-35-34.png" title="运行结果：Message2表"></p>

</div>

<p>可以看出，如果两个序列生成器，指向同一个表，但是初始值和间隔值均不同，插入数据生成的主键将产生一些奇怪的表现。这种做法实际上是违背JPA标准的。</p>
<p>JPA specification (JSR 338, 11.1.48):</p>
<blockquote><p>The scope of the generator name is global to the persistence unit (across all generator types). </p>
</blockquote>
<p>因此不要通过两个类中申明的序列生成器，配置同一个序列名但是却使用两种不同的配置。但是可以使用两个不同的序列生成器，配置相同的序列名、初始值和间隔值。或者一种更好的方式是使用Hibernate的全局序列生成器。</p>
<h3 id="全局序列生成器"><a href="#全局序列生成器" class="headerlink" title="全局序列生成器"></a>全局序列生成器</h3><p>JPA当中的序列生成器，只能配置到具体的实体类上，无法配置一个生成器供所有类同时使用。然而Hibernate提供了这样的功能，可以将通用生成器@GenericGenerator配置到package-info.java文件中，然后在所有实体类中都可以使用同一个生成器，以避免在不同实体类中配置生成器冲突的情况。</p>
<p>在Hibernate中，@GenericGenerator有三个属性：name, strategy和parameters。</p>
<ol>
<li>name标识了序列的名字。</li>
<li>strategy需要制定一种键生成器策略。Hibernate中提供了大量的键生成器策略。和序列相关的主要是sequence和enhanced-sequence。推荐使用enhanced-sequence，其使用和JPA的SequenceGenerator，可以对生成的序列进行严格的控制。</li>
<li>parameters是一个数组，用于对选定的strategy进行详细的配置。不同的strategy具有不同的参数。对于enhanced-sequence，其配置参数可以参考：<a href="http://docs.jboss.org/hibernate/orm/5.2/javadocs/constant-values.html#org.hibernate.id.enhanced.SequenceStyleGenerator.CONFIG_PREFER_SEQUENCE_PER_ENTITY" target="_blank" rel="noopener">enhanced-sequence</a>。其主要可配置参数有：sequence_name（序列或辅助表的名字）、initial_value（序列初始值）、increment_size（递增值）、value_column（数据列的名字，默认为next_value）。</li>
</ol>
<p>以下程序展示了@GenericGenerator配置序列的例子：</p>
<figure class="highlight java"><figcaption><span>package-info.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置了一个包级别的主键生成器，使用序列名称id_sequence，初始值为5，自增值为10</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yu Xia &lt;rainsia@163.com&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@org</span>.hibernate.annotations.GenericGenerator(</span><br><span class="line">	name=<span class="string">"id_gen"</span>,</span><br><span class="line">	strategy=<span class="string">"enhanced-sequence"</span>,</span><br><span class="line">	parameters= &#123;</span><br><span class="line">			<span class="meta">@org</span>.hibernate.annotations.Parameter(name=<span class="string">"sequence_name"</span>, value=<span class="string">"id_sequence"</span>),</span><br><span class="line">			<span class="meta">@org</span>.hibernate.annotations.Parameter(name=<span class="string">"initial_value"</span>, value=<span class="string">"5"</span>),</span><br><span class="line">			<span class="meta">@org</span>.hibernate.annotations.Parameter(name=<span class="string">"increment_size"</span>, value=<span class="string">"10"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">package</span> com.rainsia.hibernate.model;</span><br></pre></td></tr></table></figure>
<p>随后，<strong>需要将整个package(package-info.java)加入到实体配置中</strong>：</p>
<figure class="highlight xml"><figcaption><span>persistence.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">persistence</span> <span class="attr">version</span>=<span class="string">"2.1"</span></span></span><br></pre></td></tr></table></figure>
<p>然后在定义实体的主键时，引用定义的序列生成器：</p>
<figure class="highlight java"><figcaption><span>Message.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rainsia.hibernate.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.SequenceGenerator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一个简单的实体类</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yu Xia &lt;rainsia@163.com&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>	<span class="comment">//实体类必须使用注解@Entity标记，在实体化这个实体的时候，会创建数据库表Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实体的主键，用来标识一个唯一的实体，</span></span><br><span class="line"><span class="comment">     * 推荐使用Long类型，最好不要使用long原始类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Id</span>	<span class="comment">//每一个实体必须具有一个主键，主键使用@Id注解表示</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(generator=<span class="string">"id_gen"</span>)	<span class="comment">//使用@GenericGenerator的名称来引用</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一个普通的属性，简单属性会在持久化时自动创建数据库列，默认名称和属性名称相同</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------getter和setter----------</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;	<span class="comment">//id只应该有getter方法，而没有setter方法</span></span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setText</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.text = text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//----------------------------------</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>最后想往常一样创建并持久化实体：</p>
<figure class="highlight java"><figcaption><span>HelloWorldApp.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rainsia.hibernate.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManager;</span><br><span class="line"><span class="keyword">import</span> javax.transaction.NotSupportedException;</span><br><span class="line"><span class="keyword">import</span> javax.transaction.UserTransaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.env.JpaSetup;</span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.env.TransactionManagerSetup;</span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.model.Message;</span><br><span class="line"><span class="keyword">import</span> com.rainsia.hibernate.model.Message2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldApp</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日志</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(HelloWorldApp.class);</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		TransactionManagerSetup tm = <span class="keyword">null</span>;</span><br><span class="line">		EntityManager em = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			logger.info(<span class="string">"正在创建事务管理器……"</span>);</span><br><span class="line">			tm = <span class="keyword">new</span> TransactionManagerSetup();</span><br><span class="line">			UserTransaction tx = tm.getUserTransaction();</span><br><span class="line">			logger.info(<span class="string">"事务管理器已创建"</span>);</span><br><span class="line">			</span><br><span class="line">			logger.info(<span class="string">"正在开始事务……"</span>);</span><br><span class="line">			tx.begin();							<span class="comment">//开始事务</span></span><br><span class="line">			logger.info(<span class="string">"事务已开始"</span>);</span><br><span class="line">			</span><br><span class="line">			logger.info(<span class="string">"正在创建实体管理器……"</span>);</span><br><span class="line">			JpaSetup jpa = <span class="keyword">new</span> JpaSetup(<span class="string">"HelloWorldPU"</span>);</span><br><span class="line">			em = jpa.createEntityManager();		<span class="comment">//创建实体管理器</span></span><br><span class="line">			logger.info(<span class="string">"实体管理器已创建"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">25</span>; i++) &#123;</span><br><span class="line">				logger.info(<span class="string">"正在创建实体&#123;&#125;……"</span>, i);</span><br><span class="line">				Message message = <span class="keyword">new</span> Message();	<span class="comment">//创建实体</span></span><br><span class="line">				message.setText(<span class="string">"Hello World "</span> + i);</span><br><span class="line">				logger.info(<span class="string">"实体&#123;&#125;已创建"</span>, i);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 保存实体，注意这里仅仅是通知Hibernate需要保存数据，Hibernate此时并不会执行插入数据的SQL</span></span><br><span class="line">				<span class="comment">//	而是等到最后事务提交的时候才执行</span></span><br><span class="line">				logger.info(<span class="string">"正在持久化实体&#123;&#125;……"</span>, i);</span><br><span class="line">				em.persist(message);</span><br><span class="line">				logger.info(<span class="string">"实体&#123;&#125;(id:&#123;&#125;)已持久化"</span>, i, message.getId());</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 提交事务，此时Hibernate才真正执行insert语句</span></span><br><span class="line">			logger.info(<span class="string">"正在提交事务……"</span>);</span><br><span class="line">			tx.commit(); <span class="comment">// INSERT into MESSAGE (ID, TEXT) values (1, 'Hello World!')</span></span><br><span class="line">			logger.info(<span class="string">"事务已提交"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (NamingException ex) &#123;</span><br><span class="line">			ex.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (NotSupportedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(em != <span class="keyword">null</span> &amp;&amp; em.isOpen()) &#123;</span><br><span class="line">				logger.info(<span class="string">"正在关闭实体管理器……"</span>);</span><br><span class="line">				em.close();</span><br><span class="line">				logger.info(<span class="string">"实体管理器已关闭"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(tm != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					logger.info(<span class="string">"正在停止事务管理器……"</span>);</span><br><span class="line">					tm.stop();</span><br><span class="line">					logger.info(<span class="string">"事务管理器已停止"</span>);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其运行结果和之前的例子一致：</p>
<div class="column">
			<p><img src="/2018/03/18/hibernate-003/Snipaste_2018-03-20_22-34-50.png" title="运行结果：Message表"></p>

</div>

<div class="column">
			<p><img src="/2018/03/18/hibernate-003/Snipaste_2018-03-20_22-58-34.png" title="运行结果：id_sequence表"></p>

</div>

<p>控制台的输出：</p>
<div class="fold_area">
		<div class="fold_hider">
			<div class="close hider_title">控制台输出</div>
		</div>
		<div class="fold" style="display:none;">
			<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br></pre></td><td class="code"><pre><span class="line">三月 20, 2018 10:05:27 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建事务管理器……</span><br><span class="line">三月 20, 2018 10:05:27 下午 bitronix.tm.resource.ResourceLoader init</span><br><span class="line">信息: reading resources configuration from /E:/学习/Hibernate/Workspace/Writing003-sequence/bin/main/datasource.properties</span><br><span class="line">三月 20, 2018 10:05:28 下午 bitronix.tm.resource.ResourceLoader init</span><br><span class="line">信息: reading resources configuration from /E:/学习/Hibernate/Workspace/Writing003-sequence/bin/main/spy-datasource.properties</span><br><span class="line">三月 20, 2018 10:05:28 下午 bitronix.tm.BitronixTransactionManager logVersion</span><br><span class="line">信息: Bitronix Transaction Manager version 2.1.4</span><br><span class="line">三月 20, 2018 10:05:28 下午 bitronix.tm.Configuration buildServerIdArray</span><br><span class="line">信息: JVM unique ID: &lt;myServer1234&gt;</span><br><span class="line">三月 20, 2018 10:05:28 下午 bitronix.tm.resource.ResourceLoader init</span><br><span class="line">信息: reading resources configuration from /E:/学习/Hibernate/Workspace/Writing003-sequence/bin/main/spy-datasource.properties</span><br><span class="line">三月 20, 2018 10:05:28 下午 bitronix.tm.recovery.Recoverer run</span><br><span class="line">信息: recovery committed 0 dangling transaction(s) and rolled back 0 aborted transaction(s) on 2 resource(s) [spyDS, realDS] (restricted to serverId &apos;myServer1234&apos;)</span><br><span class="line">三月 20, 2018 10:05:28 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 事务管理器已创建</span><br><span class="line">三月 20, 2018 10:05:28 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在开始事务……</span><br><span class="line">三月 20, 2018 10:05:28 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 事务已开始</span><br><span class="line">三月 20, 2018 10:05:28 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体管理器……</span><br><span class="line">三月 20, 2018 10:05:28 下午 org.hibernate.jpa.internal.util.LogHelper logPersistenceUnitInformation</span><br><span class="line">INFO: HHH000204: Processing PersistenceUnitInfo [</span><br><span class="line">    name: HelloWorldPU</span><br><span class="line">    …]</span><br><span class="line">三月 20, 2018 10:05:28 下午 org.hibernate.Version logVersion</span><br><span class="line">INFO: HHH000412: Hibernate Core &#123;5.2.12.Final&#125;</span><br><span class="line">三月 20, 2018 10:05:28 下午 org.hibernate.cfg.Environment &lt;clinit&gt;</span><br><span class="line">INFO: HHH000206: hibernate.properties not found</span><br><span class="line">三月 20, 2018 10:05:28 下午 org.hibernate.annotations.common.reflection.java.JavaReflectionManager &lt;clinit&gt;</span><br><span class="line">INFO: HCANN000001: Hibernate Commons Annotations &#123;5.0.1.Final&#125;</span><br><span class="line">三月 20, 2018 10:05:29 下午 org.hibernate.dialect.Dialect &lt;init&gt;</span><br><span class="line">INFO: HHH000400: Using dialect: org.hibernate.dialect.MariaDB53Dialect</span><br><span class="line">Hibernate: </span><br><span class="line">    </span><br><span class="line">    drop table if exists id_sequence</span><br><span class="line">三月 20, 2018 10:05:29 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554729894|122|statement|connection0|     drop table if exists id_sequence</span><br><span class="line">Hibernate: </span><br><span class="line">    </span><br><span class="line">    drop table if exists Message</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730027|140|statement|connection0|     drop table if exists Message</span><br><span class="line">Hibernate: </span><br><span class="line">    </span><br><span class="line">    create table id_sequence (</span><br><span class="line">       next_val bigint</span><br><span class="line">    ) engine=InnoDB</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730183|140|statement|connection0|     create table id_sequence (        next_val bigint     ) engine=InnoDB</span><br><span class="line">Hibernate: </span><br><span class="line">    </span><br><span class="line">    insert into id_sequence values ( 5 )</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730199|19|statement|connection0|     insert into id_sequence values ( 5 )</span><br><span class="line">Hibernate: </span><br><span class="line">    </span><br><span class="line">    create table Message (</span><br><span class="line">       id bigint not null,</span><br><span class="line">        text varchar(255),</span><br><span class="line">        primary key (id)</span><br><span class="line">    ) engine=InnoDB</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730386|189|statement|connection0|     create table Message (        id bigint not null,         text varchar(255),         primary key (id)     ) engine=InnoDB</span><br><span class="line">三月 20, 2018 10:05:30 下午 org.hibernate.tool.schema.internal.SchemaCreatorImpl applyImportSources</span><br><span class="line">INFO: HHH000476: Executing import script &apos;org.hibernate.tool.schema.internal.exec.ScriptSourceInputNonExistentImpl@424fd310&apos;</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体管理器已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体1……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体1已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体1……</span><br><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        next_val as id_val </span><br><span class="line">    from</span><br><span class="line">        id_sequence for update</span><br><span class="line">            </span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730574|29|statement|connection0|select next_val as id_val from id_sequence for update</span><br><span class="line">Hibernate: </span><br><span class="line">    update</span><br><span class="line">        id_sequence </span><br><span class="line">    set</span><br><span class="line">        next_val= ? </span><br><span class="line">    where</span><br><span class="line">        next_val=?</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730620|43|statement|connection0|update id_sequence set next_val= 15 where next_val=5</span><br><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        next_val as id_val </span><br><span class="line">    from</span><br><span class="line">        id_sequence for update</span><br><span class="line">            </span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730652|0|statement|connection0|select next_val as id_val from id_sequence for update</span><br><span class="line">Hibernate: </span><br><span class="line">    update</span><br><span class="line">        id_sequence </span><br><span class="line">    set</span><br><span class="line">        next_val= ? </span><br><span class="line">    where</span><br><span class="line">        next_val=?</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730668|0|statement|connection0|update id_sequence set next_val= 25 where next_val=15</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体1(id:5)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体2……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体2已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体2……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体2(id:6)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体3……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体3已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体3……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体3(id:7)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体4……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体4已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体4……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体4(id:8)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体5……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体5已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体5……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体5(id:9)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体6……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体6已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体6……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体6(id:10)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体7……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体7已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体7……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体7(id:11)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体8……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体8已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体8……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体8(id:12)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体9……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体9已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体9……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体9(id:13)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体10……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体10已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体10……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体10(id:14)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体11……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体11已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体11……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体11(id:15)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体12……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体12已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体12……</span><br><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        next_val as id_val </span><br><span class="line">    from</span><br><span class="line">        id_sequence for update</span><br><span class="line">            </span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730730|0|statement|connection0|select next_val as id_val from id_sequence for update</span><br><span class="line">Hibernate: </span><br><span class="line">    update</span><br><span class="line">        id_sequence </span><br><span class="line">    set</span><br><span class="line">        next_val= ? </span><br><span class="line">    where</span><br><span class="line">        next_val=?</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730730|0|statement|connection0|update id_sequence set next_val= 35 where next_val=25</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体12(id:16)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体13……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体13已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体13……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体13(id:17)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体14……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体14已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体14……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体14(id:18)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体15……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体15已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体15……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体15(id:19)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体16……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体16已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体16……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体16(id:20)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体17……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体17已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体17……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体17(id:21)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体18……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体18已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体18……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体18(id:22)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体19……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体19已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体19……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体19(id:23)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体20……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体20已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体20……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体20(id:24)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体21……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体21已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体21……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体21(id:25)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体22……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体22已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体22……</span><br><span class="line">Hibernate: </span><br><span class="line">    select</span><br><span class="line">        next_val as id_val </span><br><span class="line">    from</span><br><span class="line">        id_sequence for update</span><br><span class="line">            </span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730781|0|statement|connection0|select next_val as id_val from id_sequence for update</span><br><span class="line">Hibernate: </span><br><span class="line">    update</span><br><span class="line">        id_sequence </span><br><span class="line">    set</span><br><span class="line">        next_val= ? </span><br><span class="line">    where</span><br><span class="line">        next_val=?</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730781|0|statement|connection0|update id_sequence set next_val= 45 where next_val=35</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体22(id:26)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体23……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体23已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体23……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体23(id:27)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体24……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体24已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体24……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体24(id:28)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在创建实体25……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体25已创建</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在持久化实体25……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体25(id:29)已持久化</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在提交事务……</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730813|1|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 1&apos;, 5)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730828|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 2&apos;, 6)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730828|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 3&apos;, 7)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730828|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 4&apos;, 8)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730828|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 5&apos;, 9)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730828|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 6&apos;, 10)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730828|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 7&apos;, 11)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730828|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 8&apos;, 12)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730828|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 9&apos;, 13)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730828|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 10&apos;, 14)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730828|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 11&apos;, 15)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730828|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 12&apos;, 16)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730828|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 13&apos;, 17)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730844|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 14&apos;, 18)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730844|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 15&apos;, 19)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730844|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 16&apos;, 20)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730844|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 17&apos;, 21)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730844|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 18&apos;, 22)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730844|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 19&apos;, 23)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730844|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 20&apos;, 24)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730844|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 21&apos;, 25)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730844|2|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 22&apos;, 26)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730859|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 23&apos;, 27)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730859|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 24&apos;, 28)</span><br><span class="line">Hibernate: </span><br><span class="line">    /<em> insert com.rainsia.hibernate.model.Message</em></span><br><span class="line">        / insert </span><br><span class="line">        into</span><br><span class="line">            Message</span><br><span class="line">            (text, id) </span><br><span class="line">        values</span><br><span class="line">            (?, ?)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.p6spy.engine.spy.appender.Slf4JLogger logSQL</span><br><span class="line">信息: 1521554730859|0|statement|connection0|/<em> insert com.rainsia.hibernate.model.Message </em>/ insert into Message (text, id) values (&apos;Hello World 25&apos;, 29)</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 事务已提交</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在关闭实体管理器……</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 实体管理器已关闭</span><br><span class="line">三月 20, 2018 10:05:30 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 正在停止事务管理器……</span><br><span class="line">三月 20, 2018 10:05:30 下午 bitronix.tm.BitronixTransactionManager shutdown</span><br><span class="line">信息: shutting down Bitronix Transaction Manager</span><br><span class="line">三月 20, 2018 10:05:31 下午 com.rainsia.hibernate.app.HelloWorldApp main</span><br><span class="line">信息: 事务管理器已停止</span><br><span class="line"></span><br></pre></td></tr></table></figure>

	</div>
</div>

<p>从中可以看出，其运行过程完全和之前一致。但是却是使用的全局序列。全局序列只要在包中定义一次，在所有实体中都可以共享。</p>
<p>如果序列的名字比较复杂，例如：”my_unique_id_fancy_generator_start_from_five”，那么在很多地方引用的时候容易输错，我们可以引入字符串常量来避免出错的概率：</p>
<figure class="highlight java"><figcaption><span>Constants.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rainsia.hibernate.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ID_GEN = <span class="string">"my_unique_id_fancy_generator_start_from_five"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后在引用序列名的地方，直接使用常量Constants.ID_GEN：</p>
<figure class="highlight java"><figcaption><span>package-info.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置了一个包级别的主键生成器，使用序列名称id_sequence，初始值为5，自增值为10</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yu Xia &lt;rainsia@163.com&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@org</span>.hibernate.annotations.GenericGenerator(</span><br><span class="line">	name=Constants.ID_GEN,</span><br><span class="line">	strategy=<span class="string">"enhanced-sequence"</span>,</span><br><span class="line">	parameters= &#123;</span><br><span class="line">			<span class="meta">@org</span>.hibernate.annotations.Parameter(name=<span class="string">"sequence_name"</span>, value=<span class="string">"id_sequence"</span>),</span><br><span class="line">			<span class="meta">@org</span>.hibernate.annotations.Parameter(name=<span class="string">"initial_value"</span>, value=<span class="string">"5"</span>),</span><br><span class="line">			<span class="meta">@org</span>.hibernate.annotations.Parameter(name=<span class="string">"increment_size"</span>, value=<span class="string">"10"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">package</span> com.rainsia.hibernate.model;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>Message.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rainsia.hibernate.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.SequenceGenerator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一个简单的实体类</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Yu Xia &lt;rainsia@163.com&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>	<span class="comment">//实体类必须使用注解@Entity标记，在实体化这个实体的时候，会创建数据库表Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实体的主键，用来标识一个唯一的实体，</span></span><br><span class="line"><span class="comment">     * 推荐使用Long类型，最好不要使用long原始类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Id</span>	<span class="comment">//每一个实体必须具有一个主键，主键使用@Id注解表示</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(generator=Constants.ID_GEN)	<span class="comment">//使用@GenericGenerator的名称来引用</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一个普通的属性，简单属性会在持久化时自动创建数据库列，默认名称和属性名称相同</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------getter和setter----------</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;	<span class="comment">//id只应该有getter方法，而没有setter方法</span></span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setText</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.text = text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//----------------------------------</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>至此，我们已经找到一种比较合适的主键生成方式，并且推荐了基于这种生成方式的一种最佳实践。</p>

      
    </div>

    

    
    
    

    

    

		<div>
					
						
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2018/03/18/hibernate-003/">Hibernate学习笔记（三）Hibernate中的主键 之 Sequence</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 Rain Sia <rainsia@163.com> 的个人博客">Rain Sia <rainsia@163.com></a></p>
  <p><span>发布时间:</span>2018年03月18日 - 22:03</p>
  <p><span>最后更新:</span>2018年10月20日 - 19:10</p>
  <p><span>原始链接:</span><a href="/2018/03/18/hibernate-003/" title="Hibernate学习笔记（三）Hibernate中的主键 之 Sequence">http://rainsia.gitee.io//2018/03/18/hibernate-003/</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://rainsia.gitee.io/2018/03/18/hibernate-003/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>版权信息:</span>本文为作者原创文章，如需进行非商业性转载，请注明出处并保留原文链接及作者。如要进行商业性转载，请获得作者授权！</p>  
  <p><span>联系方式:</span>rainsia@163.com</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
      $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
        });
    });  
</script>


					
		</div>

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Hibernate/" rel="tag"># Hibernate</a>
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/JPA/" rel="tag"># JPA</a>
          
            <a href="/tags/Primary-Key/" rel="tag"># Primary Key</a>
          
            <a href="/tags/GeneratedValue/" rel="tag"># GeneratedValue</a>
          
            <a href="/tags/Id/" rel="tag"># Id</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/17/hibernate-002/" rel="next" title="Hibernate学习笔记（二）记录生成SQL中的参数">
                <i class="fa fa-chevron-left"></i> Hibernate学习笔记（二）记录生成SQL中的参数
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/30/ns3-001/" rel="prev" title="NS-3学习笔记（一）：NS-3的运行环境搭建">
                NS-3学习笔记（一）：NS-3的运行环境搭建 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="Rain Sia <rainsia@163.com>" />
            
              <p class="site-author-name" itemprop="name">Rain Sia <rainsia@163.com></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">32</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#为实体设置主键"><span class="nav-number">1.</span> <span class="nav-text">为实体设置主键</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#键生成器"><span class="nav-number">2.</span> <span class="nav-text">键生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用JPA键生成器"><span class="nav-number">2.1.</span> <span class="nav-text">使用JPA键生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#用SEQUENCE生成主键"><span class="nav-number">2.1.1.</span> <span class="nav-text">用SEQUENCE生成主键</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定制SEQUENCE"><span class="nav-number">2.1.2.</span> <span class="nav-text">定制SEQUENCE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重启服务器后序列值的获取"><span class="nav-number">2.1.3.</span> <span class="nav-text">重启服务器后序列值的获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#两个实体配置同一个序列的不同设置"><span class="nav-number">2.1.4.</span> <span class="nav-text">两个实体配置同一个序列的不同设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全局序列生成器"><span class="nav-number">2.1.5.</span> <span class="nav-text">全局序列生成器</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rain Sia, All rights reversed.<br/>本站所有原创文章，如进行非商业目的转载，请注明出处。若要进行商业目的转载，必须取得授权。<br/>--作者</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.5.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Gemini</a> v6.4.2</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'KSHKjGm3HfpWAPzaHoA4NV0H-gzGzoHsz',
        appKey: '55JA7fexBRQej1dHDpuxfTA0',
        placeholder: 'Just go go',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: false
    });
  </script>



  





  

  

  

  
  

  
  

  


  
  

  

  

  

  

  

</body>
</html>
