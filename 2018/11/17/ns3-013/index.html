<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="本章主要介绍NS-3当中的（伪）随机数生成器。NS-3提供了简单方便的随机数类型，可以生成各种分布的随机数。随机数生成器也属于NS-3对象框架的类，适用一切对象框架中的特性。此外，随机数可以作为属性值，并且方便地从字符串创建。为了生成互不相交的随机数序列，NS-3使用了随机数流的概念，保证不同的随机数生成器的实例当中，生成的随机数尽量不存在相互交叉的情况。">
<meta name="keywords" content="NS-3,C++,Simulation,Random Number,Random Variable,RandomStream">
<meta property="og:type" content="article">
<meta property="og:title" content="NS-3学习笔记（十三）：随机数生成器">
<meta property="og:url" content="http://rainsia.gitee.io/2018/11/17/ns3-013/index.html">
<meta property="og:site_name" content="Rain&#39;s Blog">
<meta property="og:description" content="本章主要介绍NS-3当中的（伪）随机数生成器。NS-3提供了简单方便的随机数类型，可以生成各种分布的随机数。随机数生成器也属于NS-3对象框架的类，适用一切对象框架中的特性。此外，随机数可以作为属性值，并且方便地从字符串创建。为了生成互不相交的随机数序列，NS-3使用了随机数流的概念，保证不同的随机数生成器的实例当中，生成的随机数尽量不存在相互交叉的情况。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://rainsia.gitee.io/2018/11/17/ns3-013/uniform.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/11/17/ns3-013/constant.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/11/17/ns3-013/sequential.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/11/17/ns3-013/normal.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/11/17/ns3-013/exponential.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/11/17/ns3-013/pareto.png">
<meta property="og:image" content="http://rainsia.gitee.io/2018/11/17/ns3-013/geometric.png">
<meta property="og:updated_time" content="2018-11-21T13:48:04.260Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NS-3学习笔记（十三）：随机数生成器">
<meta name="twitter:description" content="本章主要介绍NS-3当中的（伪）随机数生成器。NS-3提供了简单方便的随机数类型，可以生成各种分布的随机数。随机数生成器也属于NS-3对象框架的类，适用一切对象框架中的特性。此外，随机数可以作为属性值，并且方便地从字符串创建。为了生成互不相交的随机数序列，NS-3使用了随机数流的概念，保证不同的随机数生成器的实例当中，生成的随机数尽量不存在相互交叉的情况。">
<meta name="twitter:image" content="http://rainsia.gitee.io/2018/11/17/ns3-013/uniform.png">






  <link rel="canonical" href="http://rainsia.gitee.io/2018/11/17/ns3-013/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>NS-3学习笔记（十三）：随机数生成器 | Rain's Blog</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?9d1df7de5bd3ea1d75446764f5075fe7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Rain's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">记录、分享、技术</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rainsia.gitee.io/2018/11/17/ns3-013/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rain Sia <rainsia@163.com>">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rain's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">NS-3学习笔记（十三）：随机数生成器
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-11-17 23:38:50" itemprop="dateCreated datePublished" datetime="2018-11-17T23:38:50+08:00">2018-11-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-11-21 21:48:04" itemprop="dateModified" datetime="2018-11-21T21:48:04+08:00">2018-11-21</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/network/" itemprop="url" rel="index"><span itemprop="name">网络</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/network/simulation/" itemprop="url" rel="index"><span itemprop="name">仿真</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/network/simulation/NS-3/" itemprop="url" rel="index"><span itemprop="name">NS-3</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/11/17/ns3-013/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2018/11/17/ns3-013/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon"
            >
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本章主要介绍NS-3当中的（伪）随机数生成器。NS-3提供了简单方便的随机数类型，可以生成各种分布的随机数。随机数生成器也属于NS-3对象框架的类，适用一切对象框架中的特性。此外，随机数可以作为属性值，并且方便地从字符串创建。为了生成互不相交的随机数序列，NS-3使用了随机数流的概念，保证不同的随机数生成器的实例当中，生成的随机数尽量不存在相互交叉的情况。</p>
<a id="more"></a>
<h1 id="1-伪随机数生成器概述"><a href="#1-伪随机数生成器概述" class="headerlink" title="1. 伪随机数生成器概述"></a>1. 伪随机数生成器概述</h1><p>NS-3网络仿真依赖大量的随机数。曾有研究表明，一次相当规模的网络仿真当中，50%的CPU都贡献于生成随机数。好的随机数的生成，依赖于非常复杂的算法。这些算法所生成的随机数序列都是确定的，因此这些方法都被称为伪随机。</p>
<p>这些随机数生成器需要设置不同的随机数种子来保证运行的时候产生不同的随机数序列。如果两次运行设置的随机数种子相同，那么这两次运行所产生的随机数序列将是完全相同的。因此从某种意义上来说，随机数生成器的随机性是靠随机数种子来实现的。</p>
<p>我们可以从以下几个方面来衡量一个随机数生成器的好坏：</p>
<ul>
<li>能否通过随机数种子或者其他方式，控制随机数生成序列的确定性。</li>
<li>能否获得彼此独立的随机数序列。</li>
<li>要生存多少随机数之后才能够产生重复的随机数。</li>
</ul>
<p>下面将分别介绍这三点的概念。</p>
<h2 id="1-1-确定的随机数序列"><a href="#1-1-确定的随机数序列" class="headerlink" title="1.1. 确定的随机数序列"></a>1.1. 确定的随机数序列</h2><p>这一点咋看起来，其实非常的矛盾，甚至有些荒谬。既然我们需要的是随机数，那为何还需要生成确定的序列？换句话说，为何我们要让每次生成的随机数序列全都确定下来？这有没有失去和技术生存的意义？</p>
<p>对于这一点的需求，实际上是为了我们程序调试方便。有时候我们运行仿真的时，发现程序里面有一个错误（或者结果跟我们预期的不一致）。而有时候这种错误具有随机性，在有的配置下会产生这种错误，该有的配置下不会产生这种错误。如果我们每次运行程序，随机数生成器生成的序列都不一样，那么程序将是无法调试的，我们很可能永远也找不到曾经出现过的错误，或者是要运行很多次程序，才能找到曾经出现过的错误。例如我们在运行网络仿真的时候，发现有一个节点发出的数据非常的奇怪，我们可以在运行仿真的时候，记录下这个节点的编号，试图让程序在这个节点上输出一些中间结果，用以判断程序哪里出现问题。如果我们使用的随机数序列每次都不一样，那么很可能下一次出现异常的节点和上一次的不是同一个，这就使得我们的程序调试将非常的困难。</p>
<p>大部分的随机数生成器要做到这一点都不难，只要两次运行的程序设置同一个随机数种子，那么两次生成的随机数序列将是完全相同的。</p>
<h2 id="1-2-独立的随机数序列"><a href="#1-2-独立的随机数序列" class="headerlink" title="1.2. 独立的随机数序列"></a>1.2. 独立的随机数序列</h2><p>既然随机数生成的序列都是一样的，那么我们在仿真当中能不能方便地获得不同的随机数序列呢？例如，在仿真当中，不同节点发送数据的时候，发送时间间隔是一个随机数的话，如果这些随机数都生成相同的序列，那么这些节点将完全同步，即在同一时间发送数据，在同一时间停止发送。这肯定不是我们期望的结果。</p>
<p>当然，我们可以选择给不同节点的随机数生成器设置不同的种子。但这会带来几个问题：</p>
<ol>
<li>不是所有随机数生成器都支持，给每一个实例设置不同的种子。有的随机数生成方法，只支持一个全局种子。</li>
<li>即便是我们可以给不同的随机数生成器实例设置不同的种子，我们也无法保证这两个种子生成的随机数序列完全不同，有时候，两个不同的随机数种子生成的序列可能会局部相互重复。</li>
<li>结合上一条，我们要重复一次实验，需要将所有随机数生成器的种子设置为一样的。当我们需要生成不同的结果的时候，又需要修改所有随机数生成器的种子值。</li>
</ol>
<p>因此我们期望有一种简单的方式，来保证不同的随机数生成器能够产生相互独立的随机数序列。</p>
<h2 id="1-3-随机数的周期"><a href="#1-3-随机数的周期" class="headerlink" title="1.3. 随机数的周期"></a>1.3. 随机数的周期</h2><p>大部分的随机数生成器，都只能生成预定的随机数序列。而这个序列是有一定长度的。一个随机数所能生成的，最大的随机数序列长度，被称为随机数的周期（cycle或者period）。在我们生成随机数的数量，超过随机数的周期时，这个序列将重复已经生成过的值。因此我们一般希望随机数周期足够的长。</p>
<p>如果能够提供一个周期足够长的随机数生成算法，那么第二个问题就将迎刃而解。例如，我们有一个周期足够长的随机数生成器，它能够生成的不重叠的随机数序列（流stream）的长度为N。那么我们可以将这个序列划分为m段，每一段称为一个子序列（或者子流substream）。因此，我们可以保证子序列和子序列之间，不会重叠，相互独立。</p>
<h1 id="2-NS-3的随机数生成器"><a href="#2-NS-3的随机数生成器" class="headerlink" title="2. NS-3的随机数生成器"></a>2. NS-3的随机数生成器</h1><p>NS-3使用的随机数生成算法是加拿大蒙特利尔大学教授Pierre L’Ecuyer提出的MRG32k3a生成器（具体原理可以看<a href="http://www.iro.umontreal.ca/~lecuyer/myftp/papers/streams00.pdf" target="_blank" rel="noopener">这里</a>）。它能够生成的随机数序列的周期为$3.7\times 10^{57}$。这个周期是什么概念？夸张一点，假设我们可以一纳秒生成一个随机数，那么要达到这个周期需要约$1.189\times 10^{41}$年。可以对比的是根据大爆炸理论，现在宇宙的年龄为$1.382\times 10^{10}$……到宇宙毁灭都用不完这么多随机数啊。因此，我们可以将这么长的序列分成多段，形成不同的子流。L’Ecuyer等人将随机数流划分为$1.8\times 10^{19}$个相互独立的流，而每个流又划分为$2.3\times 10^{15}$，每个子流的长度为$7.6\times 10^{22}$。需要$2.443\times 10^{6}$年，即约20万年可以用完这个随机数子流。</p>
<p>因此，对于上面提到的三个衡量准则，该算法：</p>
<ul>
<li>可以选择不同的流来获得随机性，同时，可以固定一个流来获得确定性。</li>
<li>对于一个特定的流，不同的随机数生成器实例可以选择不同的子流来保证相互的独立性。</li>
<li>随机数生成器的周期长到可以为所欲为。</li>
</ul>
<p>如果你足够细心的话可能还记得我们在配置路径一章提到过NS-3提供了5个全局属性。其中和随机数生成的属性一个有两个：RngSeed和RngRun。其中RngSeed即表示随机数种子。随机数的种子设置不同的值的话，可以保证随机数生成不同的序列，这可以用以保证随机性。但如果需要重复相同的程序结果，可以保持随机数种子不变，以保证确定性。除此之外，NS-3还提供了另外一个属性RngRun，通过修改这个参数，也可以改变随机数序列的随机性。那么这两个属性究竟有什么联系和区别呢？</p>
<p>使用RngSeed和RunRun的一种典型的情况是对某个特定的仿真过程进行多次独立试验。以便根据大量的独立运行结果来计算统计信息。用户可以改变全局种子并再次运行该模拟过程，也可以推进随机数的流的状态,这被称为增加运行次数（run number）。</p>
<p>那么设置新的种子和推进子流的状态,哪一个更好?当改变随机数种子的时候，我们无法保证流产生的两个随机种子不是互相重叠的，即两个不同的种子生成的随机数之间可能有一部分是相互重叠的。保证两个流不互相重叠的唯一办法是使用由生成算法实现提供的子流功能。使用子流功能来实现同一个模拟过程的多个彼此独立的运行。从统计意义上来说，设置独立的重复实验更严格的方法应该是使用固定的种子并改变运行次数（RngRun）。使用子流时，独立的重复实验的最大值为$2.3×10^{15}$（因为每个流只有这么多个子流）。</p>
<p>总结：不同的随机数生成器实例对应不同的流，因此，各个生成器实例之间的随机数序列是相互独立的。不同的运行次数之间，某个生成器实例又使用不同的子流，因此，可以保证每个生成器实例在每次运行之间生成的随机数序列是独立的。因此更加推荐在重复的多次仿真当中使用运行次数的推进。</p>
<p>除了设置全局属性之外，NS-3提供了另外一种方法来设置随机数的种子和运行次数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RngSeedManager::SetSeed (<span class="number">3</span>);  <span class="comment">// Changes seed from default of 1 to 3</span></span><br><span class="line">RngSeedManager::SetRun (<span class="number">7</span>);   <span class="comment">// Changes run number from default of 1 to 7</span></span><br></pre></td></tr></table></figure>
<p>这和设置全局属性的效果是一样的。当然，设置随机数种子和运行次数需要在程序刚开始创建任何随机变量之前进行。</p>
<p>当然这种方式每次修改种子和运行次数之后都会引起程序重新编译。由于RngSeed和RngRun都是全局属性，因此，我们也可以使用命令行一章介绍的方法来通过命令行参数修改他们的值：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./waf --command-<span class="keyword">template</span>=<span class="string">"%s --RngSeed=3 --RngRun=7"</span> --run program-name</span><br></pre></td></tr></table></figure>
<p>这种方式无论多少次修改随机数种子或者运行次数都不会引起程序重新编译。</p>
<h2 id="2-1-RandomVariableStream"><a href="#2-1-RandomVariableStream" class="headerlink" title="2.1. RandomVariableStream"></a>2.1. RandomVariableStream</h2><p>NS-3当中所有的随机数生成器，都继承自一个基类RandomVariableStream。这个类主要实现了上面提到的MRG32k3a模型。除此之外，它还包含一个非常重要的属性Stream：</p>
<figure class="highlight cpp"><figcaption><span>random-variable-stream.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> TypeId tid = TypeId (<span class="string">"ns3::RandomVariableStream"</span>)</span><br><span class="line">  .SetParent&lt;Object&gt; ()</span><br><span class="line">  .SetGroupName (<span class="string">"Core"</span>)</span><br><span class="line">  .AddAttribute(<span class="string">"Stream"</span>,</span><br><span class="line">  <span class="string">"The stream number for this RNG stream. -1 means \"allocate a stream automatically\". "</span></span><br><span class="line">  <span class="string">"Note that if -1 is set, Get will return -1 so that it is not possible to know which "</span></span><br><span class="line">  <span class="string">"value was automatically allocated."</span>,</span><br><span class="line">  IntegerValue(<span class="number">-1</span>),</span><br><span class="line">  MakeIntegerAccessor(&amp;RandomVariableStream::SetStream,</span><br><span class="line">		      &amp;RandomVariableStream::GetStream),</span><br><span class="line">  MakeIntegerChecker&lt;<span class="keyword">int64_t</span>&gt;())</span><br><span class="line">  .AddAttribute(<span class="string">"Antithetic"</span>, <span class="string">"Set this RNG stream to generate antithetic values"</span>,</span><br><span class="line">  BooleanValue (<span class="literal">false</span>),</span><br><span class="line">  MakeBooleanAccessor(&amp;RandomVariableStream::SetAntithetic,</span><br><span class="line">		      &amp;RandomVariableStream::IsAntithetic),</span><br><span class="line">  MakeBooleanChecker())</span><br><span class="line">  ;</span><br></pre></td></tr></table></figure>
<p>Stream属性设置不同的值保证了不同的随机数生成器实例之间生成的随机数序列相互独立。该属性的值默认为-1，表示由系统自动分配。每次生成一个随机数实例的时候，其属性值自动加1。由上面的介绍可知，该随机数生成模型预留的流的数量非常多，因此在NS-3当中，将所有的流分为两段。流编号小于等于$2^{63}-1$的流是交给系统自动分配用的；而流编号在$2^{63}$到$2^{64}-1$的流交给用户自主分配。</p>
<p>用户自主分配留编号和系统自动分配流编号，最大的区别就是生成随机数的确定性。因为系统自动分配是按随机数生成的先后顺序自动加1，如果改变了随机数生成器的创建顺序，那么有可能造成，随机数生生成器分配的流编号和上次分配的有不一样，不利于代码调试，但是使用方便。而自动分配可以确保，每次分配的流编号是一样的，但是分配起来较为复杂。具体使用哪种看要需求而定。</p>
<p>其另外一个属性Antithetic，在不同的子类当中的含义不同。当这个属性设置为false（默认）的时候，它将按照正常的分布来生成随机数。而当它被设置为true的时候，会生成特殊的随机数。这个需要看具体随机分布对其的定义。</p>
<p>除了通用的属性之外，RandomVariableStream类还定义了两个虚方法：</p>
<figure class="highlight cpp"><figcaption><span>random-variable-stream.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomVariableStream</span> :</span> <span class="keyword">public</span> Object</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">double</span> <span class="title">GetValue</span> <span class="params">(<span class="keyword">void</span>)</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> uint32_t <span class="title">GetInteger</span> <span class="params">(<span class="keyword">void</span>)</span> </span>= <span class="number">0</span>;</span><br><span class="line">  ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这两个方法都有子类来实现，一个用于生成浮点数，另一个用于生成整数，具体使用哪一个，要视随机数生成器的类型而定。一般子类还会提供额外的方法。</p>
<p>下面介绍一些RandomVariableStream常用的子类来实现各种不同的随机数分布。</p>
<h2 id="2-2-UniformRandomVariable"><a href="#2-2-UniformRandomVariable" class="headerlink" title="2.2. UniformRandomVariable"></a>2.2. UniformRandomVariable</h2><p>UniformRandomVariable主要用于生成均匀分布的随机数。均匀分布是所有随机分部当中最简单的一种。</p>
<p>UniformRandomVariable类当中定义了两个属性Min和Max:</p>
<figure class="highlight cpp"><figcaption><span>random-variable-stream.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">TypeId </span><br><span class="line">UniformRandomVariable::GetTypeId (<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">static</span> TypeId tid = TypeId (<span class="string">"ns3::UniformRandomVariable"</span>)</span><br><span class="line">    .SetParent&lt;RandomVariableStream&gt;()</span><br><span class="line">    .SetGroupName (<span class="string">"Core"</span>)</span><br><span class="line">    .AddConstructor&lt;UniformRandomVariable&gt; ()</span><br><span class="line">    .AddAttribute(<span class="string">"Min"</span>, <span class="string">"The lower bound on the values returned by this RNG stream."</span>,</span><br><span class="line">		  DoubleValue(<span class="number">0</span>),</span><br><span class="line">		  MakeDoubleAccessor(&amp;UniformRandomVariable::m_min),</span><br><span class="line">		  MakeDoubleChecker&lt;<span class="keyword">double</span>&gt;())</span><br><span class="line">    .AddAttribute(<span class="string">"Max"</span>, <span class="string">"The upper bound on the values returned by this RNG stream."</span>,</span><br><span class="line">		  DoubleValue(<span class="number">1.0</span>),</span><br><span class="line">		  MakeDoubleAccessor(&amp;UniformRandomVariable::m_max),</span><br><span class="line">		  MakeDoubleChecker&lt;<span class="keyword">double</span>&gt;())</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">return</span> tid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这两个值限制了生成的随机数的范围：</p>
<ul>
<li>对于整型数，其取值范围是：$[Min, Max]$</li>
<li>对于浮点数，其取值范围是：$[Min, Max)$</li>
</ul>
<p>其数学期望为：$E(X)=(Min+Max)/2$。方差为：$D(x)=(b-a)^{2}/12$。</p>
<p>下面通过一个简单的例子来解释，均匀分布随机变量的使用方法：</p>
<figure class="highlight cpp"><figcaption><span>try-uniform-random.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line">NS_LOG_COMPONENT_DEFINE (<span class="string">"TryUniformRandom"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> </span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">  LogComponentEnable(<span class="string">"TryUniformRandom"</span>, LOG_LEVEL_INFO);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MIN = <span class="number">0.0</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MAX = <span class="number">10.0</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> MAX_NUMBERS = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;UniformRandomVariable&gt; x = CreateObject&lt;UniformRandomVariable&gt; ();</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Min"</span>, DoubleValue (MIN));</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Max"</span>, DoubleValue (MAX));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; MAX_NUMBERS; i++) &#123;</span><br><span class="line">    <span class="keyword">double</span> value = x-&gt;GetValue ();</span><br><span class="line">    NS_LOG_INFO(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Simulator::Run ();</span><br><span class="line">  Simulator::Destroy ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序当创建了一个均匀分布的随机变量生成器，通过属性设定其最小值为0，最大值为10。然后生成了10个随机数。运行程序，得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">[1950/2037] Compiling scratch/try-uniform-random.cc</span><br><span class="line">[1999/2037] Linking build/scratch/try-uniform-random</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (9.144s)</span><br><span class="line">8.16532</span><br><span class="line">6.06846</span><br><span class="line">4.95574</span><br><span class="line">3.81593</span><br><span class="line">3.69072</span><br><span class="line">8.06611</span><br><span class="line">1.00886</span><br><span class="line">5.84795</span><br><span class="line">9.3904</span><br><span class="line">6.26105</span><br></pre></td></tr></table></figure>
<p>可见最终生成的随机数当中，没有一个超过10的。</p>
<p>我们也可以生成整数版本的均匀分布的随机数：</p>
<figure class="highlight cpp"><figcaption><span>try-uniform-random.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line">NS_LOG_COMPONENT_DEFINE (<span class="string">"TryUniformRandom"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> </span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  LogComponentEnable(<span class="string">"TryUniformRandom"</span>, LOG_LEVEL_INFO);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MIN = <span class="number">0.0</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MAX = <span class="number">10.0</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> MAX_NUMBERS = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;UniformRandomVariable&gt; x = CreateObject&lt;UniformRandomVariable&gt; ();</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Min"</span>, DoubleValue (MIN));</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Max"</span>, DoubleValue (MAX));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; MAX_NUMBERS; i++) &#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> value = x-&gt;GetInteger();</span><br><span class="line">    NS_LOG_INFO(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Simulator::Run ();</span><br><span class="line">  Simulator::Destroy ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，得到如下结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">[1950/2037] Compiling scratch/try-uniform-random.cc</span><br><span class="line">[2019/2037] Linking build/scratch/try-uniform-random</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (8.548s)</span><br><span class="line">8</span><br><span class="line">6</span><br><span class="line">5</span><br><span class="line">4</span><br><span class="line">4</span><br><span class="line">8</span><br><span class="line">1</span><br><span class="line">6</span><br><span class="line">10</span><br><span class="line">6</span><br></pre></td></tr></table></figure>
<p>可以看到在整数模式下，最终取值可以取得最大值10。</p>
<p>最后我们生成10000个浮点型随机数，然后使用gnuplot显示其直方图（关于gnuplot的使用请参见<a href="http://blog.sciencenet.cn/blog-373392-535918.html" target="_blank" rel="noopener">马欢的博客</a>）：</p>
<figure class="highlight cpp"><figcaption><span>try-uniform-random.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line">NS_LOG_COMPONENT_DEFINE (<span class="string">"TryUniformRandom"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> </span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  LogComponentEnable(<span class="string">"TryUniformRandom"</span>, LOG_LEVEL_INFO);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MIN = <span class="number">0.0</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MAX = <span class="number">10.0</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> MAX_NUMBERS = <span class="number">100000</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;UniformRandomVariable&gt; x = CreateObject&lt;UniformRandomVariable&gt; ();</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Min"</span>, DoubleValue (MIN));</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Max"</span>, DoubleValue (MAX));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="function">ofstream <span class="title">outfile</span><span class="params">(<span class="string">"uniform.txt"</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; MAX_NUMBERS; i++) &#123;</span><br><span class="line">    <span class="keyword">double</span> value = x-&gt;GetValue ();</span><br><span class="line">    outfile &lt;&lt; value &lt;&lt; <span class="string">"\n"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  outfile.flush();</span><br><span class="line">  outfile.close();</span><br><span class="line"></span><br><span class="line">  Simulator::Run ();</span><br><span class="line">  Simulator::Destroy ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">set term pngcairo lw 2 </span><br><span class="line">set output &quot;uniform.png&quot;</span><br><span class="line"></span><br><span class="line">n=50 #number of intervals</span><br><span class="line">max=0.0 #max value</span><br><span class="line">min=10.0 #min value</span><br><span class="line">width=(max-min)/n #interval width</span><br><span class="line"></span><br><span class="line">#function used to map a value to the intervals</span><br><span class="line">hist(x,width)=width*floor(x/width)+width/2.0</span><br><span class="line"></span><br><span class="line">set boxwidth width*0.9</span><br><span class="line">set style fill solid 0.5 # fill style</span><br><span class="line"></span><br><span class="line">#count and plot</span><br><span class="line">plot &quot;uniform.txt&quot; u (hist($1,width)):(1.0) smooth freq w boxes lc rgb&quot;green&quot; notitle</span><br></pre></td></tr></table></figure>
<p>当然生成的数字越多，越符合大数定理，越能展示其分布。最终直方图如下：</p>
<p><img src="uniform.png" alt="均匀分布随机数的直方图" title="均匀分布随机数的直方图"></p>
<h2 id="2-3-ConstantRandomVariable"><a href="#2-3-ConstantRandomVariable" class="headerlink" title="2.3. ConstantRandomVariable"></a>2.3. ConstantRandomVariable</h2><p>ConstantRandomVariable称为常数分布，严格说起来并不算是随机变量，只是为了能够在使用随机变量作为类型的地方能够使用常数而创造的。它有一个属性Constant，默认值为0.0。不管生成多少随机变量，生成器始终返回Constant值。</p>
<p>因此，分布的均值为Constant，而方差为0。</p>
<p>下面通过一个简单的例子来演示：</p>
<figure class="highlight cpp"><figcaption><span>try-constant-random.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line">NS_LOG_COMPONENT_DEFINE (<span class="string">"TryConstantRandom"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> </span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  LogComponentEnable(<span class="string">"TryConstantRandom"</span>, LOG_LEVEL_INFO);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> CONSTANT = <span class="number">5.3</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> MAX_NUMBERS = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;ConstantRandomVariable&gt; x = CreateObject&lt;ConstantRandomVariable&gt; ();</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Constant"</span>, DoubleValue (CONSTANT));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; MAX_NUMBERS; i++) &#123;</span><br><span class="line">    <span class="keyword">double</span> value = x-&gt;GetValue ();</span><br><span class="line">    NS_LOG_INFO(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Simulator::Run ();</span><br><span class="line">  Simulator::Destroy ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，得到如下结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">[1962/2039] Compiling scratch/try-constant-random.cc</span><br><span class="line">[1999/2039] Linking build/scratch/try-constant-random</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (8.074s)</span><br><span class="line">5.3</span><br><span class="line">5.3</span><br><span class="line">5.3</span><br><span class="line">5.3</span><br><span class="line">5.3</span><br><span class="line">5.3</span><br><span class="line">5.3</span><br><span class="line">5.3</span><br><span class="line">5.3</span><br><span class="line">5.3</span><br></pre></td></tr></table></figure>
<p>如果我们获取整数，那么程序将对浮点数进行截断：</p>
<figure class="highlight cpp"><figcaption><span>try-constant-random.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line">NS_LOG_COMPONENT_DEFINE (<span class="string">"TryConstantRandom"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> </span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  LogComponentEnable(<span class="string">"TryConstantRandom"</span>, LOG_LEVEL_INFO);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> CONSTANT = <span class="number">5.3</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> MAX_NUMBERS = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;ConstantRandomVariable&gt; x = CreateObject&lt;ConstantRandomVariable&gt; ();</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Constant"</span>, DoubleValue (CONSTANT));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; MAX_NUMBERS; i++) &#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> value = x-&gt;GetInteger();</span><br><span class="line">    NS_LOG_INFO(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Simulator::Run ();</span><br><span class="line">  Simulator::Destroy ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，得到如下结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">[1962/2039] Compiling scratch/try-constant-random.cc</span><br><span class="line">[1999/2039] Linking build/scratch/try-constant-random</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (10.994s)</span><br><span class="line">5</span><br><span class="line">5</span><br><span class="line">5</span><br><span class="line">5</span><br><span class="line">5</span><br><span class="line">5</span><br><span class="line">5</span><br><span class="line">5</span><br><span class="line">5</span><br><span class="line">5</span><br></pre></td></tr></table></figure>
<p>可见程序就是对设置的Constant属性进行了简单粗暴的截断而已。最后我们同样产生1万个随机数，然后展示其直方图:</p>
<p><img src="constant.png" alt="常数分布随机数的直方图" title="常数分布随机数的直方图"></p>
<h2 id="2-4-SequentialRandomVariable"><a href="#2-4-SequentialRandomVariable" class="headerlink" title="2.4. SequentialRandomVariable"></a>2.4. SequentialRandomVariable</h2><p>SequentialRandomVariable生成固定模式的数列，没有合适的官方命名，我们姑且称为数列分布。它一共提供4个属性：</p>
<ul>
<li>Increment：数列每次递增量，这个可以是任意其他随机变量，默认值为常数随机变量。</li>
<li>Consecutive：数字重复多少遍才递增，整数，默认值为1。</li>
<li>Min：数列初始值，浮点数，默认值为0。</li>
<li>Max：数列最大值（不含），浮点数，默认值为0。</li>
</ul>
<p>当Increment取真正的随机变量的时候，这是一个随机数生成器。当Increment取常数分布的时候，这就是一个固定模式的数列。由于其不确定性，无法直接推导其均值和方差。</p>
<p>下面通过例子来进行演示：</p>
<figure class="highlight cpp"><figcaption><span>try-sequential-random.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line">NS_LOG_COMPONENT_DEFINE (<span class="string">"TrySequentialRandom"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> </span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  LogComponentEnable(<span class="string">"TrySequentialRandom"</span>, LOG_LEVEL_INFO);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MIN = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MAX = <span class="number">13</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> CONSECUTIVE  = <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> INCREMENT = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> MAX_NUMBERS = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;SequentialRandomVariable&gt; x = CreateObject&lt;SequentialRandomVariable&gt; ();</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Min"</span>, DoubleValue (MIN));</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Max"</span>, DoubleValue (MAX));</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Consecutive"</span>, IntegerValue(CONSECUTIVE));</span><br><span class="line"></span><br><span class="line">  Ptr&lt;ConstantRandomVariable&gt; increment = CreateObject&lt;ConstantRandomVariable&gt; ();</span><br><span class="line">  increment-&gt;SetAttribute(<span class="string">"Constant"</span>, DoubleValue(INCREMENT));</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Increment"</span>, PointerValue(increment));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; MAX_NUMBERS; i++) &#123;</span><br><span class="line">    <span class="keyword">double</span> value = x-&gt;GetValue ();</span><br><span class="line">    NS_LOG_INFO(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Simulator::Run ();</span><br><span class="line">  Simulator::Destroy ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">[1930/2041] Compiling scratch/try-sequential-random.cc</span><br><span class="line">[2003/2041] Linking build/scratch/try-sequential-random</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (8.327s)</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">6</span><br><span class="line">6</span><br><span class="line">6</span><br><span class="line">10</span><br><span class="line">10</span><br><span class="line">10</span><br><span class="line">3</span><br><span class="line">3</span><br><span class="line">3</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">11</span><br><span class="line">11</span><br><span class="line">11</span><br><span class="line">4</span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<p>程序中我们可以观察到，当生成的随机数的值大于设置的最大值的时候，生成器会将这个值进行转换，其具体算法是：Min + (current - Max)。例如，我们生成了随机变量10，其增加4之后得到14，然而最大值只有13，因此程序进行了变换：2 + (14 - 13) = 3。当生成了随机变量11之后，增加4得到15，因此程序再次进行变换：2 + (15 - 13) = 4。</p>
<p>我们生成10万个随机数之后绘制了其直方图：</p>
<p><img src="sequential.png" alt="数列分布随机数的直方图" title="数列分布随机数的直方图"></p>
<h2 id="2-5-NormalRandomVariable"><a href="#2-5-NormalRandomVariable" class="headerlink" title="2.5. NormalRandomVariable"></a>2.5. NormalRandomVariable</h2><p>NormalRandomVariable被称为正态（高斯）分布，是一种使用非常广泛的分布类型。</p>
<p>它有三个属性：</p>
<ul>
<li>均值Mean，浮点型，默认值为0。</li>
<li>方差Variance，浮点型，默认值为1。</li>
<li>上限Bound，浮点型，默认值为1e+307。</li>
</ul>
<p>正态分布的取值范围是从负无穷到正无穷，程序中可以通过一个Bound属性来控制，生成随机变量的大概范围。其均值和方差均已通过属性进行设置。如果属性的默认值不进行修改，将得到标准正态分布。</p>
<p>下面通过一个简单的例子来演示正态分布随机变量的使用：</p>
<figure class="highlight cpp"><figcaption><span>try-normal-random.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line">NS_LOG_COMPONENT_DEFINE (<span class="string">"TryNormalRandom"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> </span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  LogComponentEnable(<span class="string">"TryNormalRandom"</span>, LOG_LEVEL_INFO);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MEAN = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> MAX_NUMBERS = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;NormalRandomVariable&gt; x = CreateObject&lt;NormalRandomVariable&gt; ();</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Mean"</span>, DoubleValue (MEAN));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; MAX_NUMBERS; i++) &#123;</span><br><span class="line">    <span class="keyword">double</span> value = x-&gt;GetValue ();</span><br><span class="line">    NS_LOG_INFO(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Simulator::Run ();</span><br><span class="line">  Simulator::Destroy ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (6.126s)</span><br><span class="line">11.2033</span><br><span class="line">10.4062</span><br><span class="line">9.91037</span><br><span class="line">7.60186</span><br><span class="line">9.49999</span><br><span class="line">11.1709</span><br><span class="line">9.11794</span><br><span class="line">10.1874</span><br><span class="line">10.5779</span><br><span class="line">10.166</span><br></pre></td></tr></table></figure>
<p>当然正态分布如果是只是生成一些随机数，是看不出任何效果的，因此，我们还是生成10万个随机数，然后展示其直方图：</p>
<p><img src="normal.png" alt="正态分布随机数的直方图" title="正态分布随机数的直方图"></p>
<p>从图中可以看出，其均值确实在10附近。</p>
<h2 id="2-6-ExponentialRandomVariable"><a href="#2-6-ExponentialRandomVariable" class="headerlink" title="2.6. ExponentialRandomVariable"></a>2.6. ExponentialRandomVariable</h2><p>ExponentialRandomVariable被称为指数分布。这是系统分析当中最常使用的分布，主要优点在于其无记性特性。下次事件发生的概率和这一次的事件发生无关，比较有利于数学推导。因此指数分布广泛用于仿真领域。例如，可以将数据包的发送时间间隔设置为指数分布，那么下一次什么时候发送数据包和当前什么时候发送数据包之间没有关系。</p>
<p>指数分布的取值范围是：$[0, +\infty)$。它有两个属性：</p>
<ul>
<li>Mean：均值，浮点数，默认值为1。</li>
<li>Bound：生成随机数的上限，浮点数，默认值为0，表示不限制。</li>
</ul>
<p>当设置Bound属性为非零值之后，其概率密度函数将产生一些修正，以保证其概率和总能累计为1。</p>
<p>下面使用一个简单的例子来演示指数分布随机变量的使用：</p>
<figure class="highlight cpp"><figcaption><span>try-exponential-random.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line">NS_LOG_COMPONENT_DEFINE (<span class="string">"TryExponentialRandom"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> </span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  LogComponentEnable(<span class="string">"TryExponentialRandom"</span>, LOG_LEVEL_INFO);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MEAN = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> MAX_NUMBERS = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;ExponentialRandomVariable&gt; x = CreateObject&lt;ExponentialRandomVariable&gt; ();</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Mean"</span>, DoubleValue (MEAN));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; MAX_NUMBERS; i++) &#123;</span><br><span class="line">    <span class="keyword">double</span> value = x-&gt;GetValue ();</span><br><span class="line">    NS_LOG_INFO(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Simulator::Run ();</span><br><span class="line">  Simulator::Destroy ();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行程序，得到如下结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (5.793s)</span><br><span class="line">4.05378</span><br><span class="line">9.98961</span><br><span class="line">14.0408</span><br><span class="line">19.268</span><br><span class="line">19.9353</span><br><span class="line">4.29828</span><br><span class="line">45.8753</span><br><span class="line">10.7299</span><br><span class="line">1.25793</span><br><span class="line">9.36476</span><br></pre></td></tr></table></figure>
<p>同样的，我们可以生成器10万个随机数，然后展示其直方图：</p>
<p><img src="exponential.png" alt="指数分布随机数的直方图" title="指数分布随机数的直方图"></p>
<h2 id="2-7-ParetoRandomVariable"><a href="#2-7-ParetoRandomVariable" class="headerlink" title="2.7. ParetoRandomVariable"></a>2.7. ParetoRandomVariable</h2><p>ParetoRandomVariable被称为帕累托分布，是一种重尾分布（heavy-tailed distribution）。所谓重尾分布（Heavy-tailed distribution）是一种概率分布模型，它的尾部比指数分布还要厚。在许多情况下，右边尾部的部分比较受到重视，但左边尾部比较厚，或是两边尾部都比较厚的状况，也被认为是一种重尾分布。</p>
<p>重尾分布意味着可以更大的概率获得很大的值. 因此与弱随机性相反，重尾分布一般表示病态，增加的各种结果被确定为具有重尾分布，包括收入分布、财务报告、保险支出、网页的参考链接等。重尾分布的一个特殊的子集是幂律，其意味着概率密度函数是一个幂。 一个技术难题是，不是所有的矩存在于这些分布，这一般意味着它们使用分位数和其它顺序统计学。这也就是说，中心极限定理不再成立。但是对于诸如均值，即稳定分布的线性组合，我们获得一个新的标准极限分布。</p>
<p>设$X$是一个随机变量，$F(X)=Pr\{X&lt;x\}$为它的分布函数，如果当$x\to \infty$时$1-F(X)\sim 1/x^{a}$其中$x&gt;a$，称X的分布为重尾分布，又称幂律分布。</p>
<p>一般来说，服从重尾分布的随机变量X具有较大甚至是无穷大的方差，而且当$a\le 1$时，X的均值也是无穷的。随机变量X会以不可忽略的概率取到非常大的数值，即：大量的小抽样取值和少量的大抽样取值并存。</p>
<p>在1994年，随着网络研究人员Leland的一篇文章“On the self-similar nature of Ethernet traffic”的发表，网络研究界平地一声雷，引起了轩然大波。传统的基于泊松分布的网络分析模型不能准确描述真实网络流量的特性。“网络流量自相似”、“网络流量长相关”等说法逐渐普及。由于流量模型是网络性能分析的基础，而在自相似流量下，网络的特性和传统短相关流量下，有非常大的不同。一时间，各种自相似流量模型兴起。其中一种就是基于重尾分布建立的。重尾分布有很多种。Pareto是比较容易生成的其中一种。</p>
<p>帕累托分布一共有4个属性：</p>
<ul>
<li>Mean，均值，浮点数，默认值为1。</li>
<li>Scale，帕累托分布的位置参数，一般记为$\beta$，浮点数，默认值为1。</li>
<li>Shape，帕累托分布的形状参数，一般记为$\alpha$，浮点数，默认值为2。</li>
<li>Bound，上限，用于控制帕累托随机变量生成得值的上限，浮点数，默认值为0，表示不限制。</li>
</ul>
<p>当Shape属性值$\alpha \le 1$时，帕累托分布的随机变量具有无穷的均值。当$\alpha\le 2$时，帕累托分布的随机变量具有无穷的方差。当$\alpha \in (1,2) $时，具有均值，但是方差为无穷。当$\alpha &gt; 2$时，均值和方差均存在，且有限，计算公式为：$E(X) = \frac{Scale \times Shape}{Shape - 1}$。当然，如果Bound属性设置为非零值，那么产生的随机数的均值会比计算值小一些。</p>
<p>我们用下面的程序来演示帕累托分布的使用：</p>
<figure class="highlight cpp"><figcaption><span>try-pareto-random.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line">NS_LOG_COMPONENT_DEFINE (<span class="string">"TryParetoRandom"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> </span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  LogComponentEnable(<span class="string">"TryParetoRandom"</span>, LOG_LEVEL_INFO);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> SCALE = <span class="number">5.0</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> SHAPE = <span class="number">2.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> MAX_NUMBERS = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;ParetoRandomVariable&gt; x = CreateObject&lt;ParetoRandomVariable&gt; ();</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Scale"</span>, DoubleValue (SCALE));</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Shape"</span>, DoubleValue (SHAPE));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; MAX_NUMBERS; i++) &#123;</span><br><span class="line">    <span class="keyword">double</span> value = x-&gt;GetValue ();</span><br><span class="line">    NS_LOG_INFO(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Simulator::Run ();</span><br><span class="line">  Simulator::Destroy ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (5.737s)</span><br><span class="line">5.53329</span><br><span class="line">6.41846</span><br><span class="line">7.10257</span><br><span class="line">8.09413</span><br><span class="line">8.23028</span><br><span class="line">5.56721</span><br><span class="line">15.7418</span><br><span class="line">6.53835</span><br><span class="line">5.15974</span><br><span class="line">6.31897</span><br></pre></td></tr></table></figure>
<p>同样，我们还是生成10万个随机数，然后绘制其直方图:</p>
<p><img src="pareto.png" alt="帕累托分布随机数的直方图" title="帕累托分布随机数的直方图"></p>
<p>可以看到，帕累托分布的随机变量大部分值的出现都是在较小的数值区域，但偶尔会产生一些非常大的值。如果Shape参数取值，越小，这样的值就会越多。在直方图上或者在概率密度函数上看来，就相当于其尾巴延长了，这就是重尾分布或者长尾分布名称的由来。</p>
<p>除此之外，NS-3还实现了如下的随机变量分布：</p>
<ul>
<li>class WeibullRandomVariable</li>
<li>class NormalRandomVariable</li>
<li>class LogNormalRandomVariable</li>
<li>class GammaRandomVariable</li>
<li>class ErlangRandomVariable</li>
<li>class TriangularRandomVariable</li>
<li>class ZipfRandomVariable</li>
<li>class ZetaRandomVariable</li>
<li>class DeterministicRandomVariable</li>
<li>class EmpiricalRandomVariable</li>
</ul>
<h1 id="3-自定义随机数生成器"><a href="#3-自定义随机数生成器" class="headerlink" title="3. 自定义随机数生成器"></a>3. 自定义随机数生成器</h1><p>NS-3当中并没有默认提供几何分布的随机变量。下面我们以集合分布的随机变量为例，来介绍如何自定义一种随机变量类型。</p>
<p>要创建随机变量生成器，第一步需要我们明白随机变量的类型，是连续型还是离散型？连续型和离散型随机变量的生成方法是不同的。</p>
<p>连续型随机变量大多都可以通过求反函数的方法来实现，这里就不再赘述，感兴趣的读者可以参考<a href="https://blog.csdn.net/sheng_ai/article/details/47701523" target="_blank" rel="noopener">博客</a>。</p>
<p>对于离散型的随机变量，可以使用通用方法生成随机变量，我们只需要知道其分布函数即可。例如，我们需要生成几何分布的随机变量，其分布函数为：$Pr(k) = (1-p)^(k-1)p$，即随机变量的值是k的概率。那么每个取值都对应一个概率。因此，我们可以计算一张表，例如p=0.5的时候，有：</p>
<table>
<thead>
<tr>
<th>k</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>……</th>
</tr>
</thead>
<tbody>
<tr>
<td>pr</td>
<td>0.5</td>
<td>0.25</td>
<td>0.125</td>
<td>……</td>
</tr>
<tr>
<td>∑</td>
<td>0.5</td>
<td>0.75</td>
<td>0.875</td>
<td>……</td>
</tr>
</tbody>
</table>
<p>因此，我们只需要生成一个(0,1]分布的随机变量值，然后写一个循环，查找这个值究竟在哪个范围内即可确定对应的值是多少。然而这种方法太慢了，当变量的取值范围非常大的时候，需要循环很多次才能找到正确的区间。</p>
<p>不同的离散型随机变量生成方法大多都有不同的优化方法。例如，我们要生成几何分布的随机变量。首先，我们需要先明白几何分布的随机变量的意义才能更好地进行优化。这里，几何分布表示反复进行贝努利实验，第k次才实验成功（前k-1次都失败）的概率。</p>
<p>什么是贝努利实验呢？其实可以简单的理解，这个实验只有两种结果，并且其中一种的概率用p来表示。例如，抛硬币就是一个典型的贝努利实验，只有正面和反面两种结果，我们可以将结果为正面的概论定为p，那么结果为背面的概率自然就是1-p。</p>
<p>因此几何分布中，第k次才成功的概率为：$P(k)=(1-p)^{k-1}p$。其中$(1-p)^{k-1}$表示前k-1次均失败的概率，而p表示第k次成功的概率。</p>
<p>$\sum_{i=1}^{j-1}P(i)$表示第1次成功的概率一直累加到第j-1次成功的概率，其中$j\ge 1$。因此有$\sum_{i=1}^{j-1}P(i) = 1 - \sum_{i=j}^{+\infty}P(i)$。而$\sum_{i=j}^{+\infty}P(i)$表示前$j-1$次都未成功的概率，根据贝努利实验的原理可知$\sum_{i=j}^{+\infty}P(i)=(1-p)^{j-1}$。因此最终有$\sum_{i=1}^{j-1}P(i)=1-(1-p)^{j-1}$。这就将概率的累加用公式表示出来了，因此，我们编程的时候就无需循环去累加概率了。和通用方法类似的，我们只需要去生成一个(0,1]分布的随机变量u满足如下公式：</p>
<p>$$1-(1-p)^{j-1}\le u &lt; 1-(1-p)^{j}$$</p>
<p>那么对应的j就是我们要求的值。简化后得到：</p>
<p>$$(1-p)^{j}&lt; 1- u \le (1-p)^{j-1}$$，即</p>
<p>$$X=\min\{j:(1-p)^{j}&lt;(1-u)\}=\min\{j:ln(1-p)^{j}&lt;ln(1-u)\}=\min\{j:jln(1-p)&lt;ln(1-u)\}$$</p>
<p>这里需要注意的是，由于(1-p)一定小于1，则ln(1-p)一个是个负数。因此有：</p>
<p>$$X=\min\{j:j&gt;\frac{ln(1-u)}{ln(1-p)}\}=\lfloor\frac{ln(1-u)}{ln(1-p)}\rfloor+1$$</p>
<p>由于u是均匀分布的随机变量，那么生成u和生成1-u的概率是一样的，因此，有</p>
<p>$$X=\lfloor\frac{ln(u)}{ln(1-p)}\rfloor+1$$。</p>
<p>这里需要注意的是p不能等于1，程序当中需要特殊处理一下。不过从意义上来理解，如果p等于1了，那说明成功的概率为1，肯定实验第一次就成功了呀。所以……你懂的</p>
<p>这样生成的几何分布的均值为$E(X)=1/p$，方差为$D(X) = (1-p)/p^2$。</p>
<p>有了以上的公式，我们就可以生成几何分布的随机变量了。只要写一个类继承RandomVairableStream，然后按公式生成随机数即可。程序如下：</p>
<figure class="highlight cpp"><figcaption><span>try-geometric-random.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line">NS_LOG_COMPONENT_DEFINE (<span class="string">"TryGeometricRandom"</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GeometricRandomVariable</span> :</span> <span class="keyword">public</span> RandomVariableStream &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  GeometricRandomVariable ();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">double</span> <span class="title">GetProbability</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Inherited from RandomVariableStream</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">double</span> <span class="title">GetValue</span> <span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> uint32_t <span class="title">GetInteger</span> <span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">double</span> m_probability;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">NS_OBJECT_ENSURE_REGISTERED(GeometricRandomVariable);</span><br><span class="line"></span><br><span class="line">TypeId</span><br><span class="line">GeometricRandomVariable::GetTypeId (<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">static</span> TypeId tid = TypeId (<span class="string">"ns3::GeometricRandomVariable"</span>)</span><br><span class="line">    .SetParent&lt;RandomVariableStream&gt;()</span><br><span class="line">    .AddConstructor&lt;GeometricRandomVariable&gt; ()</span><br><span class="line">    .AddAttribute(<span class="string">"Probability"</span>, <span class="string">"The lower bound on the values returned by this RNG stream."</span>,</span><br><span class="line">                  DoubleValue(<span class="number">0.5</span>),</span><br><span class="line">                  MakeDoubleAccessor(&amp;GeometricRandomVariable::m_probability),</span><br><span class="line">                  MakeDoubleChecker&lt;<span class="keyword">double</span>&gt;(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">return</span> tid;</span><br><span class="line">&#125;</span><br><span class="line">GeometricRandomVariable::GeometricRandomVariable ()</span><br><span class="line">&#123;</span><br><span class="line">  NS_LOG_FUNCTION (<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> GeometricRandomVariable::GetProbability () <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> m_probability;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> GeometricRandomVariable::GetValue (<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> GetInteger();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint32_t</span> GeometricRandomVariable::GetInteger (<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span>(m_probability == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">double</span> u = Peek()-&gt;RandU01();</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">int</span>)(<span class="built_in">log</span>(u) / <span class="built_in">log</span>(<span class="number">1</span> - m_probability)) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> </span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  LogComponentEnable(<span class="string">"TryGeometricRandom"</span>, LOG_LEVEL_INFO);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> PROBABILITY= <span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> MAX_NUMBERS = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;GeometricRandomVariable&gt; x = CreateObject&lt;GeometricRandomVariable&gt; ();</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Probability"</span>, DoubleValue (PROBABILITY));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; MAX_NUMBERS; i++) &#123;</span><br><span class="line">      <span class="keyword">double</span> value = x-&gt;GetValue ();</span><br><span class="line">      NS_LOG_INFO(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Simulator::Run ();</span><br><span class="line">  Simulator::Destroy ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序，得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">[1980/2049] Compiling scratch/try-geometric-random.cc</span><br><span class="line">[2009/2049] Linking build/scratch/try-geometric-random</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.29/ns-3.29/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (7.878s)</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">4</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>同样的，我们也生成10万个符合几何分布的随机数，然后画出其直方图：</p>
<p><img src="geometric.png" alt="几何分布随机数的直方图" title="几何分布随机数的直方图"></p>
<p>从图中可以看到，大部分时候，实验都是一两次就成功了。因为默认的成功概率p为0.5。假如我们认为成功是指抛硬币抛到正面，那么，这就解释了为什么我们抛硬币可以在短短几次之内就能抛到正面。</p>
<h1 id="4-随机数作为属性的值"><a href="#4-随机数作为属性的值" class="headerlink" title="4. 随机数作为属性的值"></a>4. 随机数作为属性的值</h1><p>如果需要将随机数作为属性类型，那么可以将对应的底层变量声明为ns3::Ptr&lt; ns3::RandomVariableStream&gt;，这是一切随机数生成器的父类，而属性值类型设置为PointerValue。进行属性设置的时候，可以直接使用PointerValue(x)类型，例如我们前面序列随机变量的例子：</p>
<figure class="highlight cpp"><figcaption><span>try-sequential-random.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line">NS_LOG_COMPONENT_DEFINE (<span class="string">"TrySequentialRandom"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> </span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  LogComponentEnable(<span class="string">"TrySequentialRandom"</span>, LOG_LEVEL_INFO);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MIN = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MAX = <span class="number">13</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> CONSECUTIVE  = <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> INCREMENT = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> MAX_NUMBERS = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;SequentialRandomVariable&gt; x = CreateObject&lt;SequentialRandomVariable&gt; ();</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Min"</span>, DoubleValue (MIN));</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Max"</span>, DoubleValue (MAX));</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Consecutive"</span>, IntegerValue(CONSECUTIVE));</span><br><span class="line"></span><br><span class="line">  Ptr&lt;ConstantRandomVariable&gt; increment = CreateObject&lt;ConstantRandomVariable&gt; ();</span><br><span class="line">  increment-&gt;SetAttribute(<span class="string">"Constant"</span>, DoubleValue(INCREMENT));</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Increment"</span>, PointerValue(increment));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; MAX_NUMBERS; i++) &#123;</span><br><span class="line">    <span class="keyword">double</span> value = x-&gt;GetValue ();</span><br><span class="line">    NS_LOG_INFO(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Simulator::Run ();</span><br><span class="line">  Simulator::Destroy ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中的Increment属性就是一个另一个随机变量。当然，我们也可以通过StringValue来构建随机变量，程序会更加简洁（具体如何从字符串构建对象并设置其属性，请参见属性框架一章）。例如，我们可以如下简化程序：</p>
<figure class="highlight cpp"><figcaption><span>try-sequential-random.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line">NS_LOG_COMPONENT_DEFINE (<span class="string">"TrySequentialRandom"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> </span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  LogComponentEnable(<span class="string">"TrySequentialRandom"</span>, LOG_LEVEL_INFO);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MIN = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">double</span> MAX = <span class="number">13</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> CONSECUTIVE  = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">uint32_t</span> MAX_NUMBERS = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;SequentialRandomVariable&gt; x = CreateObject&lt;SequentialRandomVariable&gt; ();</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Min"</span>, DoubleValue (MIN));</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Max"</span>, DoubleValue (MAX));</span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Consecutive"</span>, IntegerValue(CONSECUTIVE));</span><br><span class="line"></span><br><span class="line">  x-&gt;SetAttribute (<span class="string">"Increment"</span>, StringValue(<span class="string">"ns3::ConstantRandomVariable[Constant=4]"</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; MAX_NUMBERS; i++) &#123;</span><br><span class="line">    <span class="keyword">double</span> value = x-&gt;GetValue ();</span><br><span class="line">    NS_LOG_INFO(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Simulator::Run ();</span><br><span class="line">  Simulator::Destroy ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    

    
    
    

    

    

		<div>
					
						
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2018/11/17/ns3-013/">NS-3学习笔记（十三）：随机数生成器</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 Rain Sia <rainsia@163.com> 的个人博客">Rain Sia <rainsia@163.com></a></p>
  <p><span>发布时间:</span>2018年11月17日 - 23:11</p>
  <p><span>最后更新:</span>2018年11月21日 - 21:11</p>
  <p><span>原始链接:</span>
		<a href="/2018/11/17/ns3-013/" title="NS-3学习笔记（十三）：随机数生成器">
			http://rainsia.gitee.io/2018/11/17/ns3-013/
		</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://rainsia.gitee.io/2018/11/17/ns3-013/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>版权信息:</span>本文为作者原创文章，如需进行非商业性转载，请注明出处并保留原文链接及作者。如要进行商业性转载，请获得作者授权！</p>  
  <p><span>联系方式:</span>rainsia@163.com</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
      $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
        });
    });  
</script>


					
		</div>

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/NS-3/" rel="tag"># NS-3</a>
          
            <a href="/tags/C/" rel="tag"># C++</a>
          
            <a href="/tags/Simulation/" rel="tag"># Simulation</a>
          
            <a href="/tags/Random-Number/" rel="tag"># Random Number</a>
          
            <a href="/tags/Random-Variable/" rel="tag"># Random Variable</a>
          
            <a href="/tags/RandomStream/" rel="tag"># RandomStream</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/01/ns3-012/" rel="next" title="NS-3学习笔记（十二）：事件与调度器">
                <i class="fa fa-chevron-left"></i> NS-3学习笔记（十二）：事件与调度器
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="Rain Sia <rainsia@163.com>" />
            
              <p class="site-author-name" itemprop="name">Rain Sia <rainsia@163.com></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">44</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-伪随机数生成器概述"><span class="nav-text">1. 伪随机数生成器概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-确定的随机数序列"><span class="nav-text">1.1. 确定的随机数序列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-独立的随机数序列"><span class="nav-text">1.2. 独立的随机数序列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-随机数的周期"><span class="nav-text">1.3. 随机数的周期</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-NS-3的随机数生成器"><span class="nav-text">2. NS-3的随机数生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-RandomVariableStream"><span class="nav-text">2.1. RandomVariableStream</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-UniformRandomVariable"><span class="nav-text">2.2. UniformRandomVariable</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-ConstantRandomVariable"><span class="nav-text">2.3. ConstantRandomVariable</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-SequentialRandomVariable"><span class="nav-text">2.4. SequentialRandomVariable</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-NormalRandomVariable"><span class="nav-text">2.5. NormalRandomVariable</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-ExponentialRandomVariable"><span class="nav-text">2.6. ExponentialRandomVariable</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-7-ParetoRandomVariable"><span class="nav-text">2.7. ParetoRandomVariable</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-自定义随机数生成器"><span class="nav-text">3. 自定义随机数生成器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-随机数作为属性的值"><span class="nav-text">4. 随机数作为属性的值</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rain Sia, All rights reserved.<br/>本站所有原创文章，如进行非商业目的转载，请注明出处。若要进行商业目的转载，必须取得授权。<br/>--作者</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.5.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Gemini</a> v6.4.2</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'KSHKjGm3HfpWAPzaHoA4NV0H-gzGzoHsz',
        appKey: '55JA7fexBRQej1dHDpuxfTA0',
        placeholder: 'Just go go',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: false
    });
  </script>



  





  

  

  

  
  

  
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  
  

  

  

  

  

  

</body>
</html>
