<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="本章主要介绍NS-3的对象框架当中的属性框架。ObjectBase类实现了属性框架的基本功能，任何类只要继承自ObjectBase即可以使用NS-3的属性框架。使用NS-3的属性框架，可以方便地对对象的属性进行设置和读取。此外，可以设置类的默认属性，设置完成后，所有该类的实例对象都具有该默认属性。在NS-3中，所有内置属性的值都能和字符串属性类型相互转换。因此，任何属性的值都可以方便地存入文件，或">
<meta name="keywords" content="NS-3,C++,Simulation,Object,ObjectBase,Attribute,StringValue">
<meta property="og:type" content="article">
<meta property="og:title" content="NS-3学习笔记（五）：NS-3的对象框架 之 属性框架">
<meta property="og:url" content="http://rainsia.github.io/2018/04/12/ns3-005/index.html">
<meta property="og:site_name" content="Rain&#39;s Blog">
<meta property="og:description" content="本章主要介绍NS-3的对象框架当中的属性框架。ObjectBase类实现了属性框架的基本功能，任何类只要继承自ObjectBase即可以使用NS-3的属性框架。使用NS-3的属性框架，可以方便地对对象的属性进行设置和读取。此外，可以设置类的默认属性，设置完成后，所有该类的实例对象都具有该默认属性。在NS-3中，所有内置属性的值都能和字符串属性类型相互转换。因此，任何属性的值都可以方便地存入文件，或">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://www.cplusplus.com/reference/map/map/?kw=map">
<meta property="og:updated_time" content="2018-10-29T02:03:09.103Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NS-3学习笔记（五）：NS-3的对象框架 之 属性框架">
<meta name="twitter:description" content="本章主要介绍NS-3的对象框架当中的属性框架。ObjectBase类实现了属性框架的基本功能，任何类只要继承自ObjectBase即可以使用NS-3的属性框架。使用NS-3的属性框架，可以方便地对对象的属性进行设置和读取。此外，可以设置类的默认属性，设置完成后，所有该类的实例对象都具有该默认属性。在NS-3中，所有内置属性的值都能和字符串属性类型相互转换。因此，任何属性的值都可以方便地存入文件，或">
<meta name="twitter:image" content="http://www.cplusplus.com/reference/map/map/?kw=map">






  <link rel="canonical" href="http://rainsia.github.io/2018/04/12/ns3-005/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>NS-3学习笔记（五）：NS-3的对象框架 之 属性框架 | Rain's Blog</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?9d1df7de5bd3ea1d75446764f5075fe7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Rain's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">记录、分享、技术</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rainsia.github.io/2018/04/12/ns3-005/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rain Sia <rainsia@163.com>">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rain's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">NS-3学习笔记（五）：NS-3的对象框架 之 属性框架
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-04-12 00:31:19" itemprop="dateCreated datePublished" datetime="2018-04-12T00:31:19+08:00">2018-04-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-10-29 10:03:09" itemprop="dateModified" datetime="2018-10-29T10:03:09+08:00">2018-10-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/network/" itemprop="url" rel="index"><span itemprop="name">网络</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/network/simulation/" itemprop="url" rel="index"><span itemprop="name">仿真</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/network/simulation/NS-3/" itemprop="url" rel="index"><span itemprop="name">NS-3</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/12/ns3-005/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2018/04/12/ns3-005/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon"
            >
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本章主要介绍NS-3的对象框架当中的属性框架。ObjectBase类实现了属性框架的基本功能，任何类只要继承自ObjectBase即可以使用NS-3的属性框架。使用NS-3的属性框架，可以方便地对对象的属性进行设置和读取。此外，可以设置类的默认属性，设置完成后，所有该类的实例对象都具有该默认属性。在NS-3中，所有内置属性的值都能和字符串属性类型相互转换。因此，任何属性的值都可以方便地存入文件，或者从文件读取。</p>
<a id="more"></a>
<h1 id="1-属性框架简介"><a href="#1-属性框架简介" class="headerlink" title="1. 属性框架简介"></a>1. 属性框架简介</h1><p>面向对象系统中，类和对象是处于核心地位的元素。对象和对象之间的差别，主要靠成员变量来体现差异。而面向对象的封装特性要求我们在实现系统时，将成员变量尽量隐藏。在传统的编程任务中，我们通常将成员变量的访问通过使用Getter和Setter方法来进行，这样做的好处是，可以将成员变量的控制逻辑一同封装在类当中。</p>
<p>NS-3在传统成员变量的基础上，提出了属性框架的概念。使用属性框架可以实现比传统成员变量封装更多的功能，例如：为所有对象设置一个属性的默认值，将类的属性的默认值、或者对象的值存储到文件中，然后再从文件中读取。使用追踪系统追踪某个属性的值的变化情况等等。</p>
<p>NS-3的属性框架主要是通过ObjectBase和TypeId来实现的，因此要使用属性框架的类，必须继承自ObjectBase，并且维护一个TypeId实例。</p>
<h2 id="1-1-TypeId中关于属性框架的方法"><a href="#1-1-TypeId中关于属性框架的方法" class="headerlink" title="1.1. TypeId中关于属性框架的方法"></a>1.1. TypeId中关于属性框架的方法</h2><p>上一章中，我们解析了ObjectBase类和TypeId类的公有方法（请查看上一章）。在介绍TypeId时，我们省略了和属性系统相关的一些方法：</p>
<figure class="highlight cpp"><figcaption><span>type-id.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TypeId</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">/////////////构造函数和操作符重载//////////////</span></span><br><span class="line">  ……略</span><br><span class="line"></span><br><span class="line">  <span class="comment">////////////查找TypeId，和相关信息//////////////</span></span><br><span class="line">  ……略</span><br><span class="line"></span><br><span class="line">  <span class="comment">////////////通过TypeId获取或者设置类的信息/////////////////</span></span><br><span class="line">  ……略</span><br><span class="line"></span><br><span class="line">  <span class="comment">////////////通过TypeId了解继承层次关系///////////////</span></span><br><span class="line">  ……略</span><br><span class="line"></span><br><span class="line">  <span class="comment">/////////////和属性框架相关的方法//////////////////</span></span><br><span class="line">  <span class="keyword">uint32_t</span> GetAttributeN (<span class="keyword">void</span>) <span class="keyword">const</span>;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">TypeId</span>:</span>:<span class="function">AttributeInformation <span class="title">GetAttribute</span><span class="params">(<span class="keyword">uint32_t</span> i)</span> <span class="keyword">const</span></span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">GetAttributeFullName</span> <span class="params">(<span class="keyword">uint32_t</span> i)</span> <span class="keyword">const</span></span>;</span><br><span class="line">  <span class="function">TypeId <span class="title">AddAttribute</span> <span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> name,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="built_in">std</span>::<span class="built_in">string</span> help, </span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="keyword">const</span> AttributeValue &amp;initialValue,</span></span></span><br><span class="line"><span class="function"><span class="params">                       Ptr&lt;<span class="keyword">const</span> AttributeAccessor&gt; accessor,</span></span></span><br><span class="line"><span class="function"><span class="params">                       Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker,</span></span></span><br><span class="line"><span class="function"><span class="params">                       SupportLevel supportLevel = SUPPORTED,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;supportMsg = <span class="string">""</span>)</span></span>;</span><br><span class="line">  <span class="function">TypeId <span class="title">AddAttribute</span> <span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> name,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="built_in">std</span>::<span class="built_in">string</span> help, </span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="keyword">uint32_t</span> flags,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="keyword">const</span> AttributeValue &amp;initialValue,</span></span></span><br><span class="line"><span class="function"><span class="params">                       Ptr&lt;<span class="keyword">const</span> AttributeAccessor&gt; accessor,</span></span></span><br><span class="line"><span class="function"><span class="params">                       Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker,</span></span></span><br><span class="line"><span class="function"><span class="params">                       SupportLevel supportLevel = SUPPORTED,</span></span></span><br><span class="line"><span class="function"><span class="params">                       <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;supportMsg = <span class="string">""</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">SetAttributeInitialValue</span><span class="params">(<span class="keyword">uint32_t</span> i, </span></span></span><br><span class="line"><span class="function"><span class="params">                                Ptr&lt;<span class="keyword">const</span> AttributeValue&gt; initialValue)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">LookupAttributeByName</span> <span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> name, struct AttributeInformation *info)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">////////////和追踪系统相关的方法//////////////////</span></span><br><span class="line">  ……略</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>其中最值得注意的就是AddAttribute()方法该方法有两个重载（它们的差别在于有无flags参数）。在上一章中，我们介绍过TypeId用来表示一个类的信息。因此，AddAttribute()方法，用于向TypeId所表示的类中添加一个新的属性。添加以后，我们使用该类的时候就可以使用该属性了。我们解析以下AddAttribute()方法的参数的意义：</p>
<ul>
<li>name: 属性的名字</li>
<li>help: 用一句话来解释一下属性的作用</li>
<li>flags: 用于控制属性读写特性的参数</li>
<li>initialValue: 属性的初始值，类型为AttributeValue。AttributeValue是一切属性值类型的父类，例如整形值UintegerValue，浮点数值DoubleValue以及字符串值StringValue等。本章后面部分会介绍不同的属性值类型。</li>
<li>accessor: 如何访问该属性，是通过对象的成员变量访问呢？还是通过Getter/Setter方法来访问？其类型是一个AttributeAccessor的子类。</li>
<li>checker: 检查属性的值是否符合要求</li>
<li>supportLevel: 表示这个属性是处于使用状态、不推荐状态，还是过时状态，其类型是一个枚举变量，共有三种值：<ul>
<li>SUPPORT: 属性正在受到支持，可以正常使用，默认值</li>
<li>DEPRECATED：属性快要过时，不支持使用</li>
<li>OBSOLETE：属性已经过时，不能使用</li>
</ul>
</li>
<li>supportMsg: 支持性字符串，当supportLeve为不同的值时，msg的值也将不同：<ul>
<li>SUPPORT: 无作用，可以使用默认值空字符串(“”)</li>
<li>DEPRECATED: 提示属性快要过时，给出解决方法，以后该用什么属性替代该属性</li>
<li>OBSOLETE: 提示属性已经过时，不能使用，并提示使用什么属性来替代</li>
</ul>
</li>
</ul>
<p>其中flags参数的取值是由TypeId中定义的枚举类型描述的：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> AttributeFlag &#123;</span><br><span class="line">    ATTR_GET = <span class="number">1</span>&lt;&lt;<span class="number">0</span>, <span class="comment">/**&lt; 只读属性 */</span></span><br><span class="line">    ATTR_SET = <span class="number">1</span>&lt;&lt;<span class="number">1</span>, <span class="comment">/**&lt; 只写属性 */</span></span><br><span class="line">    ATTR_CONSTRUC = <span class="number">1</span>&lt;&lt;<span class="number">2</span>, <span class="comment">/**&lt; 属性只能在构造时被初始化 */</span></span><br><span class="line">    ATTR_SGC = ATTR_GET | ATTR_SET | ATTR_CONSTRUCT, <span class="comment">/**&lt; 可读可写可初始化 */</span></span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p>在没有flags参数的重载中，flags的值默认为ATTR_SGC，即包含全部的特性。</p>
<h2 id="1-2-定义一个属性"><a href="#1-2-定义一个属性" class="headerlink" title="1.2. 定义一个属性"></a>1.2. 定义一个属性</h2><p>任何一个NS-3属性的背后，都有一个传统的成员变量的用于存储属性的值。因此必须先在类当中定义一个合适的变量。然而在此之前，为了使用属性框架，类必须继承自ObjectBase，并提供GetTypeId()方法。当然为了使用智能指针，类还必须同时继承自SimpleRefCount（参考上一章的例子）。实际上，NS-3提供了另外一个类Object，实际上就是继承自SimpleRefCount和ObjectBase。Object的的定义如下：</p>
<figure class="highlight cpp"><figcaption><span>object.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Object</span> :</span> <span class="keyword">public</span> SimpleRefCount&lt;Object, ObjectBase, ObjectDeleter&gt;</span><br><span class="line">&#123;</span><br><span class="line">    ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可见，Object实际上就是继承了SimpleRefCount和ObjectBase。除此之外，Object类还实现了GetInstanceTypeId()方法，而子类无需在重写此方法。然而要<strong>注意</strong>，要让GetInstanceTypeId()自动能够获取任意子类的正确TypeId类型，<strong>必须</strong>使用NS-3提供的CreateObject()函数来创建对象，<strong>否则</strong>GetInstanceTypeId()方法返回的总是Object自己的TypeId。而NS-3的整个属性框架的基础就是TypeId，因此必须保证TypeId能够描述正确的类。</p>
<p>因此，我们的类要使用智能指针和属性框架，只需要继承自Object类即可。</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ns3 &#123;		<span class="comment">//一般建议将所有对象都写在ns3名称空间中</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> :</span> <span class="keyword">public</span> Object	<span class="comment">//继承自SimpleRefCount，又继承自ObjectBase</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">    MyObject ();</span><br><span class="line">    <span class="keyword">virtual</span> ~MyObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//业务方法</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MyMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">uint32_t</span></span><br><span class="line">	GetMyValue () <span class="keyword">const</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> m_myValue;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span></span><br><span class="line">	SetMyValue (<span class="keyword">uint32_t</span> myValue)</span><br><span class="line">	&#123;</span><br><span class="line">		m_myValue = myValue;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">uint32_t</span> m_myValue;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  NS_LOG_COMPONENT_DEFINE (<span class="string">"MyObject"</span>);			<span class="comment">//定义一个日志组件</span></span><br><span class="line">  NS_OBJECT_ENSURE_REGISTERED (MyObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">  TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">  		.SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">		;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::MyObject (): m_myValue(<span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::~MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span></span><br><span class="line">	MyObject::MyMethod ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		NS_LOG_UNCOND(<span class="string">"my method is executed"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的例子当中定义了一个类MyObject，该类继承了SimpleRefCount类，所以具有智能指针的特性。此外，SimpleRefCount的模板中还指定了其父类为ObjectBase，因此该类必然拥有TypeId（通过重写GetTypeId()获得），并且可以使用NS-3的属性系统。其TypeId定义了类的名字、父类的TypeId、所属的组以及构造函数。此外，我们还定义了一个私有变量m_myValue（其中m_是一个C++编码规范，说明其是一个成员变量），其类型为32位无符号整型(uint32_t)。</p>
<p>然后，我们使用AddAttribute()方法向该类的TypeId中，添加属性的描述：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">      .SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">      <marked style="border-bottom: 2px solid red;">.AddAttribute (<span class="string">"MyValue"</span>,</marked></span><br><span class="line">                   <marked style="border-bottom: 2px solid red;"><span class="string">"An example attribute"</span>,</marked></span><br><span class="line">                   <marked style="border-bottom: 2px solid red;">TypeId::ATTR_SGC,</marked></span><br><span class="line">                   <marked style="border-bottom: 2px solid red;">UintegerValue (<span class="number">100</span>),</marked></span><br><span class="line">                   <marked style="border-bottom: 2px solid red;">MakeUintegerAccessor (&amp;MyObject::m_myValue),</marked></span><br><span class="line">                   <marked style="border-bottom: 2px solid red;">MakeUintegerChecker&lt;<span class="keyword">uint32_t</span>&gt; ())</marked></span><br><span class="line">	  ;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br><span class="line">……</span><br></pre></td></tr></table></figure>
<p>这段代码向MyObject的TypeId当中添加了一个属性，这个属性有如下的特征：</p>
<ul>
<li>属性的名字叫MyValue</li>
<li>属性具有可读、可写两种特性</li>
<li>属性的初始值为100</li>
<li>属性被绑定到成员变量m_myValue上</li>
<li>属性必须满足类型是32位无符号整型，并且无(自定义的)取值范围限制</li>
</ul>
<p>此外NS-3还提供了一个CreateObject<t>()函数来创建Object子类对象的智能指针，其实现原理和上一章当中我们自己写的的CreatePtrObject<t>()类似。但是要创建的对象必须为Object的子类。</t></t></p>
<p>如果仔细观察可以发现，MyObject类的构造函数上，也对m_myValue变量进行了初始化，并且初始值为0。而此处属性框架又对该变量进行了初始化。我们运行下面的程序来查看到底哪个初始化在起作用。</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	obj-&gt;MyMethod();</span><br><span class="line">	NS_LOG_UNCOND(obj-&gt;GetMyValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后得到的结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[1816/1957] Compiling scratch/try-attribute.cc</span><br><span class="line">[1905/1957] Linking build/scratch/try-attribute</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.432s)</span><br><span class="line">MyObject:MyObject(0x12e6cf0)</span><br><span class="line">MyObject:MyMethod(0x12e6cf0)</span><br><span class="line">my method is executed</span><br><span class="line">100</span><br><span class="line">MyObject:~MyObject(0x12e6cf0)</span><br></pre></td></tr></table></figure>
<p>从输出的结果可见，属性在创建对象的过程中已经被初始化，并且初始化当中属性中的初始值覆盖了构造函数当中的初始值。其原因在于，CreateObject()函数中，创建对象时构造函数初始化成员变量之后又CreateObject()函数又调用了初始化属性的函数CompleteConsruct()：</p>
<figure class="highlight cpp"><figcaption><span>object.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">Ptr&lt;T&gt; CreateObject (<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> CompleteConstruct (<span class="keyword">new</span> T ());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">Ptr&lt;T&gt; CompleteConstruct (T *object)</span><br><span class="line">&#123;</span><br><span class="line">  object-&gt;SetTypeId (T::GetTypeId ());</span><br><span class="line">  object-&gt;Object::Construct (AttributeConstructionList ());     <span class="comment">//初始化属性</span></span><br><span class="line">  <span class="keyword">return</span> Ptr&lt;T&gt; (object, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然而，属性要能够初始化成功，还有一个必要条件，那就是属性的flags参数必须为ATTR_CONSTRUCT或者ATTR_SGC二者之一，换句话说，必须包含ATTR_CONSTRUCT。 下面我们将属性改成这两个值之外的值：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">  		.SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">      .AddAttribute (<span class="string">"MyValue"</span>,</span><br><span class="line">                   <span class="string">"An example attribute"</span>,</span><br><span class="line">                   <marked style="border-bottom: 2px solid red;">TypeId::ATTR_GET | TypeId::ATTR_SET,</marked></span><br><span class="line">                   UintegerValue (<span class="number">100</span>),</span><br><span class="line">                   MakeUintegerAccessor (&amp;MyObject::m_myValue),</span><br><span class="line">                   MakeUintegerChecker&lt;<span class="keyword">uint32_t</span>&gt; ())</span><br><span class="line">			;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br><span class="line">……</span><br></pre></td></tr></table></figure>
<p>然后再次运行程序，可以得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[ 932/1957] Compiling scratch/try-attribute.cc</span><br><span class="line">[1946/1957] Linking build/scratch/try-attribute</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.042s)</span><br><span class="line">MyObject:MyObject(0x8d4cf0)</span><br><span class="line">MyObject:MyMethod(0x8d4cf0)</span><br><span class="line">my method is executed</span><br><span class="line">0</span><br><span class="line">MyObject:~MyObject(0x8d4cf0)</span><br></pre></td></tr></table></figure>
<p>可以看出，属性并没有别初始化为100，原因在于，我们并没有允许属性在构造时初始化，因此并不会给成员变量赋值，成员变量的值仍然为构造函数所初始化的值0。</p>
<h2 id="1-3-设置和访问属性"><a href="#1-3-设置和访问属性" class="headerlink" title="1.3. 设置和访问属性"></a>1.3. 设置和访问属性</h2><p>除了调用Getter和Setter方法来访问和设置属性之外，ObjectBase还提供了GetAttribute和SetAttribute两个方法来完成同样的工作，即便是在我们自己没有实现Getter/Setter方法的情况下，这两个方法一直都存在。</p>
<p>例如，下面的例子通过SetAttribute()方法来设置属性的值，并通过GetAttribute()方法来读取属性的值：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	obj-&gt;MyMethod();</span><br><span class="line">	obj-&gt;SetAttribute(<span class="string">"MyValue"</span>, UintegerValue(<span class="number">200</span>));</span><br><span class="line">	UintegerValue myValue;</span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"MyValue"</span>, myValue);</span><br><span class="line">	NS_LOG_UNCOND(myValue.Get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[ 931/1957] Compiling scratch/try-attribute.cc</span><br><span class="line">[1929/1957] Linking build/scratch/try-attribute</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.056s)</span><br><span class="line">MyObject:MyObject(0x135fcf0)</span><br><span class="line">MyObject:MyMethod(0x135fcf0)</span><br><span class="line">my method is executed</span><br><span class="line">200</span><br><span class="line">MyObject:~MyObject(0x135fcf0)</span><br></pre></td></tr></table></figure>
<p>也可以使用CreateObjectWithAttributes()函数在创建对象的时候就设置属性，其语法和CreateObject()函数类似，但是可以添加属性的名称和值作为参数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ptr&lt;Object&gt; obj = CreateObjectWithAttributes(<span class="string">"name1"</span>, value1, <span class="string">"name2"</span>, value2, ..., <span class="string">"name9"</span>, value9);</span><br></pre></td></tr></table></figure>
<p>如上面的语法所示，这个函数可以在创建对象的时候最多设置设置9个属性（也可以完全不设置）。<strong>需要注意的是</strong>使用这种方法初始化属性，属性必须具有构造属性（TypeId::ATTR_CONSTRUCT）。例如，对于上面的例子，我们也可以在创建对象的时候就初始化其属性值：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line">	<marked style="border-bottom: 2px solid red;">Ptr&lt;MyObject&gt; obj = CreateObjectWithAttributes&lt;MyObject&gt;(<span class="string">"MyValue"</span>, UintegerValue(<span class="number">200</span>));</marked></span><br><span class="line">	obj-&gt;MyMethod();</span><br><span class="line">	UintegerValue myValue;</span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"MyValue"</span>, myValue);</span><br><span class="line">	NS_LOG_UNCOND(myValue.Get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其运行结果和上面程序一致：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[ 931/1957] Compiling scratch/try-attribute.cc</span><br><span class="line">[1946/1957] Linking build/scratch/try-attribute</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.110s)</span><br><span class="line">MyObject:MyObject(0x10d9cf0)</span><br><span class="line">MyObject:MyMethod(0x10d9cf0)</span><br><span class="line">my method is executed</span><br><span class="line">200</span><br><span class="line">MyObject:~MyObject(0x10d9cf0)</span><br></pre></td></tr></table></figure>
<h2 id="1-4-改变属性默认值"><a href="#1-4-改变属性默认值" class="headerlink" title="1.4. 改变属性默认值"></a>1.4. 改变属性默认值</h2><p>在向TypeId当中添加属性的时候，我们也默认设置了属性的默认值。然而，很多时候，我们要创建一批对象，这些对象拥有同样的属性值，然而，这些属性值又和默认值不一致。NS-3提供了一种比创建一批对象，然后一一修改他们的属性值更方便的方法：改变对象属性的默认值。这种方式就是NS-3提供的Config::SetDefault()静态方法。其语法如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Config::SetDefault(<span class="string">"ns3::ClassName::AttributeName"</span>, AttributeValue);</span><br></pre></td></tr></table></figure>
<p>可见，该方法接受两个参数，第一个参数为属性的路径，其格式为：名称空间::类名::属性名，第二个为属性的默认值，必须是NS-3属性类型（AttributeValue的子类）。</p>
<p>例如下面的程序：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	<marked style="border-bottom: 2px solid red;">Config::SetDefault(<span class="string">"ns3::MyObject::MyValue"</span>, UintegerValue(<span class="number">500</span>));</marked></span><br><span class="line">	<span class="comment">/////////////create obj1</span></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	obj-&gt;MyMethod();</span><br><span class="line">	UintegerValue myValue;</span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"MyValue"</span>, myValue);</span><br><span class="line">	NS_LOG_UNCOND(myValue.Get());</span><br><span class="line"></span><br><span class="line">	<span class="comment">////////////create another obj</span></span><br><span class="line">	Ptr&lt;MyObject&gt; obj2 = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	obj2-&gt;MyMethod();</span><br><span class="line">	UintegerValue myValue2;</span><br><span class="line">	obj2-&gt;GetAttribute(<span class="string">"MyValue"</span>, myValue2);</span><br><span class="line">	NS_LOG_UNCOND(myValue2.Get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将ns3::MyObject类的MyValue属性的默认值改为500，然后创建了两个MyObject的实例，然后观察其MyValue属性的值。其运行结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[1816/1957] Compiling scratch/try-attribute.cc</span><br><span class="line">[1946/1957] Linking build/scratch/try-attribute</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.404s)</span><br><span class="line">MyObject:MyObject(0x23bacf0)</span><br><span class="line">MyObject:MyMethod(0x23bacf0)</span><br><span class="line">my method is executed</span><br><span class="line">500</span><br><span class="line">MyObject:MyObject(0x23bae50)</span><br><span class="line">MyObject:MyMethod(0x23bae50)</span><br><span class="line">my method is executed</span><br><span class="line">500</span><br><span class="line">MyObject:~MyObject(0x23bae50)</span><br><span class="line">MyObject:~MyObject(0x23bacf0)</span><br></pre></td></tr></table></figure>
<p>由运行结果可以看出，只要修改了默认值之后，MyObject类所有的实例的MyValue属性全都被默认初始化为500。</p>
<h1 id="2-属性详解"><a href="#2-属性详解" class="headerlink" title="2. 属性详解"></a>2. 属性详解</h1><h2 id="2-1-属性值类型"><a href="#2-1-属性值类型" class="headerlink" title="2.1. 属性值类型"></a>2.1. 属性值类型</h2><p>NS-3提供了很多属性值的类型，这些类型都有一个共同的父类：AttributeValue。其申明如下：</p>
<figure class="highlight cpp"><figcaption><span>attribute.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AttributeValue</span> :</span> <span class="keyword">public</span> SimpleRefCount&lt;AttributeValue&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  AttributeValue ();</span><br><span class="line">  <span class="keyword">virtual</span> ~AttributeValue ();</span><br><span class="line">  <span class="keyword">virtual</span> Ptr&lt;AttributeValue&gt; Copy (<span class="keyword">void</span>) <span class="keyword">const</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//将属性值转换为字符串</span></span><br><span class="line">  <span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">SerializeToString</span> <span class="params">(Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//从一个字符串恢复属性的值</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">DeserializeFromString</span> <span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> value, Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line">……</span><br></pre></td></tr></table></figure>
<p>从AttributeValue的申明可以看出：</p>
<ul>
<li>AttributeValue可以支持智能指针</li>
<li>AttributeValue是抽象类，不能创建实例，只能创建其具体子类的实例</li>
<li>SerializeToString和DeserializeFromString是两个纯虚方法，必须由子类实现</li>
<li>所有AttributeValue都提供了转变成字符串的能力</li>
<li>(几乎)所有AttributeValue都提供了从字符串恢复的能力</li>
</ul>
<h2 id="2-2-属性访问器"><a href="#2-2-属性访问器" class="headerlink" title="2.2. 属性访问器"></a>2.2. 属性访问器</h2><p>在创建属性的时候，除了必须明确属性的值类型之外，还必须绑定一个属性访问器，用来确定这个最终存储这个属性值的成员变量究竟是谁。属性访问器的定义如下：</p>
<figure class="highlight cpp"><figcaption><span>attribute.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AttributeAccessor</span> :</span> <span class="keyword">public</span> SimpleRefCount&lt;AttributeAccessor&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  AttributeAccessor ();</span><br><span class="line">  <span class="keyword">virtual</span> ~AttributeAccessor ();</span><br><span class="line">  <span class="comment">//给一个对象设置属性值，成功返回true</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Set</span> <span class="params">(ObjectBase * object, <span class="keyword">const</span> AttributeValue &amp;value)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//从一个对象读取属性值，成功返回true</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Get</span> <span class="params">(<span class="keyword">const</span> ObjectBase * object, AttributeValue &amp;attribute)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//如果访问器支持读取操作，返回true</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasGetter</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//如果访问器支持设置操作，返回true</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasSetter</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>不同的属性值类型都有自己的访问器实现，这些实现完成了如何设置属性值和读取属性值的必要操作。</p>
<h2 id="2-3-属性检查器"><a href="#2-3-属性检查器" class="headerlink" title="2.3. 属性检查器"></a>2.3. 属性检查器</h2><p>属性访问器只负责读写属性的值，不负责检查属性的值是否正确。而是使用检查器确保来确保设置到属性上的值符合特殊的要求。这种设计模式符合软件工程中提倡的单一职责原则，即一个类只负责做一件事情。检查器的申明如下：</p>
<figure class="highlight cpp"><figcaption><span>attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AttributeChecker</span> :</span> <span class="keyword">public</span> SimpleRefCount&lt;AttributeChecker&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  AttributeChecker ();</span><br><span class="line">  <span class="keyword">virtual</span> ~AttributeChecker ();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//从参数中创建一个有效的属性值，或者表示成字符串</span></span><br><span class="line">  Ptr&lt;AttributeValue&gt; CreateValidValue (<span class="keyword">const</span> AttributeValue &amp;value) <span class="keyword">const</span>;</span><br><span class="line">  <span class="comment">//检查参数中的属性是否合法</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Check</span> <span class="params">(<span class="keyword">const</span> AttributeValue &amp;value)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//返回属性的值类型的名字</span></span><br><span class="line">  <span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">GetValueTypeName</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//是否含有属性底层C++类型的信息</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasUnderlyingTypeInformation</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//获得属性底层的C++类型的名字</span></span><br><span class="line">  <span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">GetUnderlyingTypeInformation</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//创建一临时的属性值对象，一般用来从字符串恢复</span></span><br><span class="line">  <span class="keyword">virtual</span> Ptr&lt;AttributeValue&gt; Create (<span class="keyword">void</span>) <span class="keyword">const</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//复制属性</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Copy</span> <span class="params">(<span class="keyword">const</span> AttributeValue &amp;source, AttributeValue &amp;destination)</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>从申明中可以看出检查器最主要的作用就是检查属性是否合法，以及从字符串恢复一个合法的属性值。</p>
<h2 id="2-4-原始类型的属性值类型"><a href="#2-4-原始类型的属性值类型" class="headerlink" title="2.4. 原始类型的属性值类型"></a>2.4. 原始类型的属性值类型</h2><p>一般来说，属性值类型、属性访问器和属性检查器总是配对出现的。不同的属性值类型总是继承自AttributeValue，例如xxx底层C++类型的属性值类型总是命名为XxxValue，然后总会实现一个配套的XxxAccessor类和一个XxxChecker类与之配套使用。</p>
<p>在NS-3当中，实现了很多的属性值类型。我们通过讲解其中最常用的原始类型的属性值类型来了解NS-3属性值类型的特性。常见的原始数据类型的属性值类型有：</p>
<ul>
<li>BooleanValue</li>
<li>DoubleValue</li>
<li>IntegerValue</li>
<li>UintegerValue</li>
<li>StringValue</li>
</ul>
<h3 id="2-4-1-BooleanValue"><a href="#2-4-1-BooleanValue" class="headerlink" title="2.4.1. BooleanValue"></a>2.4.1. BooleanValue</h3><h4 id="2-4-1-1-BooleanValue的定义"><a href="#2-4-1-1-BooleanValue的定义" class="headerlink" title="2.4.1.1. BooleanValue的定义"></a>2.4.1.1. BooleanValue的定义</h4><p>其中BooleanValue是最简单的原始属性值类型。其申明如下：</p>
<figure class="highlight cpp"><figcaption><span>boolean.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooleanValue</span> :</span> <span class="keyword">public</span> AttributeValue</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  BooleanValue ();</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Construct from an explicit value.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * \param [in] value The boolean value to begin with.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  BooleanValue (<span class="keyword">bool</span> value);</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Set</span> <span class="params">(<span class="keyword">bool</span> value)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">Get</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">GetAccessor</span> <span class="params">(T &amp;v)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Functor returning the value.</span></span><br><span class="line"><span class="comment">   * \returns The value.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">operator</span> <span class="title">bool</span> <span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">virtual</span> Ptr&lt;AttributeValue&gt; Copy (<span class="keyword">void</span>) <span class="keyword">const</span>;</span><br><span class="line">  <span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">SerializeToString</span> <span class="params">(Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker)</span> <span class="keyword">const</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">DeserializeFromString</span> <span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> value, Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">bool</span> m_value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>从中可以看出：</p>
<ul>
<li>其底层值类型为bool</li>
<li>可以在创建BooleanValue时通过构造函数参数初始化其初始值</li>
<li>可以将值转换成字符串，也可以从字符串获得其值</li>
</ul>
<p>其具体实现为：</p>
<figure class="highlight cpp"><figcaption><span>boolean.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> </span><br><span class="line">BooleanValue::SerializeToString (Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker) <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">  NS_LOG_FUNCTION (<span class="keyword">this</span> &lt;&lt; checker);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (m_value)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"true"</span>;</span><br><span class="line">    &#125; </span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"false"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">bool</span> </span><br><span class="line">BooleanValue::DeserializeFromString (<span class="built_in">std</span>::<span class="built_in">string</span> value, Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker)</span><br><span class="line">&#123;</span><br><span class="line">  NS_LOG_FUNCTION (<span class="keyword">this</span> &lt;&lt; value &lt;&lt; checker);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (value == <span class="string">"true"</span> ||</span><br><span class="line">      value == <span class="string">"1"</span> ||</span><br><span class="line">      value == <span class="string">"t"</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      m_value = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (value == <span class="string">"false"</span> ||</span><br><span class="line">           value == <span class="string">"0"</span> ||</span><br><span class="line">           value == <span class="string">"f"</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      m_value = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>可见转换成字符串时，其值会变成”true”或者”false”。而从字符串转回BooleanValue时，可以识别”true”、”1”和”t”为真，也可以识别”false”、”0”和”f”为假，如果发现其他值将转换失败。</p>
<h4 id="2-4-1-2-BooleanValue的访问器"><a href="#2-4-1-2-BooleanValue的访问器" class="headerlink" title="2.4.1.2. BooleanValue的访问器"></a>2.4.1.2. BooleanValue的访问器</h4><p>由于无需进行特殊的实现，BooleanValue中的访问器是使用NS-3提供的宏ATTRIBUTE_CHECKER_DEFINE()自动生成的：</p>
<figure class="highlight cpp"><figcaption><span>boolean.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ATTRIBUTE_CHECKER_DEFINE (Boolean);</span><br></pre></td></tr></table></figure>
<p>这个宏的定义如下：</p>
<figure class="highlight cpp"><figcaption><span>attribute-helper.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ATTRIBUTE_ACCESSOR_DEFINE(type)                                 \</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1&gt;                                                \</span><br><span class="line">  Ptr&lt;<span class="keyword">const</span> AttributeAccessor&gt; Make #<span class="meta"># type ## Accessor (T1 a1)         \</span></span><br><span class="line">  &#123;                                                                     \</span><br><span class="line">    <span class="keyword">return</span> MakeAccessorHelper&lt;type ## Value&gt; (a1);                      \</span><br><span class="line">  &#125;                                                                     \</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2&gt;                                   \</span><br><span class="line">  Ptr&lt;<span class="keyword">const</span> AttributeAccessor&gt; Make #<span class="meta"># type ## Accessor (T1 a1, T2 a2)  \</span></span><br><span class="line">  &#123;                                                                     \</span><br><span class="line">    <span class="keyword">return</span> MakeAccessorHelper&lt;type ## Value&gt; (a1, a2);                  \</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>可见，这个宏会展开成两个函数：</p>
<ul>
<li>MakeBooleanAccessor(BooleanValue a1): 只有一个参数，接受类的成员变量的地址</li>
<li>MakeBooleanAccessor(BooleanValue a1, BooleanValue a2): 有两个参数，分别接受成员变量的Getter和Setter方法。</li>
</ul>
<p>我们姑且将第一个函数返回的访问器称为<strong>变量访问器</strong>，而将第二种函数返回的访问器称为<strong>方法访问器</strong>。</p>
<p>例如，我们可以使用变量访问器：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MakeBooleanAccessor(&amp;MyObject::m_myBoolValue);</span><br></pre></td></tr></table></figure>
<p>也可以使用等价的方法访问器：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MakeBooleanAccessor(&amp;MyObject::GetMyBoolValue, &amp;MyObject::SetMyBoolValue);</span><br></pre></td></tr></table></figure>
<p>来定义BooleanValue的访问器。</p>
<h4 id="2-4-1-3-BooleanValue的检查器"><a href="#2-4-1-3-BooleanValue的检查器" class="headerlink" title="2.4.1.3. BooleanValue的检查器"></a>2.4.1.3. BooleanValue的检查器</h4><p>由于BooleanValue无需进行范围等合法性的检查，NS-3默认使用了宏来生成访问器的标准实现，首先在头文件里调用了检查器申明宏模板：</p>
<figure class="highlight cpp"><figcaption><span>boolean.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ATTRIBUTE_CHECKER_DEFINE (Boolean);</span><br></pre></td></tr></table></figure>
<p>这个宏的定义如下：</p>
<figure class="highlight cpp"><figcaption><span>attribute-helper.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ATTRIBUTE_CHECKER_DEFINE(type)                                  \</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">type</span> ## <span class="title">Checker</span> :</span> <span class="keyword">public</span> AttributeChecker &#123;&#125;;                   \</span><br><span class="line">  Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; Make #<span class="meta"># type ## Checker (void)</span></span><br></pre></td></tr></table></figure>
<p>可见，这个宏展开之后，其实是生成了一个BooleanChecker类和一个MakeBooleanChecker()函数。</p>
<p>这个方法的定义在Boolean类的源文件中通过调用检查器生成宏模板来定义：</p>
<figure class="highlight cpp"><figcaption><span>boolean.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ATTRIBUTE_CHECKER_IMPLEMENT_WITH_NAME (Boolean,<span class="string">"bool"</span>);</span><br></pre></td></tr></table></figure>
<p>这个宏的定义如下：</p>
<figure class="highlight cpp"><figcaption><span>attribute-helper.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ATTRIBUTE_CHECKER_IMPLEMENT_WITH_NAME(type,name)                \</span></span><br><span class="line">  Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; Make #<span class="meta"># type ## Checker (void) &#123;          \</span></span><br><span class="line">    <span class="keyword">return</span> MakeSimpleAttributeChecker&lt;type ## Value,type ## Checker&gt;    \</span><br><span class="line">      (# type <span class="string">"Value"</span>, name);                                           \</span><br><span class="line">  &#125;                                                                     \</span><br></pre></td></tr></table></figure>
<p>由此可见，调用MakeBooleanChecker()函数实际上是返回了一个通过MakeSimpleAttributreChecker()函数生成的类，这个类实际上实现通过底层的SimpleAttributeChecker类实现了BooleanChecker类的各种默认方法。这个默认的BooleanChecker类实际上没有做任何实质性的检查，只是判断了一下类型是否兼容。</p>
<h4 id="2-4-1-4-BooleanValue的使用"><a href="#2-4-1-4-BooleanValue的使用" class="headerlink" title="2.4.1.4. BooleanValue的使用"></a>2.4.1.4. BooleanValue的使用</h4><p>到此为止，整个BooleanValue类已经定义完成。如果到此为止，还是暂时看不懂究竟是如何实现的，也很正常。这种方式涉及到很多C++模板的高阶应用范式。此处也不追求必须把BooleanValue属性的定义完全看懂，初学阶段只要大概知道如何使用，以及我们用的这些方法都是在哪里定义的即可。等以后要自己写属性值类型时，可以在从最简单的BooleanValue入手分析，然后慢慢理解，以至于最终能够自己写出一个自定义的属性值类型。</p>
<p>接下来，我们通过给前面的MyObject类的例子添加一个布尔类型的属性值来学习如何使用BooleanValue。</p>
<p>首先，MyObject类当中还是需要有一个成员变量(m_myBoolValue)来存储属性值，例如：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ns3 &#123;		<span class="comment">//一般建议将所有对象都写在ns3名称空间中</span></span><br><span class="line"></span><br><span class="line">  NS_LOG_COMPONENT_DEFINE (<span class="string">"MyObject"</span>);			<span class="comment">//定义一个日志组件</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> :</span> <span class="keyword">public</span> Object	<span class="comment">//继承自SimpleRefCount，又继承自ObjectBase</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">    MyObject ();</span><br><span class="line">    <span class="keyword">virtual</span> ~MyObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//业务方法</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MyMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint32_t</span></span><br><span class="line">    GetMyValue () <span class="keyword">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> m_myValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span></span><br><span class="line">    SetMyValue (<span class="keyword">uint32_t</span> myValue)</span><br><span class="line">    &#123;</span><br><span class="line">        m_myValue = myValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">uint32_t</span> m_myValue;</span><br><span class="line">    <span class="keyword">bool</span> m_myBoolValue;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其次，需要在TypeId中添加属性的描述：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">  		.SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">      .AddAttribute (<span class="string">"MyValue"</span>,</span><br><span class="line">                   <span class="string">"An example attribute"</span>,</span><br><span class="line">                   TypeId::ATTR_SGC,</span><br><span class="line">                   UintegerValue (<span class="number">100</span>),</span><br><span class="line">                   MakeUintegerAccessor (&amp;MyObject::m_myValue),</span><br><span class="line">                   MakeUintegerChecker&lt;<span class="keyword">uint32_t</span>&gt; ())</span><br><span class="line">      <marked style="border-bottom: 2px solid red;">.AddAttribute (<span class="string">"MyBoolValue"</span>,</marked></span><br><span class="line">                   <marked style="border-bottom: 2px solid red;"><span class="string">"An example bool attribute"</span>,</marked></span><br><span class="line">                   <marked style="border-bottom: 2px solid red;">BooleanValue (<span class="literal">false</span>),</marked></span><br><span class="line">                   <marked style="border-bottom: 2px solid red;">MakeBooleanAccessor (&amp;MyObject::m_myBoolValue),</marked></span><br><span class="line">                   <marked style="border-bottom: 2px solid red;">MakeBooleanChecker ())</marked></span><br><span class="line">			;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>由最开始的分析可知，我们可以省略AddAtrribute()方法当中的flags参数，表明该属性支持读写和构造初始化。此外，我们使用的是变量访问器，如果m_myBoolValue具有Getter和Setter方法，我们也可以使用方法访问器：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">  		.SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">      .AddAttribute (<span class="string">"MyValue"</span>,</span><br><span class="line">                   <span class="string">"An example attribute"</span>,</span><br><span class="line">                   TypeId::ATTR_SGC,</span><br><span class="line">                   UintegerValue (<span class="number">100</span>),</span><br><span class="line">                   MakeUintegerAccessor (&amp;MyObject::m_myValue),</span><br><span class="line">                   MakeUintegerChecker&lt;<span class="keyword">uint32_t</span>&gt; ())</span><br><span class="line">      .AddAttribute (<span class="string">"MyBoolValue"</span>,</span><br><span class="line">                   <span class="string">"An example bool attribute"</span>,</span><br><span class="line">                   BooleanValue (<span class="literal">false</span>),</span><br><span class="line">                   <marked style="border-bottom: 2px solid red;">MakeBooleanAccessor (&amp;MyObject::IsMyBoolValue, &amp;MyObject::SetMyBoolValue),</marked></span><br><span class="line">                   MakeBooleanChecker ())</span><br><span class="line">			;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>例子中，属性MyValue的初始值为false。当我们设置属性值的时候是通过调用SetMyBoolValue()方法实现的，而当我们获取属性值的时候是通过GetMyBoolValue实现的。假设我们在GetMyBoolValue()和SetMyBoolValue()方法当中输出一些信息：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span></span><br><span class="line">   IsMyBoolValue () <span class="keyword">const</span></span><br><span class="line">   &#123;</span><br><span class="line">       NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">       <span class="keyword">return</span> m_myBoolValue;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">void</span></span><br><span class="line">   SetMyBoolValue (<span class="keyword">bool</span> myBoolValue)</span><br><span class="line">   &#123;</span><br><span class="line">       NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">       m_myBoolValue = myBoolValue;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>我们运行下面的程序，来验证属性设置的执行过程：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	obj-&gt;SetAttribute(<span class="string">"MyBoolValue"</span>, BooleanValue(<span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">	BooleanValue value;</span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"MyBoolValue"</span>, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行该程序得到如下的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[1819/1957] Compiling scratch/try-attribute.cc</span><br><span class="line">[1946/1957] Linking build/scratch/try-attribute</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.384s)</span><br><span class="line">MyObject:MyObject(0x10024d0)</span><br><span class="line">MyObject:SetMyBoolValue(0x10024d0)</span><br><span class="line">MyObject:SetMyBoolValue(0x10024d0)</span><br><span class="line">MyObject:IsMyBoolValue(0x10024d0)</span><br><span class="line">MyObject:~MyObject(0x10024d0)</span><br></pre></td></tr></table></figure>
<p>可见，SetMyBoolValue()方法被调用了两次，第一次是初始化的时候调用的，第二次是我们设置通过调用SetAttribute()执行的。而IsMyBoolValue()方法执行了一次，因为我们调用了GetAttribute()方法。这个例子说明，如果我们的Getter/Setter方法当中实现了一些成员变量操作的业务逻辑，那么当我们使用方法访问器的时候，属性系统完全会遵守这些逻辑；然而当使用变量访问器的时候，会跳过这些业务逻辑对成员变量的值进行修改，这种情况下，容易给属性赋一些不合理的值。变量访问其的执行速度稍稍快一点。具体到底选用哪种访问器，需要按实际情况进行选择。</p>
<h3 id="2-4-2-DoubleValue"><a href="#2-4-2-DoubleValue" class="headerlink" title="2.4.2. DoubleValue"></a>2.4.2. DoubleValue</h3><p>如果属性的值是浮点型（float或者double），那么NS-3提供了DoubleValue属性值类型。DoubleValue的实现与BooleanValue基本一致。唯一的区别是DoubleValue的检查器的实现更为丰富。</p>
<h4 id="2-4-2-1-DoubleValue的检查器"><a href="#2-4-2-1-DoubleValue的检查器" class="headerlink" title="2.4.2.1. DoubleValue的检查器"></a>2.4.2.1. DoubleValue的检查器</h4><p>DoubleValue除了提供和BooleanValue类似的无参检查其创建函数之外，还提供两个有参的检查器创建函数：</p>
<figure class="highlight cpp"><figcaption><span>double.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeDoubleChecker (<span class="keyword">double</span> min);</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeDoubleChecker (<span class="keyword">double</span> min, <span class="keyword">double</span> max);</span><br></pre></td></tr></table></figure>
<p>通过参数的名字也可以大概猜到这两个检查器创建函数的意义：</p>
<ul>
<li>第一个函数创建的检查器，将检查属性的值，如果属性的值小于某个值，则检查不通过，属性赋值失败</li>
<li>第二个函数创建的检查器，将检查属性的值，如果属性的值不在某个范围内，则检查不通过，赋值失败</li>
</ul>
<p>换句话说，属性的值必须大于等于min并且小于等于max才能赋值成功，如果没有max参数，则不检查属性值的大小。需要注意的DoubleValueChecker可以同时支持单精度和双精度两种浮点值类型，区别在于调用检查器创建函数的时候的时候需要通过模板参数指定具体类型，例如：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MakeDoubleChecker&lt;<span class="keyword">double</span>&gt;();</span><br><span class="line">MakeDoubleChecker&lt;<span class="keyword">float</span>&gt;(<span class="number">50.5</span>);</span><br><span class="line">MakeDoubleChecker&lt;<span class="keyword">double</span>&gt;(<span class="number">9.9</span>, <span class="number">99.9</span>);</span><br></pre></td></tr></table></figure>
<p>这么做的原因在于，如果属性的底层变量是float类型，那么将double类型的值设置到属性，有可能存在数值溢出的风险。因此检查器必须先检查类型是否兼容。</p>
<h4 id="2-4-2-2-DoubleValue的使用"><a href="#2-4-2-2-DoubleValue的使用" class="headerlink" title="2.4.2.2. DoubleValue的使用"></a>2.4.2.2. DoubleValue的使用</h4><p>首先，向类中添加double类型的成员变量：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> :</span> <span class="keyword">public</span> Object	<span class="comment">//继承自SimpleRefCount，又继承自ObjectBase</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">  MyObject ();</span><br><span class="line">  <span class="keyword">virtual</span> ~MyObject();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//业务方法</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MyMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint32_t</span></span><br><span class="line">GetMyValue () <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> m_myValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">SetMyValue (<span class="keyword">uint32_t</span> myValue)</span><br><span class="line">&#123;</span><br><span class="line">	m_myValue = myValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span></span><br><span class="line">IsMyBoolValue () <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">	<span class="keyword">return</span> m_myBoolValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">SetMyBoolValue (<span class="keyword">bool</span> myBoolValue)</span><br><span class="line">&#123;</span><br><span class="line">	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">	m_myBoolValue = myBoolValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">uint32_t</span> m_myValue;</span><br><span class="line">  <span class="keyword">bool</span> m_myBoolValue;</span><br><span class="line">  <span class="keyword">double</span> m_myDoubleValue;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>其次，向TypeId中添加属性：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">TypeId</span><br><span class="line">MyObject::GetTypeId ()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">		.SetParent(Object::GetTypeId())</span><br><span class="line">    .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">    .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">    .AddAttribute (<span class="string">"MyValue"</span>,</span><br><span class="line">                 <span class="string">"An example attribute"</span>,</span><br><span class="line">                 TypeId::ATTR_SGC,</span><br><span class="line">                 UintegerValue (<span class="number">100</span>),</span><br><span class="line">                 MakeUintegerAccessor (&amp;MyObject::m_myValue),</span><br><span class="line">                 MakeUintegerChecker&lt;<span class="keyword">uint32_t</span>&gt; ())</span><br><span class="line">    .AddAttribute (<span class="string">"MyBoolValue"</span>,</span><br><span class="line">                 <span class="string">"An example bool attribute"</span>,</span><br><span class="line">                 BooleanValue (<span class="literal">false</span>),</span><br><span class="line">                 MakeBooleanAccessor (&amp;MyObject::IsMyBoolValue, &amp;MyObject::SetMyBoolValue),</span><br><span class="line">                 MakeBooleanChecker ())</span><br><span class="line">    <marked style="border-bottom: 2px solid red;">.AddAttribute (<span class="string">"MyDoubleValue"</span>,</marked></span><br><span class="line">                 <marked style="border-bottom: 2px solid red;"><span class="string">"An example double attribute"</span>,</marked></span><br><span class="line">                 <marked style="border-bottom: 2px solid red;">DoubleValue (<span class="number">0.0</span>),</marked></span><br><span class="line">                 <marked style="border-bottom: 2px solid red;">MakeDoubleAccessor (&amp;MyObject::m_myDoubleValue),</marked></span><br><span class="line">                 <marked style="border-bottom: 2px solid red;">MakeDoubleChecker&lt;<span class="keyword">double</span>&gt; (<span class="number">5</span>))</marked></span><br><span class="line">	;</span><br><span class="line">	<span class="keyword">return</span> tid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码中，我们创建的检查器具有两个特征：需要识别类型能不能赋值给double类型；其次，检查类型是不是大于等于5。</p>
<p>我们用以下的程序来验证：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	obj-&gt;SetAttribute(<span class="string">"MyDoubleValue"</span>, DoubleValue(<span class="number">3</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序得到如下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[1818/1957] Compiling scratch/try-attribute.cc</span><br><span class="line">[1929/1957] Linking build/scratch/try-attribute</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.519s)</span><br><span class="line">MyObject:MyObject(0xc7e4d0)</span><br><span class="line">MyObject:SetMyBoolValue(0xc7e4d0)</span><br><span class="line">msg=&quot;Attribute name=MyDoubleValue could not be set for this object: tid=ns3::MyObject&quot;, file=../src/core/model/object-base.cc, line=201</span><br><span class="line">terminate called without an active exception</span><br><span class="line">Command [&apos;/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build/scratch/try-attribute&apos;] terminated with signal SIGIOT. Run it under a debugger to get more information (./waf --run &lt;program&gt; --command-template=&quot;gdb --args %s &lt;args&gt;&quot;).</span><br></pre></td></tr></table></figure>
<p>可见，当给属性赋值小于5时，赋值是无法成功的，程序将中途终止运行。然而遗憾的是，目前NS-3的实现中，错误仅能提示属性设置错误，并提示哪个对象的什么属性赋值错误，然而并不能给出具体的原因（违反了哪个检查器的原则），这也给调试带来了一定的麻烦。</p>
<p>要解决上面的问题，只要将属性值改为大于等于5即可：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	obj-&gt;SetAttribute(<span class="string">"MyDoubleValue"</span>, DoubleValue(<span class="number">5</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即可赋值成功。</p>
<p>除此之外，在NS-3当中，如果DoubleValue不指定最大值，那么检查的最大值将由当前类型所能表达的最大值决定。例如，在我的电脑中，double类型所能表示的最大值为1.7×10^308，超过这个值将无法赋值成功。值得注意的是，在不同的电脑和编译器上，double类型的值的上限可能是不同的，具体要看编译器的实现。</p>
<p>除了对范围进行检查之外，DobuleChecker还将对底层类型进行检查，如果超出底层类型所能表示的范围也将无法赋值成功。例如，我们如果将类型改为float类型：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> :</span> <span class="keyword">public</span> Object	<span class="comment">//继承自SimpleRefCount，又继承自ObjectBase</span></span><br><span class="line">  &#123;</span><br><span class="line">    ……</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    ……</span><br><span class="line">    <span class="keyword">double</span> m_myDoubleValue;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ……</span><br><span class="line"></span><br><span class="line">    .AddAttribute (<span class="string">"MyDoubleValue"</span>,</span><br><span class="line">                <span class="string">"An example double attribute"</span>,</span><br><span class="line">                DoubleValue (<span class="number">0.0</span>),</span><br><span class="line">                MakeDoubleAccessor (&amp;MyObject::m_myDoubleValue),</span><br><span class="line">                MakeDoubleChecker&lt;<span class="keyword">float</span>&gt; (<span class="number">5</span>))</span><br><span class="line">  …… </span><br></pre></td></tr></table></figure>
<p>那么在设置属性值的时候，如果所设置的值超出了float类型所能表示的范围，也将赋值失败。例如：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	obj-&gt;SetAttribute(<span class="string">"MyDoubleValue"</span>, DoubleValue(<span class="number">1e40</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将得到运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (1.114s)</span><br><span class="line">MyObject:MyObject(0x11e04d0)</span><br><span class="line">MyObject:SetMyBoolValue(0x11e04d0)</span><br><span class="line">msg=&quot;Attribute name=MyDoubleValue could not be set for this object: tid=ns3::MyObject&quot;, file=../src/core/model/object-base.cc, line=201</span><br><span class="line">terminate called without an active exception</span><br><span class="line">Command [&apos;/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build/scratch/try-attribute&apos;] terminated with signal SIGIOT. Run it under a debugger to get more information (./waf --run &lt;program&gt; --command-template=&quot;gdb --args %s &lt;args&gt;&quot;).</span><br></pre></td></tr></table></figure>
<p>同样也是提示无法赋值，但是也无法得知具体原因。</p>
<h3 id="2-4-3-IntegerValue和UintegerValue"><a href="#2-4-3-IntegerValue和UintegerValue" class="headerlink" title="2.4.3. IntegerValue和UintegerValue"></a>2.4.3. IntegerValue和UintegerValue</h3><p>IntegerValue表示整型属性值类型，而UintegerValue表示无符号整型属性值类型。他们的用法与DoubleValue非常类似：他们的检查器必须指定类型，此外，还可以指定最小值与最大值。如果最大值未指定，那么将有类型的最大值来限制。</p>
<p>整型与无符号整型所能表示的最大原始类型为64位整型：int64_t与uint64_t。而取值范围小于64位的整型类型都能表示，例如：(u)int8_t、(u)int16_t和(u)int32_t等。可以通过检查器创建函数来指定检查的具体类型和检查的取值范围：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MakeIntegerChecker&lt;<span class="keyword">int8_t</span>&gt;();</span><br><span class="line">MakeUintegerChecker&lt;<span class="keyword">uint16_t</span>&gt;(<span class="number">10</span>);</span><br><span class="line">MakeUintegerChecker&lt;<span class="keyword">uint32_t</span>&gt;(<span class="number">0</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<p>其具体使用方法和DoubleValue非常类似，在此不再赘述。</p>
<h3 id="2-4-4-StringValue"><a href="#2-4-4-StringValue" class="headerlink" title="2.4.4. StringValue"></a>2.4.4. StringValue</h3><h4 id="2-4-4-1-StringValue的定义"><a href="#2-4-4-1-StringValue的定义" class="headerlink" title="2.4.4.1. StringValue的定义"></a>2.4.4.1. StringValue的定义</h4><p>StringValue用来表示底层类型为std::string的属性值类型。其定义非常简单，所有类型全是由NS-3的宏自动展开的：</p>
<figure class="highlight cpp"><figcaption><span>string.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"attribute-helper.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ns3 &#123;</span><br><span class="line"></span><br><span class="line">ATTRIBUTE_VALUE_DEFINE_WITH_NAME (<span class="built_in">std</span>::<span class="built_in">string</span>, String);</span><br><span class="line">ATTRIBUTE_ACCESSOR_DEFINE (String);</span><br><span class="line">ATTRIBUTE_CHECKER_DEFINE (String);</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// namespace ns3</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>string.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ns3 &#123;</span><br><span class="line"></span><br><span class="line">ATTRIBUTE_CHECKER_IMPLEMENT_WITH_NAME (String, <span class="string">"std::string"</span>);</span><br><span class="line">ATTRIBUTE_VALUE_IMPLEMENT_WITH_NAME (<span class="built_in">std</span>::<span class="built_in">string</span>, String);</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// namespace ns3</span></span><br></pre></td></tr></table></figure>
<h4 id="2-4-4-2-StringValue的自动类型转换"><a href="#2-4-4-2-StringValue的自动类型转换" class="headerlink" title="2.4.4.2. StringValue的自动类型转换"></a>2.4.4.2. StringValue的自动类型转换</h4><p>StringValue本身并没有特别之处。如果底层类型是std::string类型，都可以用StringValue来将其定义为属性。定义的方法和上面所有的属性类似，其值也无需进行任何检查，只要符合字符串类型标准即可。</p>
<p>然而，NS-3当中的StringValue最大的特色在于，（几乎）<strong>任何其他的属性值类型都能使用StringValue表示，并且赋值成功</strong>。其原因在于所有属性值类型的父类AttributeValue当中定义了DeserializeFromString虚方法。因此，任何子类都必须实现此方法，也就具备了将字符串转换成具体属性值的能力。</p>
<p>例如，在上面的例子中，我们定义了UintegerValue、BooleanValue和DoubleValue属性。我们可以使用StringValue对这些属性进行设置：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	<marked style="border-bottom: 2px solid red;">obj-&gt;SetAttribute(<span class="string">"MyValue"</span>, StringValue(<span class="string">"1000"</span>));</marked></span><br><span class="line">	<marked style="border-bottom: 2px solid red;">obj-&gt;SetAttribute(<span class="string">"MyBoolValue"</span>, StringValue(<span class="string">"t"</span>));</marked></span><br><span class="line">	<marked style="border-bottom: 2px solid red;">obj-&gt;SetAttribute(<span class="string">"MyDoubleValue"</span>, StringValue(<span class="string">"5.5"</span>));</marked></span><br><span class="line"></span><br><span class="line">	StringValue value;</span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"MyValue"</span>, value);</span><br><span class="line">	NS_LOG_UNCOND(value.Get());</span><br><span class="line"></span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"MyBoolValue"</span>, value);</span><br><span class="line">	NS_LOG_UNCOND(value.Get());</span><br><span class="line"></span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"MyDoubleValue"</span>, value);</span><br><span class="line">	NS_LOG_UNCOND(value.Get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序将得到如下的运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[ 931/1957] Compiling scratch/try-attribute.cc</span><br><span class="line">[1916/1957] Linking build/scratch/try-attribute</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.226s)</span><br><span class="line">MyObject:MyObject(0x22b64d0)</span><br><span class="line">MyObject:SetMyBoolValue(0x22b64d0)</span><br><span class="line">MyObject:SetMyBoolValue(0x22b64d0)</span><br><span class="line">1000</span><br><span class="line">MyObject:IsMyBoolValue(0x22b64d0)</span><br><span class="line">true</span><br><span class="line">5.5</span><br><span class="line">MyObject:~MyObject(0x22b64d0)</span><br></pre></td></tr></table></figure>
<p>可以看出，无论是何种类，都能通过StringValue进行设置与读取。以后我们将会看到，这对于一些复杂的属性值类型的设置将会非常方便。</p>
<h4 id="2-4-4-3-StringValue的手动类型转换"><a href="#2-4-4-3-StringValue的手动类型转换" class="headerlink" title="2.4.4.3. StringValue的手动类型转换"></a>2.4.4.3. StringValue的手动类型转换</h4><p>此外，如果有一个StringValue，我们可以通过如下的方式将其转换成想要的属性值类型：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	<span class="function">StringValue <span class="title">value</span><span class="params">(<span class="string">"5.5"</span>)</span></span>;</span><br><span class="line">	Ptr&lt;DoubleValue&gt; doubleValue = DynamicCast&lt;DoubleValue&gt;(MakeDoubleChecker&lt;<span class="keyword">double</span>&gt;()-&gt;CreateValidValue(value));</span><br><span class="line">	<span class="keyword">double</span> number = doubleValue-&gt;Get();</span><br><span class="line">	NS_LOG_UNCOND(number);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，前提是，目标类型和StringValue的值必须兼容。上面例子中使用DoubleChecker来检查，StringValue中封装的值是否符合DoubleValue的要求。</p>
<p>这种方式只适用于将StringValue类型转换成其他属性值类型。如果要将任何其他类型转换为StringValue值类型，可以使用如下的方法：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	<span class="function">DoubleValue <span class="title">value</span><span class="params">(<span class="number">5.5</span>)</span></span>;</span><br><span class="line">	StringValue stringValue(value.SerializeToString(MakeStringChecker()));</span><br><span class="line">	NS_LOG_UNCOND(stringValue.Get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-5-枚举类型的属性值类型"><a href="#2-5-枚举类型的属性值类型" class="headerlink" title="2.5. 枚举类型的属性值类型"></a>2.5. 枚举类型的属性值类型</h2><p>有些变量的取值范围不是连续的，而是离散的，那么可以使用C++的枚举类型来定义。在NS-3中，可以将枚举类型定义为属性的值类型EnumValue。</p>
<h3 id="2-5-1-EnumValue的访问器"><a href="#2-5-1-EnumValue的访问器" class="headerlink" title="2.5.1. EnumValue的访问器"></a>2.5.1. EnumValue的访问器</h3><p>EnumValue的访问器和其他属性值类型的访问器没有区别，分为变量访问器和函数访问器两种，分别通过函数：</p>
<figure class="highlight cpp"><figcaption><span>enum.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1&gt;</span><br><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeAccessor&gt; MakeEnumAccessor (T1 a1)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> MakeAccessorHelper&lt;EnumValue&gt; (a1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>enum.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2&gt;</span><br><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeAccessor&gt; MakeEnumAccessor (T1 a1, T2 a2)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> MakeAccessorHelper&lt;EnumValue&gt; (a1, a2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>来创建。</p>
<h3 id="2-5-2-EnumValue的检查器"><a href="#2-5-2-EnumValue的检查器" class="headerlink" title="2.5.2. EnumValue的检查器"></a>2.5.2. EnumValue的检查器</h3><p>EnumValue的检查器主要用来检查取值是否在枚举类型列表当中，在创建检查器的时候需要传入枚举类型值的列表。NS-3提供了函数来创建EnumValue的检查器：</p>
<figure class="highlight cpp"><figcaption><span>enum.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeEnumChecker (<span class="keyword">int</span> v1, <span class="built_in">std</span>::<span class="built_in">string</span> n1,</span><br><span class="line">                                             <span class="keyword">int</span> v2 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n2 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v3 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n3 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v4 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n4 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v5 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n5 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v6 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n6 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v7 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n7 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v8 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n8 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v9 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n9 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v10 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n10 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v11 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n11 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v12 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n12 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v13 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n13 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v14 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n14 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v15 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n15 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v16 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n16 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v17 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n17 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v18 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n18 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v19 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n19 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v20 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n20 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v21 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n21 = <span class="string">""</span>,</span><br><span class="line">                                             <span class="keyword">int</span> v22 = <span class="number">0</span>, <span class="built_in">std</span>::<span class="built_in">string</span> n22 = <span class="string">""</span>);</span><br></pre></td></tr></table></figure>
<p>该函数可以传入21个及以下个不同的枚举类型值，并且每个值都对应一个相应的字符串名字，以后可以直接输出该字符串的名字，以方便调试。此外，这个字符串名字还可以用于使用字符串值类型对属性赋值。</p>
<h3 id="2-5-3-EnumValue的使用"><a href="#2-5-3-EnumValue的使用" class="headerlink" title="2.5.3. EnumValue的使用"></a>2.5.3. EnumValue的使用</h3><p>下面的程序演示了如何使用EnumValue值：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ns3 &#123;		<span class="comment">//一般建议将所有对象都写在ns3名称空间中</span></span><br><span class="line"></span><br><span class="line">  NS_LOG_COMPONENT_DEFINE (<span class="string">"MyObject"</span>);			<span class="comment">//定义一个日志组件</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> :</span> <span class="keyword">public</span> Object	<span class="comment">//继承自SimpleRefCount，又继承自ObjectBase</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">  	<span class="keyword">enum</span> UsbTypeEnum&#123;</span><br><span class="line">  		Type_A,</span><br><span class="line">			Type_B,</span><br><span class="line">			Type_C</span><br><span class="line">  	&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line">    <marked style="border-bottom: 2px solid red;"><span class="keyword">static</span> Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; GetUsbTypeEnumChecker();</marked></span><br><span class="line"></span><br><span class="line">    MyObject ();</span><br><span class="line">    <span class="keyword">virtual</span> ~MyObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//业务方法</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MyMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    UsbTypeEnum m_usbType;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  NS_OBJECT_ENSURE_REGISTERED (MyObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">  TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">  		.SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">      .AddAttribute (<span class="string">"TestEnum"</span>, <span class="string">"help text"</span>,</span><br><span class="line">                     EnumValue (Type_A),</span><br><span class="line">                     MakeEnumAccessor (&amp;MyObject::m_usbType),</span><br><span class="line">                     GetUsbTypeEnumChecker())</span><br><span class="line">			;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::~MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt;</span><br><span class="line">	MyObject::GetUsbTypeEnumChecker ()</span><br><span class="line">	&#123;</span><br><span class="line">  	<span class="keyword">static</span> Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; usbTypeEnumChecker = </span><br><span class="line">            MakeEnumChecker (Type_A, <span class="string">"USB Type A"</span>,</span><br><span class="line">                            Type_B, <span class="string">"USB Type B"</span>,</span><br><span class="line">                            Type_C, <span class="string">"USB Type C"</span>);</span><br><span class="line"></span><br><span class="line">  	<span class="keyword">return</span> usbTypeEnumChecker;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span></span><br><span class="line">	MyObject::MyMethod ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		NS_LOG_UNCOND(<span class="string">"my method is executed"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	obj-&gt;SetAttribute(<span class="string">"TestEnum"</span>, StringValue(<span class="string">"USB Type B"</span>));</span><br><span class="line">	EnumValue value;</span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"TestEnum"</span>, value);</span><br><span class="line">	NS_LOG_UNCOND(value.SerializeToString(MyObject::GetUsbTypeEnumChecker()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序首先定义了一个MyObject类，然后在类中定义了一个标准的C++枚举类型UsbTypeEnum，其中包含三个枚举值：Type_A, Type_B和Type_C。然后，程序在MyObject类中定义了一个属性m_usbType，其类型正好是刚刚定义的枚举类型UsbTypeEnum。随后，程序在GetTypeId()方法当中创建TypeId的时候定义了一个枚举值类型的属性TestEnum，该属性的默认值是Type_A。枚举值属性的可选值是由属性检查其确定的。程序中使用静态方法GetUsbTypeEnumChecker()创建了一个EnumValue类型的检查器，同时，这个检查器实例也是静态的。（之所以使用静态方法创建静态变量是因为后面用到该检查器的时候可以直接调用，而不会重新创建。）<strong>注意</strong>，属性的可选值与枚举类型的值可以不一致，例如可选值可以只传入Type_A和Type_B。在上面的程序中，可选值为：Type_A、Type_B和Type_C。最后在主函数中，我们创建了一个MyObject对象，然后将其TestEnum属性设置为Type_B。设置的过程中，是通过StringValue类型设置的。能够设置成功的原因是NS-3中所有的属性值类型都能使用StringValue表示。然后我们从对象当中取出TestEnum属性值，并将该属性值的转换成字符串输出。将属性值转换为字符串的时候会用到检查器，因此我们需要使用前面创建的静态方法GetUsbTypeNeumChecker()来获取检查器的实例。</p>
<p>对于已经存在的类（例如NS-3已经提供的类，或者第三方类库当中的类，已经编译成.so文件）我们就无法添加GetChecker()方法来返回检查器了。在这种情况下，我们可以写一个辅助函数来从TypeId当中获取相应的检查器：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; getCheckerByName(TypeId typeId, <span class="built_in">std</span>::<span class="built_in">string</span> attributeName) &#123;</span><br><span class="line">	TypeId::AttributeInformation * info = <span class="keyword">new</span> TypeId::AttributeInformation();</span><br><span class="line">	typeId.LookupAttributeByName(<span class="string">"TestEnum"</span>, info);</span><br><span class="line">	Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker = info-&gt;checker;</span><br><span class="line">	<span class="keyword">delete</span> info;</span><br><span class="line">	<span class="keyword">return</span> checker;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时，我们的主函数将变为：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	obj-&gt;SetAttribute(<span class="string">"TestEnum"</span>, StringValue(<span class="string">"USB Type B"</span>));</span><br><span class="line">	EnumValue value;</span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"TestEnum"</span>, value);</span><br><span class="line">	<marked style="border-bottom: 2px solid red;">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker = getCheckerByName(MyObject::GetTypeId(), <span class="string">"TestEnum"</span>);</marked></span><br><span class="line">	NS_LOG_UNCOND(value.SerializeToString(checker));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>两种方式的效果相同。运行程序后得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[ 931/1957] Compiling scratch/try-attribute.cc</span><br><span class="line">[1946/1957] Linking build/scratch/try-attribute</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.032s)</span><br><span class="line">MyObject:MyObject(0x1539e50)</span><br><span class="line">USB Type B</span><br><span class="line">MyObject:~MyObject(0x1539e50)</span><br></pre></td></tr></table></figure>
<p>可见，属性值能够成功的设置与读取。</p>
<h2 id="2-6-对象指针属性"><a href="#2-6-对象指针属性" class="headerlink" title="2.6. 对象指针属性"></a>2.6. 对象指针属性</h2><h3 id="2-6-1-单个对象"><a href="#2-6-1-单个对象" class="headerlink" title="2.6.1. 单个对象"></a>2.6.1. 单个对象</h3><p>前面主要介绍的几种属性值类型都是原始数据类型（枚举类型其实也是原始数据类型，因为它主要还是被当做int类型来处理的）。但是在很多时候，有些对象的属性不一定是一个原始的值类型，而是一个其他对象。在这种情况下，就需要使用到对象指针属性PointerValue，来将其他对象的智能指针作为属性值。</p>
<p>PoitnerValue的访问器的创建和其他属性值类型无区别，都是用变量访问器和方法访问器来创建。其检查器和其他类型也一致，但是要使用模板的方法指定其引用的对象类型，例如：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MakePointerChecker &lt;RandomVariableStream&gt;();</span><br></pre></td></tr></table></figure>
<p>其中RandomVariableStream就是属性可以设置的对象类型。</p>
<p>我们通过下面的例子来了解PointerValue的应用：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-object.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ns3 &#123;		<span class="comment">//一般建议将所有对象都写在ns3名称空间中</span></span><br><span class="line"></span><br><span class="line">  NS_LOG_COMPONENT_DEFINE (<span class="string">"MyObject"</span>);			<span class="comment">//定义一个日志组件</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//=================MyAnotherObject=================</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyAnotherObject</span> :</span> <span class="keyword">public</span> Object &#123;</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">		MyAnotherObject();</span><br><span class="line">		<span class="keyword">virtual</span> ~MyAnotherObject();</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">SetValue</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">			m_value = value;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">uint32_t</span> GetValue() &#123;</span><br><span class="line">			<span class="keyword">return</span> m_value;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">		<span class="keyword">uint32_t</span> m_value;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	NS_OBJECT_ENSURE_REGISTERED (MyAnotherObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">	TypeId</span><br><span class="line">	MyAnotherObject::GetTypeId ()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyAnotherObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">			.SetParent(Object::GetTypeId())</span><br><span class="line">			.SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">			.AddConstructor&lt;MyAnotherObject&gt;()</span><br><span class="line">      .AddAttribute (<span class="string">"myValue"</span>, <span class="string">"help text"</span>,</span><br><span class="line">                     UintegerValue (<span class="number">0</span>),</span><br><span class="line">                     MakeUintegerAccessor (&amp;MyAnotherObject::m_value),</span><br><span class="line">                     MakeUintegerChecker&lt;<span class="keyword">uint32_t</span>&gt; ())</span><br><span class="line">			;</span><br><span class="line">		<span class="keyword">return</span> tid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	MyAnotherObject::MyAnotherObject ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	MyAnotherObject::~MyAnotherObject ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//================MyObject==================</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> :</span> <span class="keyword">public</span> Object	<span class="comment">//继承自SimpleRefCount，又继承自ObjectBase</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">    MyObject ();</span><br><span class="line">    <span class="keyword">virtual</span> ~MyObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//业务方法</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MyMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetObj</span><span class="params">(Ptr&lt;MyAnotherObject&gt; object)</span> </span>&#123;</span><br><span class="line">    	m_object = object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Ptr&lt;MyAnotherObject&gt; GetObj() &#123;</span><br><span class="line">    	<span class="keyword">return</span> m_object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <marked style="border-bottom: 2px solid red;">Ptr&lt;MyAnotherObject&gt; m_object;</marked></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  NS_OBJECT_ENSURE_REGISTERED (MyObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">  TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">  		.SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">      <marked style="border-bottom: 2px solid red;">.AddAttribute (<span class="string">"myObject"</span>, <span class="string">"help text"</span>,</marked></span><br><span class="line">										 <marked style="border-bottom: 2px solid red;">PointerValue(<span class="number">0</span>),</marked></span><br><span class="line">                     <marked style="border-bottom: 2px solid red;">MakePointerAccessor (&amp;MyObject::m_object),</marked></span><br><span class="line">                     <marked style="border-bottom: 2px solid red;">MakePointerChecker &lt;MyAnotherObject&gt;())</marked></span><br><span class="line">			;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::~MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span></span><br><span class="line">	MyObject::MyMethod ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		NS_LOG_UNCOND(<span class="string">"my method is executed"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; getCheckerByName(TypeId typeId, <span class="built_in">std</span>::<span class="built_in">string</span> attributeName) &#123;</span><br><span class="line">	TypeId::AttributeInformation * info = <span class="keyword">new</span> TypeId::AttributeInformation();</span><br><span class="line">	typeId.LookupAttributeByName(attributeName, info);</span><br><span class="line">	Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker = info-&gt;checker;</span><br><span class="line">	<span class="keyword">delete</span> info;</span><br><span class="line">	<span class="keyword">return</span> checker;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyAnotherObject&gt; aObj = CreateObject&lt;MyAnotherObject&gt;();</span><br><span class="line">	aObj-&gt;SetAttribute(<span class="string">"myValue"</span>, StringValue(<span class="string">"5"</span>));</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	<marked style="border-bottom: 2px solid red;">obj-&gt;SetAttribute(<span class="string">"myObject"</span>, PointerValue(aObj));</marked></span><br><span class="line"></span><br><span class="line">	PointerValue pointerValue;</span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"myObject"</span>, pointerValue);</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyAnotherObject&gt; aObj2 = pointerValue.Get&lt;MyAnotherObject&gt;();</span><br><span class="line">	UintegerValue myValue;</span><br><span class="line">	aObj2-&gt;GetAttribute(<span class="string">"myValue"</span>, myValue);</span><br><span class="line">	<span class="keyword">uint32_t</span> value = myValue.Get();</span><br><span class="line"></span><br><span class="line">	NS_LOG_UNCOND(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序创建了两个类：MyAnotherObject和MyObject，其中MyObject当中具有一个另外一个对象的指针属性，而MyAnotherObject当中具有无符号整形属性。我们可以将MyAnotherObject类的实例通过调用SetAttribute()的方式设置到MyObject类的实例当中，并通过GetAttribute()的方式从当中取出MyAnotherObject的对象。</p>
<p>运行程序之后得到如下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[1817/1959] Compiling scratch/try-attribute-object.cc</span><br><span class="line">[1910/1959] Linking build/scratch/try-attribute-object</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.514s)</span><br><span class="line">MyObject:MyAnotherObject(0x10eae50)</span><br><span class="line">MyObject:MyObject(0x10eae80)</span><br><span class="line">5</span><br><span class="line">MyObject:~MyObject(0x10eae80)</span><br><span class="line">MyObject:~MyAnotherObject(0x10eae50)</span><br></pre></td></tr></table></figure>
<h3 id="2-6-2-多个对象"><a href="#2-6-2-多个对象" class="headerlink" title="2.6.2. 多个对象"></a>2.6.2. 多个对象</h3><p>有的时候，需要在一个对象当中存储其他类型的多个对象，那么便会使用到C++的标准模板库(STL: Standard Template Library)里面的集合类型；而很少会使用数组，因为数组必须事先指定长度，而集合类型的长度可以自动增长。最常用的集合类型主要有：Vector（向量）和Map（映射）两种。</p>
<p>向量是单一值集合，即每个向量元素(entry)都是一个单独的对象（类型）。而映射是键值对(key-value pair)集合，即每一个映射的元素(entry)都是两个强相关的元素：一个键对象（类型），一个值对象（类型）。</p>
<p>在NS-3当中用来表示集合值的属性类型是ObjectPtrContainerValue，其主要作用是存储多个对象的智能指针。为了匹配C++当中的集合类型，NS-3将ObjectPtrContainerValue重定义成了两种具体的类型：ObjectVectorValue和ObjectMapValue。并对两种不同的具体类型提供了不同的方法支持。</p>
<h4 id="2-6-2-1-ObjectVectorValue"><a href="#2-6-2-1-ObjectVectorValue" class="headerlink" title="2.6.2.1. ObjectVectorValue"></a>2.6.2.1. ObjectVectorValue</h4><p>如果底层存储使用的是vector集合类型，那么可以将属性定义为ObjectVectorValue类型。ObjectVectorValue实际是是ObjectPtrContainerValue的一个别名：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> ObjectPtrContainerValue ObjectVectorValue;</span><br></pre></td></tr></table></figure>
<p>但是却提供了一些和vector相关的方法，方便使用。</p>
<p>和前面介绍的其他属性之类型类似，ObjectVectorValue也同时提供了两种访问器：变量访问器和函数访问器。变量访问器的使用和其他类型的变量访问器一致。而函数访问器稍有差别。原因在于其他单对象访问过程中，只需要使用对应的Getter/Setter方法即可。而在vector值类型中，函数访问器，中使用的方法不再是Getter和Setter方法，其中第一个方法应该返回vector中元素的个数，而第二个方法应该返回第i个元素。例如下面的代码片段所示：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uint32_t</span> DoGetVectorN (<span class="keyword">void</span>) <span class="keyword">const</span> &#123; <span class="keyword">return</span> m_vector2.size (); &#125;</span><br><span class="line">Ptr&lt;Derived&gt; DoGetVector (<span class="keyword">uint32_t</span> i) <span class="keyword">const</span> &#123; <span class="keyword">return</span> m_vector2[i]; &#125;</span><br></pre></td></tr></table></figure>
<p>其中DoGetVectorN()返回了vector当中元素的个数，而DoGetVector()返回了vector的第i个元素。那么在定义vector属性的时候，可以使用如下方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.AddAttribute (<span class="string">"TestVector2"</span>, <span class="string">"help text"</span>,</span><br><span class="line">                ObjectVectorValue (),</span><br><span class="line">                MakeObjectVectorAccessor (&amp;AttributeObjectTest::DoGetVectorN,</span><br><span class="line">                                          &amp;AttributeObjectTest::DoGetVector),</span><br><span class="line">                MakeObjectVectorChecker&lt;Derived&gt; ())</span><br></pre></td></tr></table></figure>
<p>从中可以看出，ObjectVectorValue属性，更多的是获取属性的值，而未提供设置方法。实际上，它底层的ObjectPtrContainerValue也未提供任何设置方法的实现：</p>
<figure class="highlight cpp"><figcaption><span>object-vector.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> </span><br><span class="line">ObjectPtrContainerAccessor::Set (ObjectBase * object, <span class="keyword">const</span> AttributeValue &amp; value) <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// not allowed.</span></span><br><span class="line">  NS_LOG_FUNCTION (<span class="keyword">this</span> &lt;&lt; object &lt;&lt; &amp;value);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此，基本可以认为ObjectVectorValue属性是一个只读属性：通过属性的方式仅仅能读取其中的值，如果想改变vector当中的元素值，或者改变vector元素本身，那么必须改变对象中的成员变量本身，此时，对应的属性值也会改变。</p>
<p>我们用下面的例子来演示ObjectVectorValue的使用：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-object-vector.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ns3 &#123;		<span class="comment">//一般建议将所有对象都写在ns3名称空间中</span></span><br><span class="line"></span><br><span class="line">  NS_LOG_COMPONENT_DEFINE (<span class="string">"MyObject"</span>);			<span class="comment">//定义一个日志组件</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//=================MyAnotherObject=================</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyAnotherObject</span> :</span> <span class="keyword">public</span> Object &#123;</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">		MyAnotherObject();</span><br><span class="line">		<span class="keyword">virtual</span> ~MyAnotherObject();</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">SetValue</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">			m_value = value;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">uint32_t</span> GetValue() &#123;</span><br><span class="line">			<span class="keyword">return</span> m_value;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">		<span class="keyword">uint32_t</span> m_value;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	NS_OBJECT_ENSURE_REGISTERED (MyAnotherObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">	TypeId</span><br><span class="line">	MyAnotherObject::GetTypeId ()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyAnotherObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">			.SetParent(Object::GetTypeId())</span><br><span class="line">			.SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">			.AddConstructor&lt;MyAnotherObject&gt;()</span><br><span class="line">      .AddAttribute (<span class="string">"myValue"</span>, <span class="string">"help text"</span>,</span><br><span class="line">                     UintegerValue (<span class="number">0</span>),</span><br><span class="line">                     MakeUintegerAccessor (&amp;MyAnotherObject::m_value),</span><br><span class="line">                     MakeUintegerChecker&lt;<span class="keyword">uint32_t</span>&gt; ())</span><br><span class="line">			;</span><br><span class="line">		<span class="keyword">return</span> tid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	MyAnotherObject::MyAnotherObject ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	MyAnotherObject::~MyAnotherObject ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//================MyObject==================</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> :</span> <span class="keyword">public</span> Object	<span class="comment">//继承自SimpleRefCount，又继承自ObjectBase</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">    MyObject ();</span><br><span class="line">    <span class="keyword">virtual</span> ~MyObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//业务方法</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MyMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">AddObject</span><span class="params">(Ptr&lt;MyAnotherObject&gt; anotherObject)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <marked style="border-bottom: 2px solid red;"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Ptr&lt;MyAnotherObject&gt; &gt; m_objects;</marked></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  NS_OBJECT_ENSURE_REGISTERED (MyObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">  TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">  		.SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">      <marked style="border-bottom: 2px solid red;">.AddAttribute (<span class="string">"myObjects"</span>, <span class="string">"help text"</span>,</marked></span><br><span class="line">										 <marked style="border-bottom: 2px solid red;">ObjectVectorValue(),</marked></span><br><span class="line">                     <marked style="border-bottom: 2px solid red;">MakeObjectVectorAccessor (&amp;MyObject::m_objects),</marked></span><br><span class="line">                     <marked style="border-bottom: 2px solid red;">MakeObjectVectorChecker &lt;MyAnotherObject&gt;())</marked></span><br><span class="line">			;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::~MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span></span><br><span class="line">	MyObject::MyMethod ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		NS_LOG_UNCOND(<span class="string">"my method is executed"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span></span><br><span class="line">	MyObject::AddObject (Ptr&lt;MyAnotherObject&gt; anotherObject)</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span> &lt;&lt; anotherObject);</span><br><span class="line"></span><br><span class="line">		m_objects.push_back(anotherObject);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; getCheckerByName(TypeId typeId, <span class="built_in">std</span>::<span class="built_in">string</span> attributeName) &#123;</span><br><span class="line">	TypeId::AttributeInformation * info = <span class="keyword">new</span> TypeId::AttributeInformation();</span><br><span class="line">	typeId.LookupAttributeByName(attributeName, info);</span><br><span class="line">	Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker = info-&gt;checker;</span><br><span class="line">	<span class="keyword">delete</span> info;</span><br><span class="line">	<span class="keyword">return</span> checker;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">  ObjectVectorValue <span class="built_in">vector</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">  obj-&gt;GetAttribute(<span class="string">"myObjects"</span>, <span class="built_in">vector</span>);</span><br><span class="line"></span><br><span class="line">  NS_LOG_UNCOND(<span class="string">"初始状态下，vector的长度："</span> &lt;&lt; <span class="built_in">vector</span>.GetN());</span><br><span class="line"></span><br><span class="line">  Ptr&lt;MyAnotherObject&gt; aObj1 = CreateObject&lt;MyAnotherObject&gt;();</span><br><span class="line">  obj-&gt;AddObject(aObj1);</span><br><span class="line"></span><br><span class="line">  NS_LOG_UNCOND(<span class="string">"获取属性之前，vector的长度："</span> &lt;&lt; <span class="built_in">vector</span>.GetN());</span><br><span class="line"></span><br><span class="line">  obj-&gt;GetAttribute(<span class="string">"myObjects"</span>, <span class="built_in">vector</span>);</span><br><span class="line">  NS_LOG_UNCOND(<span class="string">"获取属性之后，vector的长度："</span> &lt;&lt; <span class="built_in">vector</span>.GetN());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序后得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[1820/1961] Compiling scratch/try-attribute-object-vector.cc</span><br><span class="line">[1917/1961] Linking build/scratch/try-attribute-object-vector</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.621s)</span><br><span class="line">MyObject:MyObject(0xf71650)</span><br><span class="line">初始状态下，vector的长度：0</span><br><span class="line">MyObject:MyAnotherObject(0xf76cf0)</span><br><span class="line">MyObject:AddObject(0xf71650, 0xf76cf0)</span><br><span class="line">获取属性之前，vector的长度：0</span><br><span class="line">获取属性之后，vector的长度：1</span><br><span class="line">MyObject:~MyObject(0xf71650)</span><br><span class="line">MyObject:~MyAnotherObject(0xf76cf0)</span><br></pre></td></tr></table></figure>
<p>从中可以看出：</p>
<ul>
<li>vector当中的对象一定是以智能指针Ptr来表示的</li>
<li>vector当中的对象一定继承自NS-3的Object类</li>
<li>vector属性仅具有读取的功能</li>
<li>无法设置vector类型的属性</li>
<li>每次改变vector后，必须重新获取属性才能得到修改后的属性</li>
</ul>
<p>此外，还需要注意的是，vector属性是无法用StringValue属性值创建的：</p>
<figure class="highlight cpp"><figcaption><span>object-vector.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span></span><br><span class="line">ObjectPtrContainerValue::DeserializeFromString (<span class="built_in">std</span>::<span class="built_in">string</span> value, Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker)</span><br><span class="line">&#123;</span><br><span class="line">  NS_LOG_FUNCTION (<span class="keyword">this</span> &lt;&lt; value &lt;&lt; checker);</span><br><span class="line">  NS_FATAL_ERROR (<span class="string">"cannot deserialize a set of object pointers."</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-6-2-2-ObjectMapValue"><a href="#2-6-2-2-ObjectMapValue" class="headerlink" title="2.6.2.2. ObjectMapValue"></a>2.6.2.2. ObjectMapValue</h4><p>和vector类似，有时候我们在一个对象中底层存储其他对象的时候，使用的底层数据类型是map，那么可以使用ObjectMapValue来表示。</p>
<p>和ObjectVectorValue类似，ObjectMapValue类型也是一个ObjectPonterContainerValue的别名。同样提供了一套适用与Map的函数。</p>
<p>ObjectMapValue具有和ObjectVectorValue类似的特性：</p>
<ul>
<li>是只读属性</li>
<li>改变之后要重新获取属性</li>
<li>无法从StringValue创建</li>
<li>Map当中的值必须是Object类，并且必须使用Ptr智能指针表示</li>
</ul>
<p>此外，ObjectMapValue当中的键必须是整型，不能是其他类型。（这在一定程度上限制了映射类型的应用范围，并且不符合STL的多类型支持特性，不知NS-3会不会在以后进行扩展。）</p>
<p>我们通过以下程序来演示ObjectMapValue属性的使用：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-object-map.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ns3 &#123;		<span class="comment">//一般建议将所有对象都写在ns3名称空间中</span></span><br><span class="line"></span><br><span class="line">  NS_LOG_COMPONENT_DEFINE (<span class="string">"MyObject"</span>);			<span class="comment">//定义一个日志组件</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//=================MyAnotherObject=================</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyAnotherObject</span> :</span> <span class="keyword">public</span> Object &#123;</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">		MyAnotherObject();</span><br><span class="line">		<span class="keyword">virtual</span> ~MyAnotherObject();</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">SetValue</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">			m_value = value;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">uint32_t</span> GetValue() &#123;</span><br><span class="line">			<span class="keyword">return</span> m_value;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">		<span class="keyword">uint32_t</span> m_value;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	NS_OBJECT_ENSURE_REGISTERED (MyAnotherObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">	TypeId</span><br><span class="line">	MyAnotherObject::GetTypeId ()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyAnotherObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">			.SetParent(Object::GetTypeId())</span><br><span class="line">			.SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">			.AddConstructor&lt;MyAnotherObject&gt;()</span><br><span class="line">      .AddAttribute (<span class="string">"myValue"</span>, <span class="string">"help text"</span>,</span><br><span class="line">                     UintegerValue (<span class="number">0</span>),</span><br><span class="line">                     MakeUintegerAccessor (&amp;MyAnotherObject::m_value),</span><br><span class="line">                     MakeUintegerChecker&lt;<span class="keyword">uint32_t</span>&gt; ())</span><br><span class="line">			;</span><br><span class="line">		<span class="keyword">return</span> tid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	MyAnotherObject::MyAnotherObject ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	MyAnotherObject::~MyAnotherObject ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//================MyObject==================</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> :</span> <span class="keyword">public</span> Object	<span class="comment">//继承自SimpleRefCount，又继承自ObjectBase</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">    MyObject ();</span><br><span class="line">    <span class="keyword">virtual</span> ~MyObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//业务方法</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MyMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PutObject</span><span class="params">(<span class="keyword">uint32_t</span> name, Ptr&lt;MyAnotherObject&gt; anotherObject)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint32_t</span> DoGetMapN (<span class="keyword">void</span>) <span class="keyword">const</span></span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="keyword">return</span> m_map.size ();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Ptr&lt;MyAnotherObject&gt; DoGetMapValue (<span class="keyword">const</span> <span class="keyword">uint32_t</span> index) <span class="keyword">const</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//不能使用[]操作符，原因在于此方法是const方法，而[]不是const方法，也无法定义成const方法</span></span><br><span class="line">    	<span class="comment">// return m_map[index];</span></span><br><span class="line"></span><br><span class="line">    	<span class="comment">//可以使用find方法，find方法有const和非const两个版本，返回不同的前者返回const_interator</span></span><br><span class="line">    	<span class="keyword">auto</span> search = m_map.find(index);</span><br><span class="line">      <span class="keyword">if</span>(search == m_map.end()) &#123;	<span class="comment">//未找到</span></span><br><span class="line">      		<span class="keyword">return</span> <span class="number">0</span>;		<span class="comment">//返回空对象</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      		<span class="keyword">return</span> search-&gt;second;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//此处也可以使用at方法实现，未找到的时候抛出异常</span></span><br><span class="line">      <span class="comment">//	at方法只有C++11支持，并且也有const和非const两种实现，前者返回const引用</span></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	try&#123;</span></span><br><span class="line"><span class="comment">    			return m_map.at(index);</span></span><br><span class="line"><span class="comment">    	&#125;catch(...)&#123;</span></span><br><span class="line"><span class="comment">    			return 0;</span></span><br><span class="line"><span class="comment">    	&#125;</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <marked style="border-bottom: 2px solid red;"><span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">uint32_t</span>, Ptr&lt;MyAnotherObject&gt; &gt; m_map;</marked></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  NS_OBJECT_ENSURE_REGISTERED (MyObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">  TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">  		.SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">      <marked style="border-bottom: 2px solid red;">.AddAttribute (<span class="string">"myMap"</span>, <span class="string">"help text"</span>,</marked></span><br><span class="line">                     <marked style="border-bottom: 2px solid red;">ObjectMapValue (),</marked></span><br><span class="line">                     <marked style="border-bottom: 2px solid red;">MakeObjectMapAccessor (&amp;MyObject::DoGetMapValue, &amp;MyObject::DoGetMapN),</marked></span><br><span class="line">                     <marked style="border-bottom: 2px solid red;">MakeObjectMapChecker&lt;MyAnotherObject&gt; ())</marked></span><br><span class="line">			;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::~MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span></span><br><span class="line">	MyObject::MyMethod ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		NS_LOG_UNCOND(<span class="string">"my method is executed"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span></span><br><span class="line">	MyObject::PutObject (<span class="keyword">uint32_t</span> name, Ptr&lt;MyAnotherObject&gt; anotherObject)</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span> &lt;&lt; anotherObject);</span><br><span class="line"></span><br><span class="line">		m_map.insert(<span class="built_in">std</span>::pair&lt;<span class="keyword">uint32_t</span>, Ptr&lt;MyAnotherObject&gt; &gt; (name, anotherObject));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; getCheckerByName(TypeId typeId, <span class="built_in">std</span>::<span class="built_in">string</span> attributeName) &#123;</span><br><span class="line">	TypeId::AttributeInformation * info = <span class="keyword">new</span> TypeId::AttributeInformation();</span><br><span class="line">	typeId.LookupAttributeByName(attributeName, info);</span><br><span class="line">	Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker = info-&gt;checker;</span><br><span class="line">	<span class="keyword">delete</span> info;</span><br><span class="line">	<span class="keyword">return</span> checker;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">  ObjectMapValue <span class="built_in">map</span>;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">  obj-&gt;GetAttribute(<span class="string">"myMap"</span>, <span class="built_in">map</span>);</span><br><span class="line"></span><br><span class="line">  NS_LOG_UNCOND(<span class="string">"初始状态下，vector的长度："</span> &lt;&lt; <span class="built_in">map</span>.GetN());</span><br><span class="line"></span><br><span class="line">  Ptr&lt;MyAnotherObject&gt; aObj1 = CreateObject&lt;MyAnotherObject&gt;();</span><br><span class="line">  obj-&gt;PutObject(<span class="number">0</span>, aObj1);</span><br><span class="line"></span><br><span class="line">  NS_LOG_UNCOND(<span class="string">"获取属性之前，vector的长度："</span> &lt;&lt; <span class="built_in">map</span>.GetN());</span><br><span class="line"></span><br><span class="line">  obj-&gt;GetAttribute(<span class="string">"myMap"</span>, <span class="built_in">map</span>);</span><br><span class="line">  NS_LOG_UNCOND(<span class="string">"获取属性之后，vector的长度："</span> &lt;&lt; <span class="built_in">map</span>.GetN());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序中定义了两个类：MyObject和MyAnotherObject。前者维护了一个后者的映射，键值是uint32_t类型。随后MyObject在TypeId当中定义了一个属性myMap，该属性使用了函数访问器，并传入两两个方法：第一个方法获取map中的元素，第二个方法获取map中元素的个数。这两个方法的位置可以交换。</p>
<p>在实现获取map中元素的时候，需要注意两点：</p>
<ol>
<li>方法必须是const方法，这是MakeObjectMapAccessor()方法当中的规定。</li>
<li>如果键值对应的对象为空，需要返回空指针。因此，可以使用map.find()和map.at()两种方法实现。其中后者在未找到对象时，会抛出异常。具体请参阅C++中STL<img src="http://www.cplusplus.com/reference/map/map/?kw=map" alt="关于map的相关文档">，在此不再赘述。</li>
</ol>
<p>MapObjectMapChecker()方法需要用模板的形式传入map中所能接受的对象。map其他的用法和vector非常类似，可以对照学习。</p>
<h1 id="3-对象工厂"><a href="#3-对象工厂" class="headerlink" title="3. 对象工厂"></a>3. 对象工厂</h1><p>在NS-3中，我们现在使用其对象和属性框架的步骤一般如下：</p>
<ol>
<li>使用CreateObject&lt;&gt;()方法创建某个类的对象实例，并得到一个指向该对象的智能指针。</li>
<li>使用对象的SetAttribute()方法来设置对象的各种属性。</li>
<li>调用Initialize()方法来初始化对象，因为SetAttribute()方法设置的属性，无法在构造函数中初始化。</li>
</ol>
<p>然而有些时候，我们需要创建大量很多属性都相同或者相似的对象。一种方式是，一个个创建对象，并依次设置它们的各种属性。很显然这种方法非常繁琐。另外一种方式是，将对象创建成为数组或者集合，然后使用循环来创建它们。当然这种方式仅支持对象数组或者对象集合。</p>
<p>当对象即不是数组又不是集合的时候，我们还可以使用另外一种方式，就是前面提到过的使用Config::SetDefault()方法，改变所有对象的属性的默认值，然后再开始使用CreateObject()函数创建对象。这种方法相对简单，然而，如果我们不是想改变所有对象的属性值，而只改变一些对象的默认值，在创建完对象之后还是要通过Config::SetDefault()方法将所有属性还原（意味着我们之前还要先记下原来的默认值是什么）。</p>
<h2 id="3-1-对象工厂的使用"><a href="#3-1-对象工厂的使用" class="headerlink" title="3.1. 对象工厂的使用"></a>3.1. 对象工厂的使用</h2><p>NS-3提供了另外一种机制来批量的创建拥有同样属性的对象：对象工厂。对象工厂实际上是一个类ObjectFactory。它是NS-3对象框架应用的极致体现。ObjectFactory的定义如下：</p>
<figure class="highlight cpp"><figcaption><span>object-factory.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjectFactory</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// 构造函数</span></span><br><span class="line">  ObjectFactory ();</span><br><span class="line">  ObjectFactory (<span class="built_in">std</span>::<span class="built_in">string</span> typeId);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置要创建的对象的TypeId</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">SetTypeId</span> <span class="params">(TypeId tid)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">SetTypeId</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *tid)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">SetTypeId</span> <span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> tid)</span></span>;</span><br><span class="line">  <span class="comment">// 获得上面设置的TypeId</span></span><br><span class="line">  <span class="function">TypeId <span class="title">GetTypeId</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置要创建的对象属性</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Set</span> <span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> name, <span class="keyword">const</span> AttributeValue &amp;value)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//创建对象，返回Object类型</span></span><br><span class="line">  Ptr&lt;Object&gt; Create (<span class="keyword">void</span>) <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//创建对象，返回一个指定的类型</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">  Ptr&lt;T&gt; Create (<span class="keyword">void</span>) <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  ……</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>从类的定义可见，ObjectFactory使用非常简单：</p>
<ol>
<li>创建一个ObjectFactory。</li>
<li>如果构造函数未指定TypeId，则可以通过SetTypeId()方法指定一个需要创建的对象的TypeId。</li>
<li>使用Set方法设置对象的属性值，如果属性在该TypeId当中不存在，则将抛出异常。</li>
<li>反复调用Create()方法创建对象，这些对象都具有同样的属性值。</li>
</ol>
<p>此外，NS-3还提供了另外一个实用的函数，可以在创建Object的同时指定属性，可以同时指定1到9个属性：</p>
<figure class="highlight cpp"><figcaption><span>object-factory.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">Ptr&lt;T&gt; </span><br><span class="line">CreateObjectWithAttributes</span><br><span class="line">  (<span class="built_in">std</span>::<span class="built_in">string</span> n1 = <span class="string">""</span>, <span class="keyword">const</span> AttributeValue &amp; v1 = EmptyAttributeValue (),</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">string</span> n2 = <span class="string">""</span>, <span class="keyword">const</span> AttributeValue &amp; v2 = EmptyAttributeValue (),</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">string</span> n3 = <span class="string">""</span>, <span class="keyword">const</span> AttributeValue &amp; v3 = EmptyAttributeValue (),</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">string</span> n4 = <span class="string">""</span>, <span class="keyword">const</span> AttributeValue &amp; v4 = EmptyAttributeValue (),</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">string</span> n5 = <span class="string">""</span>, <span class="keyword">const</span> AttributeValue &amp; v5 = EmptyAttributeValue (),</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">string</span> n6 = <span class="string">""</span>, <span class="keyword">const</span> AttributeValue &amp; v6 = EmptyAttributeValue (),</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">string</span> n7 = <span class="string">""</span>, <span class="keyword">const</span> AttributeValue &amp; v7 = EmptyAttributeValue (),</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">string</span> n8 = <span class="string">""</span>, <span class="keyword">const</span> AttributeValue &amp; v8 = EmptyAttributeValue (),</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">string</span> n9 = <span class="string">""</span>, <span class="keyword">const</span> AttributeValue &amp; v9 = EmptyAttributeValue ()</span><br><span class="line">   );</span><br></pre></td></tr></table></figure>
<p>我们用下面的例子来解释ObjectFactory类的使用：</p>
<figure class="highlight cpp"><figcaption><span>try-object-factory.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ns3 &#123;		<span class="comment">//一般建议将所有对象都写在ns3名称空间中</span></span><br><span class="line"></span><br><span class="line">  NS_LOG_COMPONENT_DEFINE (<span class="string">"MyObject"</span>);			<span class="comment">//定义一个日志组件</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//================MyObject==================</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> :</span> <span class="keyword">public</span> Object	<span class="comment">//继承自SimpleRefCount，又继承自ObjectBase</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">    MyObject ();</span><br><span class="line">    <span class="keyword">virtual</span> ~MyObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//业务方法</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MyMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">uint32_t</span> m_intValue;</span><br><span class="line">    <span class="keyword">bool</span> m_booleanValue;</span><br><span class="line">    <span class="keyword">double</span> m_doubleValue;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  NS_OBJECT_ENSURE_REGISTERED (MyObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">  TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">  		.SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">			.AddAttribute(<span class="string">"intValue"</span>, <span class="string">"help text"</span>,</span><br><span class="line">										UintegerValue(<span class="number">0</span>),</span><br><span class="line">										MakeUintegerAccessor(&amp;MyObject::m_intValue),</span><br><span class="line">										MakeUintegerChecker&lt;<span class="keyword">uint32_t</span>&gt;())</span><br><span class="line">			.AddAttribute(<span class="string">"booleanValue"</span>, <span class="string">"help text"</span>,</span><br><span class="line">										BooleanValue(<span class="literal">false</span>),</span><br><span class="line">										MakeBooleanAccessor(&amp;MyObject::m_booleanValue),</span><br><span class="line">										MakeBooleanChecker())</span><br><span class="line">			.AddAttribute(<span class="string">"doubleValue"</span>, <span class="string">"help text"</span>,</span><br><span class="line">										DoubleValue(<span class="number">0.0l</span>),</span><br><span class="line">										MakeDoubleAccessor(&amp;MyObject::m_doubleValue),</span><br><span class="line">										MakeDoubleChecker&lt;<span class="keyword">double</span>&gt;())</span><br><span class="line">			;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::~MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span></span><br><span class="line">	MyObject::MyMethod ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		NS_LOG_UNCOND(<span class="string">"my method is executed"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	<marked style="border-bottom: 2px solid red;">ObjectFactory oFactory;</marked></span><br><span class="line">	<marked style="border-bottom: 2px solid red;">oFactory.SetTypeId(<span class="string">"ns3::MyObject"</span>);</marked></span><br><span class="line">	<marked style="border-bottom: 2px solid red;">oFactory.Set(<span class="string">"intValue"</span>, StringValue(<span class="string">"100"</span>));</marked></span><br><span class="line">	<marked style="border-bottom: 2px solid red;">oFactory.Set(<span class="string">"booleanValue"</span>, StringValue(<span class="string">"true"</span>));</marked></span><br><span class="line">	<marked style="border-bottom: 2px solid red;">oFactory.Set(<span class="string">"doubleValue"</span>, StringValue(<span class="string">"22.5"</span>));</marked></span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj1 = oFactory.Create&lt;MyObject&gt;();</span><br><span class="line">	Ptr&lt;MyObject&gt; obj2 = oFactory.Create&lt;MyObject&gt;();</span><br><span class="line">	Ptr&lt;MyObject&gt; obj3 = oFactory.Create&lt;MyObject&gt;();</span><br><span class="line"></span><br><span class="line">	NS_LOG_UNCOND((obj1 == obj2));</span><br><span class="line">	NS_LOG_UNCOND((obj1 == obj3));</span><br><span class="line">	NS_LOG_UNCOND((obj2 == obj3));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//get int value</span></span><br><span class="line">	UintegerValue intValue;</span><br><span class="line">	obj1-&gt;GetAttribute(<span class="string">"intValue"</span>, intValue);</span><br><span class="line">	NS_LOG_UNCOND(intValue.Get());</span><br><span class="line"></span><br><span class="line">	obj2-&gt;GetAttribute(<span class="string">"intValue"</span>, intValue);</span><br><span class="line">	NS_LOG_UNCOND(intValue.Get());</span><br><span class="line"></span><br><span class="line">	obj3-&gt;GetAttribute(<span class="string">"intValue"</span>, intValue);</span><br><span class="line">	NS_LOG_UNCOND(intValue.Get());</span><br><span class="line"></span><br><span class="line">	<span class="comment">//get bool value</span></span><br><span class="line">	BooleanValue boolValue;</span><br><span class="line">	obj1-&gt;GetAttribute(<span class="string">"booleanValue"</span>, boolValue);</span><br><span class="line">	NS_LOG_UNCOND(boolValue.Get());</span><br><span class="line"></span><br><span class="line">	obj2-&gt;GetAttribute(<span class="string">"booleanValue"</span>, boolValue);</span><br><span class="line">	NS_LOG_UNCOND(boolValue.Get());</span><br><span class="line"></span><br><span class="line">	obj3-&gt;GetAttribute(<span class="string">"booleanValue"</span>, boolValue);</span><br><span class="line">	NS_LOG_UNCOND(boolValue.Get());</span><br><span class="line"></span><br><span class="line">	<span class="comment">//get double value</span></span><br><span class="line">	DoubleValue doubleValue;</span><br><span class="line">	obj1-&gt;GetAttribute(<span class="string">"doubleValue"</span>, doubleValue);</span><br><span class="line">	NS_LOG_UNCOND(doubleValue.Get());</span><br><span class="line"></span><br><span class="line">	obj2-&gt;GetAttribute(<span class="string">"doubleValue"</span>, doubleValue);</span><br><span class="line">	NS_LOG_UNCOND(doubleValue.Get());</span><br><span class="line"></span><br><span class="line">	obj3-&gt;GetAttribute(<span class="string">"doubleValue"</span>, doubleValue);</span><br><span class="line">	NS_LOG_UNCOND(doubleValue.Get());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的程序使用ObjectFactory创建了三个对象，然后比较了三个对象是不是同一个对象，然后输出了三个对象的三个不同的属性值。运行程序之后，得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[ 931/1965] Compiling scratch/try-object-factory.cc</span><br><span class="line">[1927/1965] Linking build/scratch/try-object-factory</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.167s)</span><br><span class="line">MyObject:MyObject(0xc498e0)</span><br><span class="line">MyObject:MyObject(0xc49010)</span><br><span class="line">MyObject:MyObject(0xc47380)</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">100</span><br><span class="line">100</span><br><span class="line">100</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">22.5</span><br><span class="line">22.5</span><br><span class="line">22.5</span><br><span class="line">MyObject:~MyObject(0xc47380)</span><br><span class="line">MyObject:~MyObject(0xc49010)</span><br><span class="line">MyObject:~MyObject(0xc498e0)</span><br></pre></td></tr></table></figure>
<p>可见，使用ObjectFactory三次创建出的对象均不是同一个对象，但是三个对象却拥有同样的属性值。因此，使用ObjectFactory非常适合批量地创建属性值相同的对象。</p>
<h2 id="3-2-从StringValue创建对象"><a href="#3-2-从StringValue创建对象" class="headerlink" title="3.2. 从StringValue创建对象"></a>3.2. 从StringValue创建对象</h2><p>本章前面提到几乎所有的属性值类型都能够从StringValue创建，包括原始数据类型的属性值类型。前几节也提到过，多值对象属性ObjectVectorValue和ObjectMapValue是不可以通过StringValue创建的。那么前文并未提及单值对象PointerValue是否能够通过StringValue创建呢？如果可以，字符串又该写什么才能创建出指向该对象实例的智能指针呢？</p>
<p>答案是肯定的：可以通过字符串值类型创建PointerValue属性值。并且字符串写的就是想要创建的对象的TypeId的名字。例如：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj-&gt;SetAttribute(<span class="string">"myPointer"</span>, StringValue(<span class="string">"ns3::MyAnotherObject"</span>));</span><br></pre></td></tr></table></figure>
<p>这样myPointer属性便会指向一个MyAnotherObject的实例。</p>
<p>实际上，StringValue转换成PointerValue底层是通过ObjectFactory来实现的。字符串值即为调用ObjectFactory的SetTypeId()方法的参数。既然ObjectFactory可以初始化属性，那么StringValue也是可以指定初始化属性的。NS-3当中，使用[]来表示属性。其中使用=来分割属性名称和属性值。所有属性值都被认为是字符串，因此无法给无法从StringValue转换的属性值类型初始化。字符串初始化属性的方式如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj-&gt;SetAttribute(<span class="string">"myPointer"</span>, StringValue(<span class="string">"ns3::MyAnotherObject[intValue=5]"</span>))</span><br></pre></td></tr></table></figure>
<p>如果要设置多个属性，则属性和属性之间使用竖线|来分割：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj-&gt;SetAttribute(<span class="string">"myPointer"</span>, StringValue(<span class="string">"ns3::MyAnotherObject[intValue=5|doubleValue=2.0]"</span>))</span><br></pre></td></tr></table></figure>
<p>实际上，属性的设置也是通过ObjectFactory来完成的。PointerValue的DeserializeFromString()方法找到方括号[]之间的内容，然后用|区分不同的属性，然后通过=区分属性的名字和值。最后通过ObjectFactory的Set()方法将属性和值设置到ObjectFactory当中。然后调用Create()方法完成对象的构造。</p>
<p>例如如下代码：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-pointer.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ns3 &#123;		<span class="comment">//一般建议将所有对象都写在ns3名称空间中</span></span><br><span class="line"></span><br><span class="line">  NS_LOG_COMPONENT_DEFINE (<span class="string">"MyObject"</span>);			<span class="comment">//定义一个日志组件</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//=================MyAnotherObject=================</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyAnotherObject</span> :</span> <span class="keyword">public</span> Object &#123;</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">		MyAnotherObject();</span><br><span class="line">		<span class="keyword">virtual</span> ~MyAnotherObject();</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">SetValue</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">			m_value = value;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">uint32_t</span> GetValue() &#123;</span><br><span class="line">			<span class="keyword">return</span> m_value;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">SetDouble</span><span class="params">(<span class="keyword">double</span> doubleValue)</span> </span>&#123;</span><br><span class="line">			m_double = doubleValue;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">double</span> <span class="title">GetDouble</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> m_double;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">		<span class="keyword">uint32_t</span> m_value;</span><br><span class="line">		<span class="keyword">double</span> m_double;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	NS_OBJECT_ENSURE_REGISTERED (MyAnotherObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">	TypeId</span><br><span class="line">	MyAnotherObject::GetTypeId ()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyAnotherObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">			.SetParent(Object::GetTypeId())</span><br><span class="line">			.SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">			.AddConstructor&lt;MyAnotherObject&gt;()</span><br><span class="line">      .AddAttribute (<span class="string">"myValue"</span>, <span class="string">"help text"</span>,</span><br><span class="line">                     UintegerValue (<span class="number">0</span>),</span><br><span class="line">                     MakeUintegerAccessor (&amp;MyAnotherObject::m_value),</span><br><span class="line">                     MakeUintegerChecker&lt;<span class="keyword">uint32_t</span>&gt; ())</span><br><span class="line">      .AddAttribute (<span class="string">"myDouble"</span>, <span class="string">"help text"</span>,</span><br><span class="line">                     DoubleValue (<span class="number">0.0l</span>),</span><br><span class="line">                     MakeDoubleAccessor (&amp;MyAnotherObject::m_double),</span><br><span class="line">                     MakeDoubleChecker&lt;<span class="keyword">double</span>&gt; ())</span><br><span class="line">			;</span><br><span class="line">		<span class="keyword">return</span> tid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	MyAnotherObject::MyAnotherObject ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	MyAnotherObject::~MyAnotherObject ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//================MyObject==================</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> :</span> <span class="keyword">public</span> Object	<span class="comment">//继承自SimpleRefCount，又继承自ObjectBase</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">    MyObject ();</span><br><span class="line">    <span class="keyword">virtual</span> ~MyObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//业务方法</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MyMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetObj</span><span class="params">(Ptr&lt;MyAnotherObject&gt; object)</span> </span>&#123;</span><br><span class="line">    	m_object = object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Ptr&lt;MyAnotherObject&gt; GetObj() &#123;</span><br><span class="line">    	<span class="keyword">return</span> m_object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    Ptr&lt;MyAnotherObject&gt; m_object;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  NS_OBJECT_ENSURE_REGISTERED (MyObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">  TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">  		.SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">      .AddAttribute (<span class="string">"myObject"</span>, <span class="string">"help text"</span>,</span><br><span class="line">										 PointerValue(<span class="number">0</span>),</span><br><span class="line">                     MakePointerAccessor (&amp;MyObject::m_object),</span><br><span class="line">                     MakePointerChecker &lt;MyAnotherObject&gt;())</span><br><span class="line">			;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::~MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span></span><br><span class="line">	MyObject::MyMethod ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		NS_LOG_UNCOND(<span class="string">"my method is executed"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; getCheckerByName(TypeId typeId, <span class="built_in">std</span>::<span class="built_in">string</span> attributeName) &#123;</span><br><span class="line">	TypeId::AttributeInformation * info = <span class="keyword">new</span> TypeId::AttributeInformation();</span><br><span class="line">	typeId.LookupAttributeByName(attributeName, info);</span><br><span class="line">	Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker = info-&gt;checker;</span><br><span class="line">	<span class="keyword">delete</span> info;</span><br><span class="line">	<span class="keyword">return</span> checker;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyObject"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	<span class="function">ObjectFactory <span class="title">objectFactory</span><span class="params">(<span class="string">"ns3::MyObject"</span>)</span></span>;</span><br><span class="line">	<marked style="border-bottom: 2px solid red;">objectFactory.Set(<span class="string">"myObject"</span>, StringValue(<span class="string">"ns3::MyAnotherObject[myValue=5|myDouble=25.5]"</span>));</marked></span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = objectFactory.Create&lt;MyObject&gt;();</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyAnotherObject&gt; aObj = obj-&gt;GetObj();</span><br><span class="line"></span><br><span class="line">	UintegerValue intValue;</span><br><span class="line">	aObj-&gt;GetAttribute(<span class="string">"myValue"</span>, intValue);</span><br><span class="line">	NS_LOG_UNCOND(intValue.Get());</span><br><span class="line"></span><br><span class="line">	DoubleValue doubleValue;</span><br><span class="line">	aObj-&gt;GetAttribute(<span class="string">"myDouble"</span>, doubleValue);</span><br><span class="line">	NS_LOG_UNCOND(doubleValue.Get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码中，我们创建了两个类MyObject和MyAnotherObject，前者拥有一个后者的指针，并定义了相应的属性MyObject。后者拥有两个属性：整型属性myValue和浮点型属性myDouble。程序中，我们使用ObjectFactory对象设置了MyObject的TypeId，然后使用Set()方法设置了myObject属性为一个字符串值类型，取值为：”ns3::MyAnotherObject[myValue=5|myDouble=25.5]”，即myObject将创建一个MyAnotherObject对象，该对象拥有两个属性值分别是5和25.5。</p>
<p>该程序的运行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[1821/1967] Compiling scratch/try-attribute-pointer.cc</span><br><span class="line">[1956/1967] Linking build/scratch/try-attribute-pointer</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.503s)</span><br><span class="line">MyObject:MyAnotherObject(0x1b2ae50)</span><br><span class="line">MyObject:~MyAnotherObject(0x1b2ae50)</span><br><span class="line">MyObject:MyObject(0x1b2bc00)</span><br><span class="line">MyObject:MyAnotherObject(0x1b2ae50)</span><br><span class="line">5</span><br><span class="line">25.5</span><br><span class="line">MyObject:~MyObject(0x1b2bc00)</span><br><span class="line">MyObject:~MyAnotherObject(0x1b2ae50)</span><br></pre></td></tr></table></figure>
<p>可见对象可以通过字符串值类型创建，并且正确初始化属性值。</p>
<h1 id="4-自定义属性值类型"><a href="#4-自定义属性值类型" class="headerlink" title="4. 自定义属性值类型"></a>4. 自定义属性值类型</h1><p>很多时候，我们需要设置的属性不是原始数据类型，而是自己新创建的类。如果我们创建的类继承自NS-3的Object类，那么便可以使用PointerValue来引用。当然，Object类是需要许多代价的。有时候，一些简单的类型必须继承自Object类是没有必要的。如果这个简单类型又必须要加入属性系统，我们可以使用自定义属性值类型的方法。</p>
<p>接下来，我们通过自定义一个三角形类来演示自定义属性值类型的方法。</p>
<h2 id="4-1-定义数据类型"><a href="#4-1-定义数据类型" class="headerlink" title="4.1. 定义数据类型"></a>4.1. 定义数据类型</h2><p>任何的属性值类型，底层一定需要一个成员变量来存储。因此第一步必须创建一个用于存储这个值的底层类型，这个类型一般是普通C++类：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-customise.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTriangle</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	MyTriangle();</span><br><span class="line"></span><br><span class="line">	MyTriangle(<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">checkValid</span><span class="params">(<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">double</span> m_side1;</span><br><span class="line"><span class="keyword">double</span> m_side2;</span><br><span class="line"><span class="keyword">double</span> m_side3;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">friend</span> <span class="built_in">std</span>::ostream &amp;<span class="keyword">operator</span> &lt;&lt; (<span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> MyTriangle &amp;rate);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MyTriangle::MyTriangle(): m_side1(<span class="number">0</span>), m_side2(<span class="number">0</span>), m_side3(<span class="number">0</span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyTriangle::MyTriangle(<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3) &#123;</span><br><span class="line">  m_side1 = side1;</span><br><span class="line">  m_side2 = side2;</span><br><span class="line">  m_side3 = side3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::ostream &amp;<span class="keyword">operator</span> &lt;&lt; (<span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> MyTriangle &amp;triangle) &#123;</span><br><span class="line">	os &lt;&lt; <span class="string">"triangle ("</span> &lt;&lt;	triangle.m_side1 &lt;&lt; <span class="string">", "</span> &lt;&lt; triangle.m_side2 &lt;&lt; <span class="string">", "</span> &lt;&lt; triangle.m_side3 &lt;&lt; <span class="string">")"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-2-定义属性值类型"><a href="#4-2-定义属性值类型" class="headerlink" title="4.2. 定义属性值类型"></a>4.2. 定义属性值类型</h2><p>有了底层的数据存储类型之后，还需要定义一个属性值类型，这个类型必须继承自AtrributeValue，名字一般是底层类型加Value，例如我们的例子就是MyTriangleValue。然而，自己写属性值类型会比较繁琐，NS-3中提供了两个宏来帮助我们申明和定义一个属性值类型：</p>
<figure class="highlight cpp"><figcaption><span>attribute-helper.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//生成属性值类型的申明，type是底层存储类型的类名</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ATTRIBUTE_HELPER_HEADER(type)                                   \</span></span><br><span class="line">  ATTRIBUTE_VALUE_DEFINE (type);                                        \</span><br><span class="line">  ATTRIBUTE_ACCESSOR_DEFINE (type);                                     \</span><br><span class="line">  ATTRIBUTE_CHECKER_DEFINE (type)</span><br><span class="line"></span><br><span class="line"><span class="comment">//生成属性值类型的实现，type是底层存储类型的类名</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ATTRIBUTE_HELPER_CPP(type)                                      \</span></span><br><span class="line">  ATTRIBUTE_CHECKER_IMPLEMENT (type);                                   \</span><br><span class="line">  ATTRIBUTE_VALUE_IMPLEMENT (type)</span><br></pre></td></tr></table></figure>
<p>这两个宏的使用非常简单，例如我们要为新创建的MyTriangle类生成属性值类型，可以：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-customise.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ATTRIBUTE_HELPER_HEADER(MyTriangle);</span><br><span class="line">ATTRIBUTE_HELPER_CPP(MyTriangle);</span><br></pre></td></tr></table></figure>
<p>第一个宏ATTRIBUTE_HELPER_HEADER(MyTriangle)帮我们生成了MyTriangleValue类的申明、两个默认的MakeMyTriangleAccessor()方法以及一个MakeMyTriangleChecker()方法。宏展开后，对应的代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTriangleValue</span> :</span> <span class="keyword">public</span> AttributeValue                           \</span><br><span class="line">  &#123;                                                                     \</span><br><span class="line">  <span class="keyword">public</span>:                                                               \</span><br><span class="line">    MyTriangleValue ();                                                   \</span><br><span class="line">    MyTriangleValue (<span class="keyword">const</span> MyTriangle &amp;value);                                  \</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Set</span> <span class="params">(<span class="keyword">const</span> MyTriangle &amp;value)</span></span>;                                       \</span><br><span class="line">    <span class="function">MyTriangle <span class="title">Get</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;                                              \</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;                                               \</span><br><span class="line">      <span class="function"><span class="keyword">bool</span> <span class="title">GetAccessor</span> <span class="params">(T &amp;value)</span> <span class="keyword">const</span> </span>&#123;                               \</span><br><span class="line">      value = T (m_value);                                              \</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;                                                      \</span><br><span class="line">    &#125;                                                                   \</span><br><span class="line">    <span class="keyword">virtual</span> Ptr&lt;AttributeValue&gt; Copy (<span class="keyword">void</span>) <span class="keyword">const</span>;                      \</span><br><span class="line">    <span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="built_in">string</span>                                                 \</span><br><span class="line">      SerializeToString (Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker) <span class="keyword">const</span>;    \</span><br><span class="line">    <span class="keyword">virtual</span> <span class="keyword">bool</span>                                                        \</span><br><span class="line">      DeserializeFromString (<span class="built_in">std</span>::<span class="built_in">string</span> value,                         \</span><br><span class="line">                             Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker);      \</span><br><span class="line">  <span class="keyword">private</span>:                                                              \</span><br><span class="line">    MyTriangle m_value;                                                       \</span><br><span class="line">  &#125;;                                        \</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1&gt;                                                \</span><br><span class="line">  Ptr&lt;<span class="keyword">const</span> AttributeAccessor&gt; MakeMyTriangleAccessor (T1 a1)         \</span><br><span class="line">  &#123;                                                                     \</span><br><span class="line">    <span class="keyword">return</span> MakeAccessorHelper&lt;MyTriangleValue&gt; (a1);                      \</span><br><span class="line">  &#125;                                                                     \</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2&gt;                                   \</span><br><span class="line">  Ptr&lt;<span class="keyword">const</span> AttributeAccessor&gt; MakeMyTriangleAccessor (T1 a1, T2 a2)  \</span><br><span class="line">  &#123;                                                                     \</span><br><span class="line">    <span class="keyword">return</span> MakeAccessorHelper&lt;MyTriangleValue&gt; (a1, a2);                  \</span><br><span class="line">  &#125;;                                     \</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyTriangleChecker</span> :</span> <span class="keyword">public</span> AttributeChecker &#123;&#125;;                   \</span><br><span class="line">  Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeMyTriangleChecker (<span class="keyword">void</span>)</span><br></pre></td></tr></table></figure>
<p>而第二个宏ATTRIBUTE_HELPE_CPP(MyTriangle)即实现了MyTriangleValue这个类以及对应的MakeMyTriangleAccessor()方法和MakeMyTriangleChecker()方法。宏展开后，对应代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeMyTriangleChecker (<span class="keyword">void</span>) &#123;          \</span><br><span class="line">  <span class="keyword">return</span> MakeSimpleAttributeChecker&lt;MyTriangleValue,MyTriangleChecker&gt;    \</span><br><span class="line">    (<span class="string">"MyTriangle"</span> <span class="string">"Value"</span>, <span class="string">"MyTriangle"</span>);                                         \</span><br><span class="line">&#125;;                                   \</span><br><span class="line">MyTriangleValue::MyTriangleValue ()                                       \</span><br><span class="line">  : m_value () &#123;&#125;                                                     \</span><br><span class="line">MyTriangleValue::MyTriangleValue (<span class="keyword">const</span> MyTriangle &amp;value)                      \</span><br><span class="line">  : m_value (value) &#123;&#125;                                                \</span><br><span class="line"><span class="keyword">void</span> MyTriangleValue::Set (<span class="keyword">const</span> MyTriangle &amp;v) &#123;                             \</span><br><span class="line">  m_value = v;                                                        \</span><br><span class="line">&#125;                                                                     \</span><br><span class="line">MyTriangle  MyTriangleValue::Get (<span class="keyword">void</span>) <span class="keyword">const</span> &#123;                                \</span><br><span class="line">  <span class="keyword">return</span> m_value;                                                     \</span><br><span class="line">&#125;                                                                     \</span><br><span class="line">Ptr&lt;AttributeValue&gt;                                                   \</span><br><span class="line">MyTriangleValue::Copy (<span class="keyword">void</span>) <span class="keyword">const</span> &#123;                                    \</span><br><span class="line">  <span class="keyword">return</span> ns3::Create&lt;MyTriangleValue&gt; (*<span class="keyword">this</span>);                          \</span><br><span class="line">&#125;                                                                     \</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> MyTriangleValue::SerializeToString                          \</span><br><span class="line">  (Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker) <span class="keyword">const</span> &#123;                       \</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">ostringstream</span> oss;                                           \</span><br><span class="line">    oss &lt;&lt; m_value;                                                   \</span><br><span class="line">    <span class="keyword">return</span> oss.str ();                                                \</span><br><span class="line">&#125;                                                                     \</span><br><span class="line"><span class="keyword">bool</span> MyTriangleValue::DeserializeFromString                             \</span><br><span class="line">  (<span class="built_in">std</span>::<span class="built_in">string</span> value, Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker) &#123;          \</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">istringstream</span> iss;                                           \</span><br><span class="line">    iss.str (value);                                                  \</span><br><span class="line">    iss &gt;&gt; m_value;                                                   \</span><br><span class="line">    <span class="keyword">do</span> &#123;                                                                 \</span><br><span class="line">  <span class="keyword">if</span> (!(iss.eof ()))                                                          \</span><br><span class="line">    &#123;                                                                \</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"aborted. cond=\""</span> &lt;&lt; <span class="string">"!(iss.eof ())"</span> &lt;&lt; <span class="string">"\", "</span>;           \</span><br><span class="line">      <span class="keyword">do</span>                                                    \</span><br><span class="line">  &#123;                                                   \</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"msg=\""</span> &lt;&lt; <span class="string">"Attribute value "</span> &lt;&lt; <span class="string">"\""</span> &lt;&lt; value &lt;&lt; <span class="string">"\""</span>  \</span><br><span class="line">                         &lt;&lt; <span class="string">" is not properly formatted"</span> &lt;&lt; <span class="string">"\", "</span>;           \</span><br><span class="line">    <span class="keyword">do</span>                                                      \</span><br><span class="line">  &#123;                                                     \</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"file="</span> &lt;&lt; <span class="string">"/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/scratch/try-attribute-customise.cc"</span> &lt;&lt; <span class="string">", line="</span> &lt;&lt;    \</span><br><span class="line">      <span class="number">52</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;                            \</span><br><span class="line">    ::ns3::FatalImpl::FlushStreams ();                  \</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">true</span>) <span class="built_in">std</span>::terminate ();                       \</span><br><span class="line">  &#125;                                                     \</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">false</span>);               \</span><br><span class="line">  &#125;                                                   \</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">false</span>);                                          \</span><br><span class="line">    &#125;                                                                \</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="literal">false</span>);            \</span><br><span class="line">    <span class="keyword">return</span> !iss.bad () &amp;&amp; !iss.fail ();                               \</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实际上，在最简单的情况下，使用了这两个宏之后，自定义的属性值类型已经可以使用了。</p>
<h2 id="4-3-实现和使用属性"><a href="#4-3-实现和使用属性" class="headerlink" title="4.3. 实现和使用属性"></a>4.3. 实现和使用属性</h2><p>完整程序如下：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-customise.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ns3 &#123;		<span class="comment">//一般建议将所有对象都写在ns3名称空间中</span></span><br><span class="line"></span><br><span class="line">  NS_LOG_COMPONENT_DEFINE (<span class="string">"MyTriangle"</span>);			<span class="comment">//定义一个日志组件</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyTriangle</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">  	MyTriangle();</span><br><span class="line"></span><br><span class="line">  	MyTriangle(<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">  	<span class="keyword">double</span> m_side1;</span><br><span class="line">		<span class="keyword">double</span> m_side2;</span><br><span class="line">		<span class="keyword">double</span> m_side3;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> <span class="built_in">std</span>::ostream &amp;<span class="keyword">operator</span> &lt;&lt; (<span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> MyTriangle &amp;rate);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  MyTriangle::MyTriangle(): m_side1(<span class="number">0</span>), m_side2(<span class="number">0</span>), m_side3(<span class="number">0</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyTriangle::MyTriangle(<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3) &#123;</span><br><span class="line">    m_side1 = side1;</span><br><span class="line">    m_side2 = side2;</span><br><span class="line">    m_side3 = side3;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::ostream &amp;<span class="keyword">operator</span> &lt;&lt; (<span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> MyTriangle &amp;triangle) &#123;</span><br><span class="line">  	os &lt;&lt; <span class="string">"triangle ("</span> &lt;&lt;	triangle.m_side1 &lt;&lt; <span class="string">", "</span> &lt;&lt; triangle.m_side2 &lt;&lt; <span class="string">", "</span> &lt;&lt; triangle.m_side3 &lt;&lt; <span class="string">")"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  	<span class="keyword">return</span> os;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::istream &amp;<span class="keyword">operator</span> &gt;&gt; (<span class="built_in">std</span>::istream &amp;is, MyTriangle &amp;rate) &#123;</span><br><span class="line">  	<span class="keyword">return</span> is;</span><br><span class="line">  &#125;</span><br><span class="line">  <marked style="border-bottom: 2px solid red;">ATTRIBUTE_HELPER_HEADER(MyTriangle);</marked></span><br><span class="line">  <marked style="border-bottom: 2px solid red;">ATTRIBUTE_HELPER_CPP(MyTriangle);</marked></span><br><span class="line"></span><br><span class="line">	<span class="comment">//================MyObject==================</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> :</span> <span class="keyword">public</span> Object	<span class="comment">//继承自SimpleRefCount，又继承自ObjectBase</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">    MyObject ();</span><br><span class="line">    <span class="keyword">virtual</span> ~MyObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//业务方法</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MyMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetTriangle</span><span class="params">(MyTriangle &amp; triangle)</span> </span>&#123;</span><br><span class="line">    	m_triangle = triangle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">MyTriangle &amp; <span class="title">GetObj</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> m_triangle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    MyTriangle m_triangle;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  NS_OBJECT_ENSURE_REGISTERED (MyObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">  TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">  		.SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">      <marked style="border-bottom: 2px solid red;">.AddAttribute (<span class="string">"myTriangle"</span>, <span class="string">"help text"</span>,</marked></span><br><span class="line">										 <marked style="border-bottom: 2px solid red;">MyTriangleValue(),</marked></span><br><span class="line">                     <marked style="border-bottom: 2px solid red;">MakeMyTriangleAccessor (&amp;MyObject::m_triangle),</marked></span><br><span class="line">                     <marked style="border-bottom: 2px solid red;">MakeMyTriangleChecker ())</marked></span><br><span class="line">			;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::~MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span></span><br><span class="line">	MyObject::MyMethod ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		NS_LOG_UNCOND(<span class="string">"my method is executed"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; getCheckerByName(TypeId typeId, <span class="built_in">std</span>::<span class="built_in">string</span> attributeName) &#123;</span><br><span class="line">	TypeId::AttributeInformation * info = <span class="keyword">new</span> TypeId::AttributeInformation();</span><br><span class="line">	typeId.LookupAttributeByName(attributeName, info);</span><br><span class="line">	Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker = info-&gt;checker;</span><br><span class="line">	<span class="keyword">delete</span> info;</span><br><span class="line">	<span class="keyword">return</span> checker;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyTriangle"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	<span class="function">MyTriangle <span class="title">triangle</span><span class="params">(<span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	obj-&gt;SetAttribute(<span class="string">"myTriangle"</span>, MyTriangleValue(triangle));</span><br><span class="line"></span><br><span class="line">	MyTriangleValue value2;</span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"myTriangle"</span>, value2);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; value2.Get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在具体实现属性的时候需要注意的是：</p>
<ul>
<li>一般<strong>会</strong>提供一个输出方法，来输出属性的值，以方便调试。在这个程序中，我们重载了对于输出流的&lt;&lt;操作符，打印了三角形的三个属性。</li>
<li>如果是输出过程需要用到数据类的私有成员，则需要将操作符定义为数据类的友元方法。</li>
<li><strong>必须</strong>提供一个输入方法，来从输入流输入属性的信息。程序中我们重载了输入流的&gt;&gt;操作符，用来处理输入，程序中暂时没有进行任何处理。</li>
</ul>
<h2 id="4-4-和字符串之前转换"><a href="#4-4-和字符串之前转换" class="headerlink" title="4.4. 和字符串之前转换"></a>4.4. 和字符串之前转换</h2><p>前面在介绍NS-3属性框架的时候介绍过，属性值类型和字符串值类型之前可以进行转换。默认情况下，属性值向字符串转换的功能主要是依靠操作符&lt;&lt;来实现的。这个在我们的程序当中已经实现了。而从字符串转换成特定属性值类型主要是依靠操作符&gt;&gt;来实现的。目前我们程序当中并未实现。</p>
<h3 id="4-4-1-指定类型表示规则"><a href="#4-4-1-指定类型表示规则" class="headerlink" title="4.4.1. 指定类型表示规则"></a>4.4.1. 指定类型表示规则</h3><p>我们首先得定一个规则，如何使用字符串来表示一个属性。由于我们的MyTriangle类并没有继承自Object类，因此无法直接通过ObjectFactory来转换，而需要自己实现转换方法。考虑到我们的底层类是一个三角形，那么我们可以输入三个浮点数来表示三条不同的边，数字之间使用逗号分隔。</p>
<h3 id="4-4-2-编写解析代码"><a href="#4-4-2-编写解析代码" class="headerlink" title="4.4.2. 编写解析代码"></a>4.4.2. 编写解析代码</h3><p>定好了解析规则之后，我们就可以开始写解析程序，在MyTriangle中加入静态方法DoParse()：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-customise.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">MyTriangle</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">   ……</span><br><span class="line">   <span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">DoParse</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> str, <span class="keyword">double</span> sides[])</span></span>;</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span></span><br><span class="line">MyTriangle::DoParse (<span class="built_in">std</span>::<span class="built_in">string</span> str, <span class="keyword">double</span> sides[])</span><br><span class="line">&#123;</span><br><span class="line">	NS_LOG_FUNCTION(str &lt;&lt; sides);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">istringstream</span> iss;</span><br><span class="line">	iss.str(str);</span><br><span class="line">   <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="built_in">std</span>::<span class="built_in">string</span> num; <span class="built_in">std</span>::getline(iss, num, <span class="string">','</span>); count++)  <span class="comment">//以逗号分开</span></span><br><span class="line">   &#123;</span><br><span class="line">			<span class="built_in">std</span>::<span class="built_in">istringstream</span> s;</span><br><span class="line">			s.str(num);</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           s &gt;&gt; sides[count];</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::ios_base::failure&amp; e)</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(count &gt;= <span class="number">3</span>) &#123;  <span class="comment">//超过三个数即解析失败</span></span><br><span class="line">					<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(count == <span class="number">3</span>) &#123;  <span class="comment">//确认只有3个数</span></span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在解析参数的过程中，我们需要保证：</p>
<ul>
<li>以逗号分隔的数字个数必须是3个</li>
<li>每个数字必须能够转换成double类型</li>
<li>满足以上两个条件，返回true</li>
<li>不满足任意一个条件，返回false，表示参数解析失败</li>
</ul>
<p>最后，在&gt;&gt;操作符中调用DoParse()方法，即可自动完成类型转换：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-customise.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::istream &amp;<span class="keyword">operator</span> &gt;&gt; (<span class="built_in">std</span>::istream &amp;is, MyTriangle &amp;triangle) &#123;</span><br><span class="line">	<span class="keyword">double</span> sides[<span class="number">3</span>];</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> value;</span><br><span class="line">  is &gt;&gt; value;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">bool</span> parseOk = MyTriangle::DoParse(value, sides);</span><br><span class="line">  <span class="comment">//如果参数解析失败，则退出程序，并提示错误</span></span><br><span class="line">  NS_ASSERT_MSG(parseOk, <span class="string">"Triangle parse error: must provide three numbers divided by comma."</span>);</span><br><span class="line"></span><br><span class="line">  triangle = MyTriangle(sides[<span class="number">0</span>], sides[<span class="number">1</span>], sides[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> is;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果参数解析失败，则DoParse()方法必然返回false。因此，我们可以使用<strong>断言（Assert）</strong>来确保，输入的参数必须是正确的，否则，程序将会停止运行，并输出错误。</p>
<p>用以下程序来测试类型的转换（注意在这种方式下，参数的各个部分之间不能又空格）：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-customise.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyTriangle"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	<marked style="border-bottom: 2px solid red;">obj-&gt;SetAttribute(<span class="string">"myTriangle"</span>, StringValue(<span class="string">"5,3,2"</span>));</marked></span><br><span class="line"></span><br><span class="line">	MyTriangleValue value2;</span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"myTriangle"</span>, value2);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; value2.Get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序中，我们使用StringValue来给MyTriangleValue赋值。NS-3的属性系统会自动调用转换程序，从字符串来构造三角形。注意这种模式下，参数的各个部分之间不能留有空格，例如”5,3,2”不能写为”5, 3, 2”（当然，要允许空格也可以简单地修改程序来适应，在此不再赘述）。运行程序之后，可以看到输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[ 931/1969] Compiling scratch/try-attribute-customise.cc</span><br><span class="line">[1912/1969] Linking build/scratch/try-attribute-customise</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.148s)</span><br><span class="line">MyTriangle:MyObject(0x265d650)</span><br><span class="line">MyTriangle:DoParse(&quot;5,3,2&quot;, 0x7ffcdb4e8c40)</span><br><span class="line">triangle (5, 3, 2)</span><br><span class="line">MyTriangle:~MyObject(0x265d650)</span><br></pre></td></tr></table></figure>
<p>当然，如果，我们提供的参数不正确，程序便会异常终止。例如，我们将用于构造三角形的字符串改为：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-customise.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj-&gt;SetAttribute(<span class="string">"myTriangle"</span>, StringValue(<span class="string">"5,3,"</span>));</span><br></pre></td></tr></table></figure>
<p>将得到运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[ 931/1969] Compiling scratch/try-attribute-customise.cc</span><br><span class="line">[1958/1969] Linking build/scratch/try-attribute-customise</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.213s)</span><br><span class="line">MyTriangle:MyObject(0x21a9650)</span><br><span class="line">MyTriangle:DoParse(&quot;5,3,&quot;, 0x7ffc5a78e8f0)</span><br><span class="line">assert failed. cond=&quot;parseOk&quot;, msg=&quot;Triangle parse error: must provide three numbers divided by comma.&quot;, file=../scratch/try-attribute-customise.cc, line=87</span><br><span class="line">terminate called without an active exception</span><br><span class="line">Command [&apos;/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build/scratch/try-attribute-customise&apos;] terminated with signal SIGIOT. Run it under a debugger to get more information (./waf --run &lt;program&gt; --command-template=&quot;gdb --args %s &lt;args&gt;&quot;).</span><br></pre></td></tr></table></figure>
<p>可以看到明确的assert failed提示，并且获得提示信息以及错误发生的位置。</p>
<h2 id="4-5-检查属性的正确性与自定义检查器"><a href="#4-5-检查属性的正确性与自定义检查器" class="headerlink" title="4.5. 检查属性的正确性与自定义检查器"></a>4.5. 检查属性的正确性与自定义检查器</h2><p>如果我们仔细观察，我面上面举的例子当中的三角形”5,3,2”其实并不是一个三角形。我们必须在创建三角形属性的时候检查传入的参数是否真的能构成一个三角形。</p>
<p><strong>回顾</strong>：三角形的构成条件：两边之和必须大于第三边，两边只差必须小于第三边。换句话说，我们可以这么理解：</p>
<ul>
<li>任意从三边当中取出两边相加，它们的和必须大于第三边。这是一个典型的组合问题，一共有$C_{3}^{2}=3$种可能，依次为：<ul>
<li>$a + b &gt; c$</li>
<li>$a + c &gt; b$</li>
<li>$b + c &gt; a$</li>
</ul>
</li>
<li>任意从三角形当中取出两边相减，它们的差必须小于第三边。这是一个典型的排列问题，一共有$P_{3}^{2}=6$种可能：<ul>
<li>$a - b &lt; c$</li>
<li>$b - a &lt; c$</li>
<li>$a - c &lt; b$</li>
<li>$c - a &lt; b$</li>
<li>$b - c &lt; a$</li>
<li>$c - b &lt; a$</li>
</ul>
</li>
</ul>
<p>我们可以在创建三角形的时候检查这三九个条件，如果其中任意一个不满足，那么三角形构造失败，将三角形标记未非法。但是这种方法当中，if语句的条件未免显得太复杂了。我们考虑简化这个情况。实际上，我们只要检查最短的两条边的和是否大于最长的边，即可满足这9个条件。下面我们给出证明：</p>
<p>证明：首先，不失一般性地，我们假设最长边是$c$。</p>
<p>因此有$c \ge a$且$c \ge b$，又由于$a, b, c \ne 0$，因此可以推出：$c + b &gt; a$和$c + a &gt; b$。</p>
<p>由于最短两条边之和大于最长边，有：$a + b &gt; c$。第一组条件成立。</p>
<p>由$a + b &gt; c$可以推出：$c - a &lt; b$和$c - b &lt; a$。</p>
<p>由$c + b &gt; a$可以推出：$a - b &lt; c$和$a - c &lt; b$。</p>
<p>由$c + a &gt; b$可以推出：$b - c &lt; a$和$b - a &lt; c$。</p>
<p>因此，第二组条件成立。证毕。</p>
<p>然而，我们需要从三个数当中最小的两个，这需要排序，复杂度较高。我们可以考虑另外一种方法：找到最大值，然后全部求和，再减掉最大值即剩下两个最小值之和：</p>
<p>$$<br>m = max(a,b,c) \\<br>a + b + c - m ?&gt; m<br>$$</p>
<p>即，在保证a,b,c均为正数的情况下，程序只需要判断如下条件即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">double m = max(a, b, c);</span><br><span class="line">if(a + b + c &gt; 2 * m) &#123;</span><br><span class="line">  //三角形条件成立</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  //三角形条件不成立</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以在MyTriangle类当中添加一个静态方法Vlidate()用来检查参数是否合法：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-customise.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">MyTriangle</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">   ……</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">Validate</span> <span class="params">(<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3)</span></span>;</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span></span><br><span class="line">MyTriangle::Validate (<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">double</span> min = <span class="built_in">std</span>::min(<span class="built_in">std</span>::min(side1, side2), side3);</span><br><span class="line">	<span class="keyword">double</span> max = <span class="built_in">std</span>::max(<span class="built_in">std</span>::max(side1, side2), side3);</span><br><span class="line">	<span class="keyword">double</span> sum = side1 + side2 + side3;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(min &gt; <span class="number">0</span> &amp;&amp; sum - max &gt; <span class="number">2</span> * max) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，在MyTriangle类当中加入一个validate属性，默认为false。只有验证通过了才为true：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-customise.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTriangle</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IsValidate</span> <span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> m_validate; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetValidate</span> <span class="params">(<span class="keyword">bool</span> validate)</span> </span>&#123; m_validate = validate; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">bool</span> m_validate;</span><br><span class="line">&#125;;</span><br><span class="line">MyTriangle::MyTriangle():m_validate(<span class="literal">false</span>), m_side1(<span class="number">0</span>), m_side2(<span class="number">0</span>), m_side3(<span class="number">0</span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyTriangle::MyTriangle(<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3) &#123;</span><br><span class="line">	m_validate = MyTriangle::Validate(side1, side2, side3);</span><br><span class="line">	<span class="keyword">if</span>(m_validate) &#123;</span><br><span class="line">    m_side1 = side1;</span><br><span class="line">    m_side2 = side2;</span><br><span class="line">    m_side3 = side3;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此构建的时候，只要不符合条件，构造出的三角形一定不合法。如果我们想限制只有合法的三角形对象才能作为属性设置，那么必须重写MyTriangleValue类的检查器。默认情况下，检查器是由ATTRIBUTE_HELPER_CPP()宏自动展开的。前面查看宏的定义可以发现，该宏实际上又是两个宏定义的：</p>
<ul>
<li>ATTRIBUTE_CHECKER_IMPLEMENT()：定义了检查器的实现</li>
<li>ATTRIBUTE_VALUE_IMPLEMENT()：定义了类的实现</li>
<li>访问器是模板方法，是在HEADER当中定义的</li>
</ul>
<p>由于我们需要自定义检查器，因此不能包含检查器的默认实现，因此仅仅需要定义类的实现即可。而具体检查器的实现有用户自己实现。下面的程序演示了如何自定义检查器的实现的完成程序：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-customise.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ns3 &#123;		<span class="comment">//一般建议将所有对象都写在ns3名称空间中</span></span><br><span class="line"></span><br><span class="line">  NS_LOG_COMPONENT_DEFINE (<span class="string">"MyTriangle"</span>);			<span class="comment">//定义一个日志组件</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyTriangle</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">  	MyTriangle();</span><br><span class="line"></span><br><span class="line">  	MyTriangle(<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3);</span><br><span class="line"></span><br><span class="line">  	<span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">Validate</span><span class="params">(<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">DoParse</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> str, <span class="keyword">double</span> sides[])</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">bool</span> <span class="title">IsValidate</span> <span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> m_validate; &#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">SetValidate</span> <span class="params">(<span class="keyword">bool</span> validate)</span> </span>&#123; m_validate = validate; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">bool</span> m_validate;</span><br><span class="line"></span><br><span class="line">  	<span class="keyword">double</span> m_side1;</span><br><span class="line">		<span class="keyword">double</span> m_side2;</span><br><span class="line">		<span class="keyword">double</span> m_side3;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> <span class="built_in">std</span>::ostream &amp;<span class="keyword">operator</span> &lt;&lt; (<span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> MyTriangle &amp;rate);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  MyTriangle::MyTriangle():m_validate(<span class="literal">false</span>), m_side1(<span class="number">0</span>), m_side2(<span class="number">0</span>), m_side3(<span class="number">0</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyTriangle::MyTriangle(<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3) &#123;</span><br><span class="line">  	m_validate = MyTriangle::Validate(side1, side2, side3);</span><br><span class="line">  	<span class="keyword">if</span>(m_validate) &#123;</span><br><span class="line">      m_side1 = side1;</span><br><span class="line">      m_side2 = side2;</span><br><span class="line">      m_side3 = side3;</span><br><span class="line">  	&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span></span><br><span class="line">	MyTriangle::DoParse (<span class="built_in">std</span>::<span class="built_in">string</span> str, <span class="keyword">double</span> sides[])</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(str &lt;&lt; sides);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">istringstream</span> iss;</span><br><span class="line">		iss.str(str);</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="built_in">std</span>::<span class="built_in">string</span> num; <span class="built_in">std</span>::getline(iss, num, <span class="string">','</span>); count++)</span><br><span class="line">    &#123;</span><br><span class="line">				<span class="built_in">std</span>::<span class="built_in">istringstream</span> s;</span><br><span class="line">				s.str(num);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            s &gt;&gt; sides[count];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::ios_base::failure&amp; e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span>(count &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">						<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(count == <span class="number">3</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span></span><br><span class="line">	MyTriangle::Validate (<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">double</span> min = <span class="built_in">std</span>::min(<span class="built_in">std</span>::min(side1, side2), side3);</span><br><span class="line">		<span class="keyword">double</span> max = <span class="built_in">std</span>::max(<span class="built_in">std</span>::max(side1, side2), side3);</span><br><span class="line">		<span class="keyword">double</span> sum = side1 + side2 + side3;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(min &gt; <span class="number">0</span> &amp;&amp; sum - max &gt; <span class="number">2</span> * max) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::ostream &amp;<span class="keyword">operator</span> &lt;&lt; (<span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> MyTriangle &amp;triangle) &#123;</span><br><span class="line">  	os &lt;&lt; <span class="string">"triangle ("</span> &lt;&lt;	triangle.m_side1 &lt;&lt; <span class="string">", "</span> &lt;&lt; triangle.m_side2 &lt;&lt; <span class="string">", "</span> &lt;&lt; triangle.m_side3 &lt;&lt; <span class="string">")"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  	<span class="keyword">return</span> os;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::istream &amp;<span class="keyword">operator</span> &gt;&gt; (<span class="built_in">std</span>::istream &amp;is, MyTriangle &amp;triangle) &#123;</span><br><span class="line">  	<span class="keyword">double</span> sides[<span class="number">3</span>];</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> value;</span><br><span class="line">    is &gt;&gt; value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> parseOk = MyTriangle::DoParse(value, sides);</span><br><span class="line"></span><br><span class="line">    NS_ASSERT_MSG(parseOk, <span class="string">"Triangle parse error: must provide three numbers divided by comma."</span>);</span><br><span class="line"></span><br><span class="line">    triangle = MyTriangle(sides[<span class="number">0</span>], sides[<span class="number">1</span>], sides[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">  	<span class="keyword">return</span> is;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ATTRIBUTE_HELPER_HEADER(MyTriangle);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//如果要自定义Checker，那么仅仅需要调用默认的类实现即可</span></span><br><span class="line">  ATTRIBUTE_VALUE_IMPLEMENT(MyTriangle);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//则Checker自己实现</span></span><br><span class="line">  <marked style="border-bottom: 2px solid red;"><span class="keyword">namespace</span> internal &#123;	<span class="comment">//实现一般放在internal名称空间当中，不允许外部直接调用</span></marked></span><br><span class="line">    <marked style="border-bottom: 2px solid red;">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeMyTriangleChecker () &#123;</marked></span><br><span class="line">      NS_LOG_FUNCTION_NOARGS();</span><br><span class="line"></span><br><span class="line">      <span class="class"><span class="keyword">struct</span> <span class="title">MyTriangleChecker</span> :</span> <span class="keyword">public</span> AttributeChecker</span><br><span class="line">      &#123;</span><br><span class="line">        MyTriangleChecker ()&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Check</span> <span class="params">(<span class="keyword">const</span> AttributeValue &amp;value)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION (&amp;value);</span><br><span class="line">          <span class="keyword">const</span> MyTriangleValue *v = <span class="keyword">dynamic_cast</span>&lt;<span class="keyword">const</span> MyTriangleValue *&gt; (&amp;value);</span><br><span class="line">          <span class="keyword">if</span> (v == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="keyword">return</span> v-&gt;Get().IsValidate();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">GetValueTypeName</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION_NOARGS ();</span><br><span class="line">          <span class="keyword">return</span> <span class="string">"ns3::MyTriangleValue"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasUnderlyingTypeInformation</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION_NOARGS ();</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">GetUnderlyingTypeInformation</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION_NOARGS ();</span><br><span class="line">          <span class="built_in">std</span>::<span class="built_in">ostringstream</span> oss;</span><br><span class="line">          oss &lt;&lt; <span class="string">"MyTriangle"</span>;</span><br><span class="line">          <span class="keyword">return</span> oss.str ();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">virtual</span> Ptr&lt;AttributeValue&gt; Create (<span class="keyword">void</span>) <span class="keyword">const</span> &#123;</span><br><span class="line">          NS_LOG_FUNCTION_NOARGS ();</span><br><span class="line">          <span class="keyword">return</span> ns3::Create&lt;MyTriangleValue&gt; ();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Copy</span> <span class="params">(<span class="keyword">const</span> AttributeValue &amp;src, AttributeValue &amp;dst)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION (&amp;src &lt;&lt; &amp;dst);</span><br><span class="line">          <span class="keyword">const</span> MyTriangleValue *source = <span class="keyword">dynamic_cast</span>&lt;<span class="keyword">const</span> MyTriangleValue *&gt; (&amp;src);</span><br><span class="line">          MyTriangleValue *destination = <span class="keyword">dynamic_cast</span>&lt;MyTriangleValue *&gt; (&amp;dst);</span><br><span class="line">          <span class="keyword">if</span> (source == <span class="number">0</span> || destination == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          *destination = *source;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; *checker = <span class="keyword">new</span> MyTriangleChecker();</span><br><span class="line">      <span class="keyword">return</span> Ptr&lt;AttributeChecker&gt; (checker, <span class="literal">false</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="comment">// internal</span></span><br><span class="line"></span><br><span class="line">  Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeMyTriangleChecker (<span class="keyword">void</span>) &#123;</span><br><span class="line">    <marked style="border-bottom: 2px solid red;"><span class="keyword">return</span> internal::MakeMyTriangleChecker();</marked></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//================MyObject==================</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> :</span> <span class="keyword">public</span> Object	<span class="comment">//继承自SimpleRefCount，又继承自ObjectBase</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line">    MyObject ();</span><br><span class="line">    <span class="keyword">virtual</span> ~MyObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//业务方法</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MyMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetTriangle</span><span class="params">(MyTriangle &amp; triangle)</span> </span>&#123;</span><br><span class="line">    	m_triangle = triangle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">MyTriangle &amp; <span class="title">GetObj</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> m_triangle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    MyTriangle m_triangle;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  NS_OBJECT_ENSURE_REGISTERED (MyObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">  TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">  		.SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">      .AddAttribute (<span class="string">"myTriangle"</span>, <span class="string">"help text"</span>,</span><br><span class="line">										 MyTriangleValue(),</span><br><span class="line">                     MakeMyTriangleAccessor (&amp;MyObject::m_triangle),</span><br><span class="line">                     <marked style="border-bottom: 2px solid red;">MakeMyTriangleChecker ())</marked></span><br><span class="line">			;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::~MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span></span><br><span class="line">	MyObject::MyMethod ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		NS_LOG_UNCOND(<span class="string">"my method is executed"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; getCheckerByName(TypeId typeId, <span class="built_in">std</span>::<span class="built_in">string</span> attributeName) &#123;</span><br><span class="line">	TypeId::AttributeInformation * info = <span class="keyword">new</span> TypeId::AttributeInformation();</span><br><span class="line">	typeId.LookupAttributeByName(attributeName, info);</span><br><span class="line">	Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker = info-&gt;checker;</span><br><span class="line">	<span class="keyword">delete</span> info;</span><br><span class="line">	<span class="keyword">return</span> checker;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyTriangle"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	obj-&gt;SetAttribute(<span class="string">"myTriangle"</span>, StringValue(<span class="string">"5,3,2"</span>));</span><br><span class="line"></span><br><span class="line">	MyTriangleValue value2;</span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"myTriangle"</span>, value2);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; value2.Get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们运行程序之后有如下的结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[1822/1969] Compiling scratch/try-attribute-customise.cc</span><br><span class="line">[1926/1969] Linking build/scratch/try-attribute-customise</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (4.475s)</span><br><span class="line">MyTriangle:MyObject(0x7e1e00)</span><br><span class="line">MyTriangle:Check(0x7dc650)</span><br><span class="line">MyTriangle:Check(0x7ffe4c505780)</span><br><span class="line">MyTriangle:Create()</span><br><span class="line">MyTriangle:DoParse(&quot;5,3,2&quot;, 0x7ffe4c505160)</span><br><span class="line">MyTriangle:Check(0x7dbf40)</span><br><span class="line">msg=&quot;Attribute name=myTriangle could not be set for this object: tid=ns3::MyObject&quot;, file=../src/core/model/object-base.cc, line=201</span><br><span class="line">terminate called without an active exception</span><br><span class="line">Command [&apos;/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build/scratch/try-attribute-customise&apos;] terminated with signal SIGIOT. Run it under a debugger to get more information (./waf --run &lt;program&gt; --command-template=&quot;gdb --args %s &lt;args&gt;&quot;).</span><br></pre></td></tr></table></figure>
<p>可见，我们通过程序检查了数据的合法性，如果传入的三角形不合法，是无法被设置成属性的。</p>
<p>其中值得注意的是interval名称空间当中实现的方法，内部内嵌了一个结构体（相当于一个内部类），这个类完成了实际的AttributeChecker的工作。之所以采用这个方式是为了让MyTriangleChecker通过不同的方法创建的时候能拥有不同的具体实现。如果我们直接让MyTriangleChecker实现这个检查方法，那么它便无法再有其他的实现可能。我们通过下面的例子来解释，为了使用内部类可以让MyTriangleChecker有多种实现。</p>
<p>假设我们有时候还要限定三角形的类型是以下类型之一：锐角三角形（所有角均小于90度）、钝角三角形（有一个角大于90度）或者直角三角形（又一个角等于90度）。那么我们可以申明另外一个方法，这个方法应该传入我们限定的三角形类型：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-customise.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">	<span class="keyword">enum</span> TriangleType&#123;</span><br><span class="line">		ACUTE,    <span class="comment">//锐角</span></span><br><span class="line">	OBTUSE,   <span class="comment">//钝角</span></span><br><span class="line">	RIGHT     <span class="comment">//直角</span></span><br><span class="line">	&#125;;</span><br><span class="line">……</span><br><span class="line"></span><br><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeMyTriangleChecker (MyTriangle::TriangleType type);</span><br></pre></td></tr></table></figure>
<p>这样，MakeMyTriangleChecker()应该要返回另外一种类型的类，这个类当中需要判断三角形的类型参数type。因此，我们还是选择使用内部类的实现，完成的程序如下：</p>
<figure class="highlight cpp"><figcaption><span>try-attribute-customise.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ns3/core-module.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> ns3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ns3 &#123;		<span class="comment">//一般建议将所有对象都写在ns3名称空间中</span></span><br><span class="line"></span><br><span class="line">  NS_LOG_COMPONENT_DEFINE (<span class="string">"MyTriangle"</span>);			<span class="comment">//定义一个日志组件</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyTriangle</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">  	<span class="keyword">enum</span> TriangleType&#123;</span><br><span class="line">  		ACUTE,</span><br><span class="line">			OBTUSE,</span><br><span class="line">			RIGHT</span><br><span class="line">  	&#125;;</span><br><span class="line">  	MyTriangle();</span><br><span class="line"></span><br><span class="line">  	MyTriangle(<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3);</span><br><span class="line"></span><br><span class="line">  	<span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">Validate</span><span class="params">(<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">DoParse</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> str, <span class="keyword">double</span> sides[])</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">bool</span> <span class="title">IsValidate</span> <span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> m_validate; &#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">SetValidate</span> <span class="params">(<span class="keyword">bool</span> validate)</span> </span>&#123; m_validate = validate; &#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">double</span> <span class="title">LongestSide</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">std</span>::max(m_side1, <span class="built_in">std</span>::max(m_side2, m_side3)); &#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// a + b + c</span></span><br><span class="line">		<span class="function"><span class="keyword">double</span> <span class="title">Perimeter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> m_side1 + m_side2 + m_side3;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// a * b * c</span></span><br><span class="line">		<span class="function"><span class="keyword">double</span> <span class="title">Product</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> m_side1 * m_side2 * m_side3; &#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// a + b if c is the longest side</span></span><br><span class="line">		<span class="function"><span class="keyword">double</span> <span class="title">SumOfOtherSides</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span>  Perimeter() - LongestSide(); &#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// a * b is c is the longest side</span></span><br><span class="line">		<span class="function"><span class="keyword">double</span> <span class="title">ProductOfOtherSides</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> Product() / LongestSide(); &#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// a^2 + b^2 ?= c^2</span></span><br><span class="line">		<span class="function"><span class="keyword">bool</span> <span class="title">IsRightTriangle</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">double</span> <span class="title">CosOfLargestAngle</span><span class="params">()</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="comment">//应用余玄定理: cosC = (a^2 + b^2 - c^2)/2ab</span></span><br><span class="line">			<span class="keyword">double</span> <span class="built_in">cos</span> = (<span class="built_in">pow</span>(SumOfOtherSides(), <span class="number">2</span>) - <span class="number">2</span> * ProductOfOtherSides() - <span class="built_in">pow</span>(LongestSide(), <span class="number">2</span>)) / (<span class="number">2</span> * ProductOfOtherSides());</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">cos</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">bool</span> m_validate;</span><br><span class="line"></span><br><span class="line">  	<span class="keyword">double</span> m_side1;</span><br><span class="line">		<span class="keyword">double</span> m_side2;</span><br><span class="line">		<span class="keyword">double</span> m_side3;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> <span class="built_in">std</span>::ostream &amp;<span class="keyword">operator</span> &lt;&lt; (<span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> MyTriangle &amp;rate);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  MyTriangle::MyTriangle():m_validate(<span class="literal">false</span>), m_side1(<span class="number">0</span>), m_side2(<span class="number">0</span>), m_side3(<span class="number">0</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyTriangle::MyTriangle(<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3) &#123;</span><br><span class="line">  	m_validate = MyTriangle::Validate(side1, side2, side3);</span><br><span class="line">  	<span class="keyword">if</span>(m_validate) &#123;</span><br><span class="line">      m_side1 = side1;</span><br><span class="line">      m_side2 = side2;</span><br><span class="line">      m_side3 = side3;</span><br><span class="line">  	&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span></span><br><span class="line">	MyTriangle::DoParse (<span class="built_in">std</span>::<span class="built_in">string</span> str, <span class="keyword">double</span> sides[])</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(str &lt;&lt; sides);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">istringstream</span> iss;</span><br><span class="line">		iss.str(str);</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="built_in">std</span>::<span class="built_in">string</span> num; <span class="built_in">std</span>::getline(iss, num, <span class="string">','</span>); count++)</span><br><span class="line">    &#123;</span><br><span class="line">				<span class="built_in">std</span>::<span class="built_in">istringstream</span> s;</span><br><span class="line">				s.str(num);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            s &gt;&gt; sides[count];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::ios_base::failure&amp; e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span>(count &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">						<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(count == <span class="number">3</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span></span><br><span class="line">	MyTriangle::Validate (<span class="keyword">double</span> side1, <span class="keyword">double</span> side2, <span class="keyword">double</span> side3)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">double</span> min = <span class="built_in">std</span>::min(<span class="built_in">std</span>::min(side1, side2), side3);</span><br><span class="line">		<span class="keyword">double</span> max = <span class="built_in">std</span>::max(<span class="built_in">std</span>::max(side1, side2), side3);</span><br><span class="line">		<span class="keyword">double</span> sum = side1 + side2 + side3;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(min &gt; <span class="number">0</span> &amp;&amp; sum &gt; <span class="number">2</span> * max) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">inline</span> <span class="keyword">bool</span></span><br><span class="line">	MyTriangle::IsRightTriangle ()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">double</span> other = <span class="built_in">pow</span>(SumOfOtherSides(), <span class="number">2</span>) - <span class="number">2</span> * ProductOfOtherSides();</span><br><span class="line">		<span class="keyword">double</span> longest = <span class="built_in">pow</span>(LongestSide(), <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"other: "</span> &lt;&lt; other &lt;&lt; <span class="string">", "</span> &lt;&lt; <span class="string">"longest: "</span> &lt;&lt; longest &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> other == longest;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::ostream &amp;<span class="keyword">operator</span> &lt;&lt; (<span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> MyTriangle &amp;triangle) &#123;</span><br><span class="line">  	os &lt;&lt; <span class="string">"triangle ("</span> &lt;&lt;	triangle.m_side1 &lt;&lt; <span class="string">", "</span> &lt;&lt; triangle.m_side2 &lt;&lt; <span class="string">", "</span> &lt;&lt; triangle.m_side3 &lt;&lt; <span class="string">")"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  	<span class="keyword">return</span> os;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::istream &amp;<span class="keyword">operator</span> &gt;&gt; (<span class="built_in">std</span>::istream &amp;is, MyTriangle &amp;triangle) &#123;</span><br><span class="line">  	<span class="keyword">double</span> sides[<span class="number">3</span>];</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> value;</span><br><span class="line">    is &gt;&gt; value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> parseOk = MyTriangle::DoParse(value, sides);</span><br><span class="line"></span><br><span class="line">    NS_ASSERT_MSG(parseOk, <span class="string">"Triangle parse error: must provide three numbers divided by comma."</span>);</span><br><span class="line"></span><br><span class="line">    triangle = MyTriangle(sides[<span class="number">0</span>], sides[<span class="number">1</span>], sides[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">  	<span class="keyword">return</span> is;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ATTRIBUTE_HELPER_HEADER(MyTriangle);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//如果要自定义Checker，那么仅仅需要调用默认的类实现即可</span></span><br><span class="line">  ATTRIBUTE_VALUE_IMPLEMENT(MyTriangle);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//则Checker自己实现</span></span><br><span class="line">  <span class="keyword">namespace</span> internal &#123;	<span class="comment">//实现一般放在internal名称空间当中，不允许外部直接调用</span></span><br><span class="line">    Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeMyTriangleChecker () &#123;</span><br><span class="line">      NS_LOG_FUNCTION_NOARGS();</span><br><span class="line"></span><br><span class="line">      <span class="class"><span class="keyword">struct</span> <span class="title">MyTriangleChecker</span> :</span> <span class="keyword">public</span> AttributeChecker</span><br><span class="line">      &#123;</span><br><span class="line">        MyTriangleChecker ()&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Check</span> <span class="params">(<span class="keyword">const</span> AttributeValue &amp;value)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION (&amp;value);</span><br><span class="line">          <span class="keyword">const</span> MyTriangleValue *v = <span class="keyword">dynamic_cast</span>&lt;<span class="keyword">const</span> MyTriangleValue *&gt; (&amp;value);</span><br><span class="line">          <span class="keyword">if</span> (v == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="keyword">return</span> v-&gt;Get().IsValidate();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">GetValueTypeName</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION_NOARGS ();</span><br><span class="line">          <span class="keyword">return</span> <span class="string">"ns3::MyTriangleValue"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasUnderlyingTypeInformation</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION_NOARGS ();</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">GetUnderlyingTypeInformation</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION_NOARGS ();</span><br><span class="line">          <span class="built_in">std</span>::<span class="built_in">ostringstream</span> oss;</span><br><span class="line">          oss &lt;&lt; <span class="string">"MyTriangle"</span>;</span><br><span class="line">          <span class="keyword">return</span> oss.str ();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">virtual</span> Ptr&lt;AttributeValue&gt; Create (<span class="keyword">void</span>) <span class="keyword">const</span> &#123;</span><br><span class="line">          NS_LOG_FUNCTION_NOARGS ();</span><br><span class="line">          <span class="keyword">return</span> ns3::Create&lt;MyTriangleValue&gt; ();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Copy</span> <span class="params">(<span class="keyword">const</span> AttributeValue &amp;src, AttributeValue &amp;dst)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION (&amp;src &lt;&lt; &amp;dst);</span><br><span class="line">          <span class="keyword">const</span> MyTriangleValue *source = <span class="keyword">dynamic_cast</span>&lt;<span class="keyword">const</span> MyTriangleValue *&gt; (&amp;src);</span><br><span class="line">          MyTriangleValue *destination = <span class="keyword">dynamic_cast</span>&lt;MyTriangleValue *&gt; (&amp;dst);</span><br><span class="line">          <span class="keyword">if</span> (source == <span class="number">0</span> || destination == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          *destination = *source;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; *checker = <span class="keyword">new</span> MyTriangleChecker();</span><br><span class="line">      <span class="keyword">return</span> Ptr&lt;AttributeChecker&gt; (checker, <span class="literal">false</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <marked style="border-bottom: 2px solid red;">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeMyTriangleChecker (MyTriangle::TriangleType type) &#123;</marked></span><br><span class="line">      NS_LOG_FUNCTION_NOARGS();</span><br><span class="line"></span><br><span class="line">      <span class="class"><span class="keyword">struct</span> <span class="title">MyTriangleChecker</span> :</span> <span class="keyword">public</span> AttributeChecker</span><br><span class="line">      &#123;</span><br><span class="line">        MyTriangleChecker (MyTriangle::TriangleType type):m_type(type)&#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Check</span> <span class="params">(<span class="keyword">const</span> AttributeValue &amp;value)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION (&amp;value);</span><br><span class="line">          <span class="keyword">const</span> MyTriangleValue *v = <span class="keyword">dynamic_cast</span>&lt;<span class="keyword">const</span> MyTriangleValue *&gt; (&amp;value);</span><br><span class="line">          <span class="keyword">if</span> (v == <span class="number">0</span>)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span>(v-&gt;Get().IsValidate()) &#123;</span><br><span class="line">          		<span class="keyword">switch</span>(m_type) &#123;</span><br><span class="line">          			<span class="keyword">case</span> MyTriangle::TriangleType::ACUTE: 		<span class="comment">//锐角三角形</span></span><br><span class="line">          				<span class="keyword">return</span> v-&gt;Get().CosOfLargestAngle() &gt; <span class="number">0</span>;</span><br><span class="line">          				<span class="keyword">break</span>;</span><br><span class="line">          			<span class="keyword">case</span> MyTriangle::TriangleType::OBTUSE:		<span class="comment">//钝角三角形</span></span><br><span class="line">          				<span class="keyword">return</span> v-&gt;Get().CosOfLargestAngle() &lt; <span class="number">0</span>;</span><br><span class="line">          				<span class="keyword">break</span>;</span><br><span class="line">          			<span class="keyword">case</span> MyTriangle::TriangleType::RIGHT: 		<span class="comment">//直角三角形</span></span><br><span class="line">          				<span class="keyword">return</span> v-&gt;Get().IsRightTriangle();</span><br><span class="line">          				<span class="keyword">break</span>;</span><br><span class="line">          			<span class="keyword">default</span>:</span><br><span class="line">          				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">          		&#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">          		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">GetValueTypeName</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION_NOARGS ();</span><br><span class="line">          <span class="keyword">return</span> <span class="string">"ns3::MyTriangleValue"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">HasUnderlyingTypeInformation</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION_NOARGS ();</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">virtual</span> <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">GetUnderlyingTypeInformation</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION_NOARGS ();</span><br><span class="line">          <span class="built_in">std</span>::<span class="built_in">ostringstream</span> oss;</span><br><span class="line">          oss &lt;&lt; <span class="string">"MyTriangle"</span>;</span><br><span class="line">          <span class="keyword">return</span> oss.str ();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">virtual</span> Ptr&lt;AttributeValue&gt; Create (<span class="keyword">void</span>) <span class="keyword">const</span> &#123;</span><br><span class="line">          NS_LOG_FUNCTION_NOARGS ();</span><br><span class="line">          <span class="keyword">return</span> ns3::Create&lt;MyTriangleValue&gt; ();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">Copy</span> <span class="params">(<span class="keyword">const</span> AttributeValue &amp;src, AttributeValue &amp;dst)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">          NS_LOG_FUNCTION (&amp;src &lt;&lt; &amp;dst);</span><br><span class="line">          <span class="keyword">const</span> MyTriangleValue *source = <span class="keyword">dynamic_cast</span>&lt;<span class="keyword">const</span> MyTriangleValue *&gt; (&amp;src);</span><br><span class="line">          MyTriangleValue *destination = <span class="keyword">dynamic_cast</span>&lt;MyTriangleValue *&gt; (&amp;dst);</span><br><span class="line">          <span class="keyword">if</span> (source == <span class="number">0</span> || destination == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          *destination = *source;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        MyTriangle::TriangleType m_type;</span><br><span class="line"></span><br><span class="line">      &#125; *checker = <span class="keyword">new</span> MyTriangleChecker(type);</span><br><span class="line">      <span class="keyword">return</span> Ptr&lt;AttributeChecker&gt; (checker, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="comment">// internal</span></span><br><span class="line"></span><br><span class="line">  Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeMyTriangleChecker (<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> internal::MakeMyTriangleChecker();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeMyTriangleChecker (MyTriangle::TriangleType type) &#123;</span><br><span class="line">    <marked style="border-bottom: 2px solid red;"><span class="keyword">return</span> internal::MakeMyTriangleChecker(type);</marked></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//================MyObject==================</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> :</span> <span class="keyword">public</span> Object	<span class="comment">//继承自SimpleRefCount，又继承自ObjectBase</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> TypeId <span class="title">GetTypeId</span> <span class="params">()</span></span>;				<span class="comment">//必须实现此方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    MyObject ();</span><br><span class="line">    <span class="keyword">virtual</span> ~MyObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//业务方法</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">MyMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetTriangle</span><span class="params">(MyTriangle &amp; triangle)</span> </span>&#123;</span><br><span class="line">    	m_triangle = triangle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">MyTriangle &amp; <span class="title">GetObj</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> m_triangle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    MyTriangle m_triangle;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  NS_OBJECT_ENSURE_REGISTERED (MyObject);		<span class="comment">//不要忘记调用</span></span><br><span class="line"></span><br><span class="line">  TypeId</span><br><span class="line">  MyObject::GetTypeId ()</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="keyword">static</span> TypeId tid = TypeId(<span class="string">"ns3::MyObject"</span>)		<span class="comment">//创建TypeId，</span></span><br><span class="line">  		.SetParent(Object::GetTypeId())</span><br><span class="line">      .SetGroupName(<span class="string">"MyExample"</span>)</span><br><span class="line">      .AddConstructor&lt;MyObject&gt;()</span><br><span class="line">      .AddAttribute (<span class="string">"myTriangle"</span>, <span class="string">"help text"</span>,</span><br><span class="line">										 MyTriangleValue(),</span><br><span class="line">                     MakeMyTriangleAccessor (&amp;MyObject::m_triangle),</span><br><span class="line">                     <marked style="border-bottom: 2px solid red;">MakeMyTriangleChecker (MyTriangle::TriangleType::RIGHT))</marked></span><br><span class="line">			;</span><br><span class="line">  	<span class="keyword">return</span> tid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MyObject::~MyObject ()</span><br><span class="line">  &#123;</span><br><span class="line">  	NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span></span><br><span class="line">	MyObject::MyMethod ()</span><br><span class="line">	&#123;</span><br><span class="line">		NS_LOG_FUNCTION(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		NS_LOG_UNCOND(<span class="string">"my method is executed"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; getCheckerByName(TypeId typeId, <span class="built_in">std</span>::<span class="built_in">string</span> attributeName) &#123;</span><br><span class="line">	TypeId::AttributeInformation * info = <span class="keyword">new</span> TypeId::AttributeInformation();</span><br><span class="line">	typeId.LookupAttributeByName(attributeName, info);</span><br><span class="line">	Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; checker = info-&gt;checker;</span><br><span class="line">	<span class="keyword">delete</span> info;</span><br><span class="line">	<span class="keyword">return</span> checker;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	LogComponentEnable(<span class="string">"MyTriangle"</span>, LOG_LEVEL_LOGIC);</span><br><span class="line"></span><br><span class="line">	Ptr&lt;MyObject&gt; obj = CreateObject&lt;MyObject&gt;();</span><br><span class="line">	obj-&gt;SetAttribute(<span class="string">"myTriangle"</span>, StringValue(<span class="string">"3,4,5"</span>));</span><br><span class="line"></span><br><span class="line">	MyTriangleValue value2;</span><br><span class="line">	obj-&gt;GetAttribute(<span class="string">"myTriangle"</span>, value2);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; value2.Get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可见internal名称空间当中有两种MakeMyTriangleChecker的实现，分别使用内部类实现了有参数和无参数的两种检查器。程序中定义了属性值必须是直角三角形，并且在给属性复制时通过检查器当中进行了检查，如果检查不通过，则属性设置将无法完成。运行程序之后得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[ 931/1969] Compiling scratch/try-attribute-customise.cc</span><br><span class="line">[1958/1969] Linking build/scratch/try-attribute-customise</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.215s)</span><br><span class="line">MyTriangle:MyObject(0x25a9e00)</span><br><span class="line">MyTriangle:Check(0x25a4650)</span><br><span class="line">MyTriangle:Check(0x7ffead84bf40)</span><br><span class="line">MyTriangle:Create()</span><br><span class="line">MyTriangle:DoParse(&quot;3,4,5&quot;, 0x7ffead84b920)</span><br><span class="line">MyTriangle:Check(0x25a3f40)</span><br><span class="line">other: 25, longest: 25</span><br><span class="line">triangle (3, 4, 5)</span><br><span class="line">MyTriangle:~MyObject(0x25a9e00)</span><br></pre></td></tr></table></figure>
<p>如果我们传入的值不是直角三角形，例如传入3,4,6我们将得到如下的结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[1822/1969] Compiling scratch/try-attribute-customise.cc</span><br><span class="line">[1958/1969] Linking build/scratch/try-attribute-customise</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.691s)</span><br><span class="line">MyTriangle:MyObject(0x9e9e00)</span><br><span class="line">MyTriangle:Check(0x9e4650)</span><br><span class="line">MyTriangle:Check(0x7fff35efac60)</span><br><span class="line">MyTriangle:Create()</span><br><span class="line">MyTriangle:DoParse(&quot;3,4,6&quot;, 0x7fff35efa640)</span><br><span class="line">MyTriangle:Check(0x9e3f40)</span><br><span class="line">other: 25, longest: 36</span><br><span class="line">msg=&quot;Attribute name=myTriangle could not be set for this object: tid=ns3::MyObject&quot;, file=../src/core/model/object-base.cc, line=201</span><br><span class="line">terminate called without an active exception</span><br><span class="line">Command [&apos;/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build/scratch/try-attribute-customise&apos;] terminated with signal SIGIOT. Run it under a debugger to get more information (./waf --run &lt;program&gt; --command-template=&quot;gdb --args %s &lt;args&gt;&quot;).</span><br></pre></td></tr></table></figure>
<p>此外，我们修改检查器参数为钝角三角形，并传入钝角三角形参数2,3,4，则将得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[ 931/1969] Compiling scratch/try-attribute-customise.cc</span><br><span class="line">[1937/1969] Linking build/scratch/try-attribute-customise</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.246s)</span><br><span class="line">MyTriangle:MyObject(0x19e4e00)</span><br><span class="line">MyTriangle:Check(0x19df650)</span><br><span class="line">MyTriangle:Check(0x7ffe71790a90)</span><br><span class="line">MyTriangle:Create()</span><br><span class="line">MyTriangle:DoParse(&quot;2,3,4&quot;, 0x7ffe71790470)</span><br><span class="line">MyTriangle:Check(0x19def40)</span><br><span class="line">triangle (2, 3, 4)</span><br><span class="line">MyTriangle:~MyObject(0x19e4e00)</span><br></pre></td></tr></table></figure>
<p>如果我们传入一个锐角三角形6,6,6，则将得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Waf: Entering directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">[1823/1969] Compiling scratch/try-attribute-customise.cc</span><br><span class="line">[1957/1969] Linking build/scratch/try-attribute-customise</span><br><span class="line">Waf: Leaving directory `/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build&apos;</span><br><span class="line">Build commands will be stored in build/compile_commands.json</span><br><span class="line">&apos;build&apos; finished successfully (2.600s)</span><br><span class="line">MyTriangle:MyObject(0x1a3ee00)</span><br><span class="line">MyTriangle:Check(0x1a39650)</span><br><span class="line">MyTriangle:Check(0x7ffe4bacd8b0)</span><br><span class="line">MyTriangle:Create()</span><br><span class="line">MyTriangle:DoParse(&quot;6,6,6&quot;, 0x7ffe4bacd290)</span><br><span class="line">MyTriangle:Check(0x1a38f40)</span><br><span class="line">msg=&quot;Attribute name=myTriangle could not be set for this object: tid=ns3::MyObject&quot;, file=../src/core/model/object-base.cc, line=201</span><br><span class="line">terminate called without an active exception</span><br><span class="line">Command [&apos;/home/rainsia/Applications/ns-allinone-3.27/ns-3.27/build/scratch/try-attribute-customise&apos;] terminated with signal SIGIOT. Run it under a debugger to get more information (./waf --run &lt;program&gt; --command-template=&quot;gdb --args %s &lt;args&gt;&quot;).</span><br></pre></td></tr></table></figure>
<p>可见，我们自己实现的检查器确实起到了检查属性的作用。</p>
<h2 id="4-6-NS-3当中两种自定义属性值类型"><a href="#4-6-NS-3当中两种自定义属性值类型" class="headerlink" title="4.6. NS-3当中两种自定义属性值类型"></a>4.6. NS-3当中两种自定义属性值类型</h2><h3 id="4-6-1-时间类型Time"><a href="#4-6-1-时间类型Time" class="headerlink" title="4.6.1. 时间类型Time"></a>4.6.1. 时间类型Time</h3><p>时间类型是最常用的自定义NS-3类型，主要用于表示仿真的时间。时间类型使用Time类来表示。Time类能够表示一共10中精度类型，默认为秒纳秒(NS)级别：</p>
<figure class="highlight cpp"><figcaption><span>nstime.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> Unit</span><br><span class="line">&#123;</span><br><span class="line">  Y   = <span class="number">0</span>,   <span class="comment">//!&lt; year, 365 days</span></span><br><span class="line">  D   = <span class="number">1</span>,   <span class="comment">//!&lt; day, 24 hours</span></span><br><span class="line">  H   = <span class="number">2</span>,   <span class="comment">//!&lt; hour, 60 minutes</span></span><br><span class="line">  MIN = <span class="number">3</span>,   <span class="comment">//!&lt; minute, 60 seconds</span></span><br><span class="line">  S   = <span class="number">4</span>,   <span class="comment">//!&lt; second</span></span><br><span class="line">  MS  = <span class="number">5</span>,   <span class="comment">//!&lt; millisecond</span></span><br><span class="line">  US  = <span class="number">6</span>,   <span class="comment">//!&lt; microsecond</span></span><br><span class="line">  NS  = <span class="number">7</span>,   <span class="comment">//!&lt; nanosecond</span></span><br><span class="line">  PS  = <span class="number">8</span>,   <span class="comment">//!&lt; picosecond</span></span><br><span class="line">  FS  = <span class="number">9</span>,   <span class="comment">//!&lt; femtosecond</span></span><br><span class="line">  LAST = <span class="number">10</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>可以通过调用Time类的静态方法SetResolution()来改变默认的级别。</p>
<figure class="highlight cpp"><figcaption><span>nstime.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SetResolution</span> <span class="params">(<span class="keyword">enum</span> Unit resolution)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">enum</span> Unit <span class="title">GetResolution</span> <span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<p>设置时间表示的精度后，可以通过以下静态方法来创建时间类型：</p>
<figure class="highlight cpp"><figcaption><span>nstime.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> Time <span class="title">From</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int64x64_t</span> &amp; value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> Time <span class="title">From</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int64x64_t</span> &amp; value)</span></span>;</span><br></pre></td></tr></table></figure>
<p>或者在使用静态方法构造的同时传入时间精度：</p>
<figure class="highlight cpp"><figcaption><span>nstime.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> Time <span class="title">FromInteger</span> <span class="params">(<span class="keyword">uint64_t</span> value, <span class="keyword">enum</span> Unit unit)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> Time <span class="title">FromDouble</span> <span class="params">(<span class="keyword">double</span> value, <span class="keyword">enum</span> Unit unit)</span></span>;</span><br></pre></td></tr></table></figure>
<p>同时Time类也提供了丰富的构造函数可以调用：</p>
<figure class="highlight cpp"><figcaption><span>nstime.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="keyword">inline</span> <span class="title">Time</span> <span class="params">(<span class="keyword">double</span> v)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="keyword">inline</span> <span class="title">Time</span> <span class="params">(<span class="keyword">int</span> v)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="keyword">inline</span> <span class="title">Time</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">int</span> v)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="keyword">inline</span> <span class="title">Time</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> v)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="keyword">inline</span> <span class="title">Time</span> <span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> v)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="keyword">inline</span> <span class="title">Time</span> <span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">int</span> v)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="keyword">inline</span> <span class="title">Time</span> <span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> v)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="keyword">inline</span> <span class="title">Time</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int64x64_t</span> &amp; v)</span></span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从字符串构造时间，可以识别以下单位:</span></span><br><span class="line"><span class="comment"> * - `s`  (seconds)</span></span><br><span class="line"><span class="comment"> * - `ms` (milliseconds)</span></span><br><span class="line"><span class="comment"> * - `us` (microseconds)</span></span><br><span class="line"><span class="comment"> * - `ns` (nanoseconds)</span></span><br><span class="line"><span class="comment"> * - `ps` (picoseconds)</span></span><br><span class="line"><span class="comment"> * - `fs` (femtoseconds)</span></span><br><span class="line"><span class="comment"> * - `min`  (minutes)</span></span><br><span class="line"><span class="comment"> * - `h`  (hours)</span></span><br><span class="line"><span class="comment"> * - `d`  (days)</span></span><br><span class="line"><span class="comment"> * - `y`  (years)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 时间数值和单位之间不能有空格</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">Time</span> <span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp; s)</span></span>;</span><br></pre></td></tr></table></figure>
<p>除此之外，NS-3还提供了更加直观的函数来创建时间实例，这些函数可以直接调用，并返回相应的时间实例：</p>
<figure class="highlight cpp"><figcaption><span>nstime.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">Years</span> <span class="params">(<span class="keyword">double</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">Years</span> <span class="params">(<span class="keyword">int64x64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">Days</span> <span class="params">(<span class="keyword">double</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">Days</span> <span class="params">(<span class="keyword">int64x64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">Hours</span> <span class="params">(<span class="keyword">double</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">Hours</span> <span class="params">(<span class="keyword">int64x64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">Minutes</span> <span class="params">(<span class="keyword">double</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">Minutes</span> <span class="params">(<span class="keyword">int64x64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">Seconds</span> <span class="params">(<span class="keyword">double</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">Seconds</span> <span class="params">(<span class="keyword">int64x64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">MilliSeconds</span> <span class="params">(<span class="keyword">uint64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">MilliSeconds</span> <span class="params">(<span class="keyword">int64x64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">MicroSeconds</span> <span class="params">(<span class="keyword">uint64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">MicroSeconds</span> <span class="params">(<span class="keyword">int64x64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">NanoSeconds</span> <span class="params">(<span class="keyword">uint64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">NanoSeconds</span> <span class="params">(<span class="keyword">int64x64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">PicoSeconds</span> <span class="params">(<span class="keyword">uint64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">PicoSeconds</span> <span class="params">(<span class="keyword">int64x64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">FemtoSeconds</span> <span class="params">(<span class="keyword">uint64_t</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Time <span class="title">FemtoSeconds</span> <span class="params">(<span class="keyword">int64x64_t</span> value)</span></span>;</span><br></pre></td></tr></table></figure>
<p>时间类型也能够被转换成相应单位的普通数据类型，以方便输出：</p>
<figure class="highlight cpp"><figcaption><span>nstime.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">GetYears</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">GetDays</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">GetHours</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">GetMinutes</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">GetSeconds</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> int64_t <span class="title">GetMilliSeconds</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> int64_t <span class="title">GetMicroSeconds</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> int64_t <span class="title">GetNanoSeconds</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> int64_t <span class="title">GetPicoSeconds</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> int64_t <span class="title">GetFemtoSeconds</span> <span class="params">(<span class="keyword">void</span>)</span> <span class="keyword">const</span></span>;</span><br></pre></td></tr></table></figure>
<p>此外，NS-3还提供了很多关于时间的操作符，例如基本的加减乘除等：</p>
<figure class="highlight cpp"><figcaption><span>nstime.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> == (<span class="keyword">const</span> Time &amp; lhs, <span class="keyword">const</span> Time &amp; rhs);</span><br><span class="line"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> != (<span class="keyword">const</span> Time &amp; lhs, <span class="keyword">const</span> Time &amp; rhs);</span><br><span class="line"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;= (<span class="keyword">const</span> Time &amp; lhs, <span class="keyword">const</span> Time &amp; rhs);</span><br><span class="line"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &gt;= (<span class="keyword">const</span> Time &amp; lhs, <span class="keyword">const</span> Time &amp; rhs);</span><br><span class="line"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Time &amp; lhs, <span class="keyword">const</span> Time &amp; rhs);</span><br><span class="line"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &gt; (<span class="keyword">const</span> Time &amp; lhs, <span class="keyword">const</span> Time &amp; rhs);</span><br><span class="line"><span class="keyword">friend</span> Time <span class="keyword">operator</span> + (<span class="keyword">const</span> Time &amp; lhs, <span class="keyword">const</span> Time &amp; rhs);</span><br><span class="line"><span class="keyword">friend</span> Time <span class="keyword">operator</span> - (<span class="keyword">const</span> Time &amp; lhs, <span class="keyword">const</span> Time &amp; rhs);</span><br><span class="line"><span class="keyword">friend</span> Time <span class="keyword">operator</span> * (<span class="keyword">const</span> Time &amp; lhs, <span class="keyword">const</span> <span class="keyword">int64_t</span> &amp; rhs);</span><br><span class="line"><span class="keyword">friend</span> Time <span class="keyword">operator</span> * (<span class="keyword">const</span> <span class="keyword">int64_t</span> &amp; lhs, <span class="keyword">const</span> Time &amp; rhs);</span><br><span class="line"><span class="keyword">friend</span> <span class="keyword">int64_t</span> <span class="keyword">operator</span> / (<span class="keyword">const</span> Time &amp; lhs, <span class="keyword">const</span> Time &amp; rhs);</span><br><span class="line"><span class="keyword">friend</span> Time <span class="keyword">operator</span> / (<span class="keyword">const</span> Time &amp; lhs, <span class="keyword">const</span> <span class="keyword">int64_t</span> &amp; rhs);</span><br><span class="line"><span class="keyword">friend</span> Time &amp; <span class="keyword">operator</span> += (Time &amp; lhs, <span class="keyword">const</span> Time &amp; rhs);</span><br><span class="line"><span class="keyword">friend</span> Time &amp; <span class="keyword">operator</span> -= (Time &amp; lhs, <span class="keyword">const</span> Time &amp; rhs);</span><br></pre></td></tr></table></figure>
<p>以及各种工具方法：</p>
<figure class="highlight cpp"><figcaption><span>nstime.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">friend</span> Time <span class="title">Abs</span> <span class="params">(<span class="keyword">const</span> Time &amp; time)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">friend</span> Time <span class="title">Max</span> <span class="params">(<span class="keyword">const</span> Time &amp; ta, <span class="keyword">const</span> Time &amp; tb)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">friend</span> Time <span class="title">Min</span> <span class="params">(<span class="keyword">const</span> Time &amp; ta, <span class="keyword">const</span> Time &amp; tb)</span></span>;</span><br></pre></td></tr></table></figure>
<p>时间类型也能通过属性值类型宏被扩展成属性：</p>
<figure class="highlight cpp"><figcaption><span>nstime.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ATTRIBUTE_VALUE_DEFINE (Time);</span><br><span class="line">ATTRIBUTE_ACCESSOR_DEFINE (Time);</span><br></pre></td></tr></table></figure>
<p>这两个宏会扩展出默认类型TimeValue，以及默认的变量访问器和函数访问器方法MakeTimeChecker()。</p>
<p>此外，NS-3定义了三种Time属性值类型的检查器：</p>
<figure class="highlight cpp"><figcaption><span>nstime.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeTimeChecker (<span class="keyword">const</span> Time min, <span class="keyword">const</span> Time max);</span><br><span class="line"><span class="keyword">inline</span> Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeTimeChecker (<span class="keyword">void</span>);</span><br><span class="line"><span class="keyword">inline</span> Ptr&lt;<span class="keyword">const</span> AttributeChecker&gt; MakeTimeChecker (<span class="keyword">const</span> Time min);</span><br></pre></td></tr></table></figure>
<h3 id="4-6-2-速率类型DataRate"><a href="#4-6-2-速率类型DataRate" class="headerlink" title="4.6.2. 速率类型DataRate"></a>4.6.2. 速率类型DataRate</h3><p>速率也是NS-3的基本自定义类型之一，用于表示数据的传输速率或者带宽。速率使用DataRate类表示。和时间类一样，速率也可以使用不同的单位来表示。速率的基本单位为bps(bit per second)，这也是默认的速率存储单位，任何其他单位都是bps的整数倍。DataRate提供了一个构造函数以bps为基本单位：</p>
<figure class="highlight cpp"><figcaption><span>data-rate.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DataRate (<span class="keyword">uint64_t</span> bps);</span><br></pre></td></tr></table></figure>
<p>除此之外，NS-3也提供了使用字符串来构造DataRate类的构造函数，支持以数字和单位来表示速率：</p>
<figure class="highlight cpp"><figcaption><span>data-rate.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief String constructor</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Construct a data rate from a string.  Many different unit strings are supported</span></span><br><span class="line"><span class="comment"> * Supported unit strings:</span></span><br><span class="line"><span class="comment"> * bps, b/s, Bps, B/s \n</span></span><br><span class="line"><span class="comment"> * kbps, kb/s, Kbps, Kb/s, kBps, kB/s, KBps, KB/s, Kib/s, KiB/s \n</span></span><br><span class="line"><span class="comment"> * Mbps, Mb/s, MBps, MB/s, Mib/s, MiB/s \n</span></span><br><span class="line"><span class="comment"> * Gbps, Gb/s, GBps, GB/s, Gib/s, GiB/s \n</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Examples:</span></span><br><span class="line"><span class="comment"> * "56kbps" = 56,000 bits/s \n</span></span><br><span class="line"><span class="comment"> * "128 kb/s" = 128,000 bits/s \n</span></span><br><span class="line"><span class="comment"> * "8Kib/s" = 1 KiB/s = 8192 bits/s \n</span></span><br><span class="line"><span class="comment"> * "1kB/s" = 8000 bits/s </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * \param rate string representing the desired rate</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">DataRate (<span class="built_in">std</span>::<span class="built_in">string</span> rate);</span><br></pre></td></tr></table></figure>
<p>可以看出，其支持非常丰富的单位类型。其中小写字母b表示bit，而大写字母B表示字节。而倍数关系主要分为十进制倍数，例如K和二进制倍数例如Ki，它们的关系如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">Prefix</th>
<th style="text-align:right">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">“k”, “K”</td>
<td style="text-align:right">1000</td>
</tr>
<tr>
<td style="text-align:left">“Ki”</td>
<td style="text-align:right">1024</td>
</tr>
<tr>
<td style="text-align:left">“M”</td>
<td style="text-align:right">1000000</td>
</tr>
<tr>
<td style="text-align:left">“Mi”</td>
<td style="text-align:right">1024 Ki</td>
</tr>
<tr>
<td style="text-align:left">“G”</td>
<td style="text-align:right">10^9</td>
</tr>
<tr>
<td style="text-align:left">“Gi “</td>
<td style="text-align:right">1024 Mi</td>
</tr>
</tbody>
</table>
<p>DataRate类也提供了基本关系运算符用于比较两个速率之间的关系：</p>
<figure class="highlight cpp"><figcaption><span>data-rate.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span> &lt;  (<span class="keyword">const</span> DataRate&amp; rhs) <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span> &lt;= (<span class="keyword">const</span> DataRate&amp; rhs) <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span> &gt;  (<span class="keyword">const</span> DataRate&amp; rhs) <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span> &gt;= (<span class="keyword">const</span> DataRate&amp; rhs) <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span> == (<span class="keyword">const</span> DataRate&amp; rhs) <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span> != (<span class="keyword">const</span> DataRate&amp; rhs) <span class="keyword">const</span>;</span><br></pre></td></tr></table></figure>
<p>也可以获取底层的bps速率：</p>
<figure class="highlight cpp"><figcaption><span>data-rate.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uint64_t</span> GetBitRate () <span class="keyword">const</span>;</span><br></pre></td></tr></table></figure>
<p>此外，DataRate类还提供了方法计算以该速率传输一定量的数据所需的时间，并返回Time类的实例：</p>
<figure class="highlight cpp"><figcaption><span>data-rate.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Time <span class="title">CalculateBytesTxTime</span> <span class="params">(<span class="keyword">uint32_t</span> bytes)</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function">Time <span class="title">CalculateBitsTxTime</span> <span class="params">(<span class="keyword">uint32_t</span> bits)</span> <span class="keyword">const</span></span>;</span><br></pre></td></tr></table></figure>
<p>这两个函数的名字都已经很直白了，在此就不再赘述。此外，还要注意，老版本的NS-3当中具有如下方法，为了保持兼容性，暂时还未删除，但现在已经不再推荐使用（猜测废弃的主要原因是无法区分数据量的单位）：</p>
<figure class="highlight cpp"><figcaption><span>data-rate.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">CalculateTxTime</span> <span class="params">(<span class="keyword">uint32_t</span> bytes)</span> <span class="keyword">const</span></span>;</span><br></pre></td></tr></table></figure>
<p>同时，NS-3也提供了如下方法，可以让DataRate类和Time类相乘计算数据量：</p>
<figure class="highlight cpp"><figcaption><span>data-rate.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> <span class="keyword">operator</span>* (<span class="keyword">const</span> DataRate&amp; lhs, <span class="keyword">const</span> Time&amp; rhs);</span><br><span class="line"><span class="keyword">double</span> <span class="keyword">operator</span>* (<span class="keyword">const</span> Time&amp; lhs, <span class="keyword">const</span> DataRate&amp; rhs);</span><br></pre></td></tr></table></figure>
<p>和Time类类似，DataRate类也通过标准的属性值宏定义为了属性值类型：</p>
<figure class="highlight cpp"><figcaption><span>data-rate.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ATTRIBUTE_HELPER_HEADER (DataRate);</span><br></pre></td></tr></table></figure>
<p>因此，它具有默认的DataRateValue，MakeDataRateAccessor()和MakeDataRateChecker()方法。</p>

      
    </div>

    

    
    
    

    

    

		<div>
					
						
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2018/04/12/ns3-005/">NS-3学习笔记（五）：NS-3的对象框架 之 属性框架</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 Rain Sia <rainsia@163.com> 的个人博客">Rain Sia <rainsia@163.com></a></p>
  <p><span>发布时间:</span>2018年04月12日 - 00:04</p>
  <p><span>最后更新:</span>2018年10月29日 - 10:10</p>
  <p><span>原始链接:</span>
		<a href="/2018/04/12/ns3-005/" title="NS-3学习笔记（五）：NS-3的对象框架 之 属性框架">
			http://rainsia.github.io/2018/04/12/ns3-005/
		</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://rainsia.github.io/2018/04/12/ns3-005/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>版权信息:</span>本文为作者原创文章，如需进行非商业性转载，请注明出处并保留原文链接及作者。如要进行商业性转载，请获得作者授权！</p>  
  <p><span>联系方式:</span>rainsia@163.com</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
      $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
        });
    });  
</script>


					
		</div>

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/NS-3/" rel="tag"># NS-3</a>
          
            <a href="/tags/C/" rel="tag"># C++</a>
          
            <a href="/tags/Simulation/" rel="tag"># Simulation</a>
          
            <a href="/tags/Object/" rel="tag"># Object</a>
          
            <a href="/tags/ObjectBase/" rel="tag"># ObjectBase</a>
          
            <a href="/tags/Attribute/" rel="tag"># Attribute</a>
          
            <a href="/tags/StringValue/" rel="tag"># StringValue</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/04/08/ns3-004/" rel="next" title="NS-3学习笔记（四）：NS-3的对象框架 之 TypeId">
                <i class="fa fa-chevron-left"></i> NS-3学习笔记（四）：NS-3的对象框架 之 TypeId
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/01/ns3-006/" rel="prev" title="NS-3学习笔记（六）：回调">
                NS-3学习笔记（六）：回调 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="Rain Sia <rainsia@163.com>" />
            
              <p class="site-author-name" itemprop="name">Rain Sia <rainsia@163.com></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">41</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-属性框架简介"><span class="nav-text">1. 属性框架简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-TypeId中关于属性框架的方法"><span class="nav-text">1.1. TypeId中关于属性框架的方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-定义一个属性"><span class="nav-text">1.2. 定义一个属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-设置和访问属性"><span class="nav-text">1.3. 设置和访问属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-改变属性默认值"><span class="nav-text">1.4. 改变属性默认值</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-属性详解"><span class="nav-text">2. 属性详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-属性值类型"><span class="nav-text">2.1. 属性值类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-属性访问器"><span class="nav-text">2.2. 属性访问器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-属性检查器"><span class="nav-text">2.3. 属性检查器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-原始类型的属性值类型"><span class="nav-text">2.4. 原始类型的属性值类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-1-BooleanValue"><span class="nav-text">2.4.1. BooleanValue</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-1-1-BooleanValue的定义"><span class="nav-text">2.4.1.1. BooleanValue的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-1-2-BooleanValue的访问器"><span class="nav-text">2.4.1.2. BooleanValue的访问器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-1-3-BooleanValue的检查器"><span class="nav-text">2.4.1.3. BooleanValue的检查器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-1-4-BooleanValue的使用"><span class="nav-text">2.4.1.4. BooleanValue的使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-2-DoubleValue"><span class="nav-text">2.4.2. DoubleValue</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-2-1-DoubleValue的检查器"><span class="nav-text">2.4.2.1. DoubleValue的检查器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-2-2-DoubleValue的使用"><span class="nav-text">2.4.2.2. DoubleValue的使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-3-IntegerValue和UintegerValue"><span class="nav-text">2.4.3. IntegerValue和UintegerValue</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-4-StringValue"><span class="nav-text">2.4.4. StringValue</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-4-1-StringValue的定义"><span class="nav-text">2.4.4.1. StringValue的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-4-2-StringValue的自动类型转换"><span class="nav-text">2.4.4.2. StringValue的自动类型转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-4-3-StringValue的手动类型转换"><span class="nav-text">2.4.4.3. StringValue的手动类型转换</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-枚举类型的属性值类型"><span class="nav-text">2.5. 枚举类型的属性值类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-1-EnumValue的访问器"><span class="nav-text">2.5.1. EnumValue的访问器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-2-EnumValue的检查器"><span class="nav-text">2.5.2. EnumValue的检查器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-3-EnumValue的使用"><span class="nav-text">2.5.3. EnumValue的使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-对象指针属性"><span class="nav-text">2.6. 对象指针属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-1-单个对象"><span class="nav-text">2.6.1. 单个对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-2-多个对象"><span class="nav-text">2.6.2. 多个对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-2-1-ObjectVectorValue"><span class="nav-text">2.6.2.1. ObjectVectorValue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-2-2-ObjectMapValue"><span class="nav-text">2.6.2.2. ObjectMapValue</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-对象工厂"><span class="nav-text">3. 对象工厂</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-对象工厂的使用"><span class="nav-text">3.1. 对象工厂的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-从StringValue创建对象"><span class="nav-text">3.2. 从StringValue创建对象</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-自定义属性值类型"><span class="nav-text">4. 自定义属性值类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-定义数据类型"><span class="nav-text">4.1. 定义数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-定义属性值类型"><span class="nav-text">4.2. 定义属性值类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-实现和使用属性"><span class="nav-text">4.3. 实现和使用属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-和字符串之前转换"><span class="nav-text">4.4. 和字符串之前转换</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-1-指定类型表示规则"><span class="nav-text">4.4.1. 指定类型表示规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-2-编写解析代码"><span class="nav-text">4.4.2. 编写解析代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-检查属性的正确性与自定义检查器"><span class="nav-text">4.5. 检查属性的正确性与自定义检查器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-6-NS-3当中两种自定义属性值类型"><span class="nav-text">4.6. NS-3当中两种自定义属性值类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-1-时间类型Time"><span class="nav-text">4.6.1. 时间类型Time</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-2-速率类型DataRate"><span class="nav-text">4.6.2. 速率类型DataRate</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rain Sia, All rights reserved.<br/>本站所有原创文章，如进行非商业目的转载，请注明出处。若要进行商业目的转载，必须取得授权。<br/>--作者</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.5.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Gemini</a> v6.4.2</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'KSHKjGm3HfpWAPzaHoA4NV0H-gzGzoHsz',
        appKey: '55JA7fexBRQej1dHDpuxfTA0',
        placeholder: 'Just go go',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: false
    });
  </script>



  





  

  

  

  
  

  
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  
  

  

  

  

  

  

</body>
</html>
